
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Malware Analysis III &#8212; Theory 2020 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Malware Analysis II" href="../11_malware_analysisII/analysis.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/index.html">Main</a></li>
                <li><a href="/exercise/index.html">Tutorial</a></li>
                <li><a href="/qcm/index.html">MCQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2_basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3_memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4_assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../4_assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4_assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../5_buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6_complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#the-off-by-one-vulnerability">The “off by one vulnerability”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7_shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../7_shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7_shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../8_stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../8_stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8_stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8_stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8_stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../9_format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../10_malware_analysisI/introduction.html">Malware Analysis I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_malware_analysisII/analysis.html">Malware Analysis II</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#malware-analysis">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#dynamic-analysis">Dynamic Analysis</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Malware Analysis III</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="row" style="padding-top: 20px">
    <div class="col-xs-6">
        <form id="rar_tp"  target="_blank" style="text-align:center;" method="get" action="">
            <button style="text-align:center;" type="submit">
                <svg id="Capa_1"
                     width="50px" height="50px"
                     enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m453.31 460.125c0 24.508-19.907 44.375-44.464 44.375h-305.692c-24.557 0-44.464-19.867-44.464-44.375v-408.25c0-24.508 19.907-44.375 44.464-44.375h190.303c8.857 0 17.35 3.516 23.606 9.773l126.505 126.521c6.239 6.239 9.742 14.694 9.742 23.508z" fill="#f9f8f9"/><path d="m133.15 504.5h-30c-24.55 0-44.46-19.87-44.46-44.38v-408.24c0-24.51 19.91-44.38 44.46-44.38h30c-24.55 0-44.46 19.87-44.46 44.38v408.24c0 24.51 19.91 44.38 44.46 44.38z" fill="#e3e0e4"/><path d="m453.31 167.3v16.24h-115.96c-33.12 0-60.06-26.95-60.06-60.07v-115.97h16.17c8.85 0 17.35 3.52 23.6 9.77l126.51 126.52c6.24 6.24 9.74 14.7 9.74 23.51z" fill="#e3e0e4"/><path d="m450.32 153.54h-112.97c-16.6 0-30.06-13.46-30.06-30.07v-112.96c3.61 1.63 6.92 3.91 9.77 6.76l126.51 126.52c2.85 2.85 5.12 6.15 6.75 9.75z" fill="#b9a1d3"/><path d="m435 438.5h-358c-22.091 0-40-17.909-40-40v-146c0-22.091 17.909-40 40-40h358c22.091 0 40 17.909 40 40v146c0 22.091-17.909 40-40 40z" fill="#b9a1d3"/><path d="m102 438.5h-25c-22.09 0-40-17.91-40-40v-146c0-22.09 17.91-40 40-40h25c-22.09 0-40 17.91-40 40v146c0 22.09 17.91 40 40 40z" fill="#9573bb"/></g><g><path d="m58.689 153.851c4.143 0 7.5-3.357 7.5-7.5v-94.476c0-20.333 16.582-36.875 36.965-36.875h111.42c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-111.42c-28.653 0-51.965 23.271-51.965 51.875v94.476c0 4.142 3.358 7.5 7.5 7.5z"/><path d="m460.811 212.656v-45.354c0-10.879-4.24-21.111-11.938-28.811l-126.506-126.52c-7.718-7.72-17.985-11.971-28.91-11.971h-43.394c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h43.394c2.165 0 4.288.264 6.334.775v107.696c0 20.714 16.85 37.566 37.561 37.566h107.694c.505 2.025.765 4.125.765 6.265v38.954c-3.476-.812-7.092-1.256-10.811-1.256h-23.319c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h23.319c17.921 0 32.5 14.579 32.5 32.5v146c0 17.921-14.579 32.5-32.5 32.5h-268.66c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h268.66c3.719 0 7.335-.444 10.811-1.256v15.381c0 20.333-16.582 36.875-36.965 36.875h-305.692c-20.383 0-36.965-16.542-36.965-36.875v-15.381c3.476.812 7.092 1.256 10.811 1.256h53.319c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-53.319c-17.921 0-32.5-14.579-32.5-32.5v-146c0-17.921 14.579-32.5 32.5-32.5h299.702c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-299.702c-3.719 0-7.335.444-10.811 1.256v-24.905c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v31.305c-13.04 8.477-21.689 23.165-21.689 39.844v146c0 16.679 8.649 31.367 21.689 39.844v21.781c0 28.604 23.312 51.875 51.965 51.875h305.691c28.653 0 51.965-23.271 51.965-51.875v-21.781c13.041-8.477 21.689-23.165 21.689-39.844v-146c.001-16.679-8.648-31.367-21.688-39.844zm-146.02-89.185v-97.863l120.414 120.429h-97.854c-12.439 0-22.56-10.123-22.56-22.566z"/><path d="m265.669 264.091c-1.584-3.853-5.297-6.341-9.462-6.341-.003 0-.006 0-.009 0-4.168.004-7.882 2.499-9.461 6.356-.023.057-.046.114-.067.172l-45.247 118.803c-1.475 3.87.469 8.203 4.34 9.678 3.865 1.475 8.203-.468 9.678-4.34l9.429-24.757h62.347l9.335 24.736c1.458 3.914 5.891 5.823 9.665 4.368 3.875-1.462 5.831-5.789 4.368-9.665l-44.836-118.808c-.025-.067-.053-.135-.08-.202zm-35.087 84.571 25.603-67.226 25.37 67.226z"/><path d="m181.648 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.588-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/><path d="m410.5 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.589-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/></g></g>
                </svg>
                <br> <b> Slides </b>
            </button>
        </form>
    </div>
    <div class="col-xs-6">
        <form id="vid_tp" style="text-align:center;">
	<a id="notUp"  href="#!" style="text-align:center;"
   data-title="Watch now on youtube">
            <button class="video-btn" onclick="topFunction()"
                    style="text-align:center;" data-toggle="modal" type="button"
                    data-target="#myModal"
                    data-src="http://www.youtube.com/embed/Q0HFBy2BtfA?enablejsapi=1">
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg width="50px" height="50px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512.003 512.003" style="enable-background:new 0 0 512.003 512.003;" xml:space="preserve">
<path style="fill:#E53935;" d="M443.734,80.336L330.86,70.437c-49.812-4.334-99.906-4.334-149.717,0L68.268,80.336
	c-38.702,3.124-68.459,35.541-68.267,74.368v202.667c-0.204,38.835,29.557,71.265,68.267,74.389l112.939,9.813
	c24.832,2.133,49.835,3.243,74.859,3.243c25.024,0,50.027-1.067,74.859-3.243l112.939-9.813c38.659-3.187,68.348-35.6,68.139-74.389
	V154.704C512.194,115.877,482.436,83.459,443.734,80.336z"/>
<path style="fill:#FAFAFA;" d="M357.782,247.077l-149.333-96c-4.951-3.193-11.552-1.768-14.745,3.183
	c-1.111,1.722-1.702,3.728-1.703,5.777v192c0.002,5.891,4.78,10.665,10.671,10.663c2.049-0.001,4.055-0.592,5.777-1.703l149.333-96
	c4.954-3.187,6.387-9.787,3.2-14.742c-0.825-1.283-1.917-2.374-3.2-3.2V247.077z"/>
<path d="M256.001,444.816c-25.003,0-50.005-1.088-74.837-3.243l-112.896-9.835c-38.71-3.124-68.471-35.554-68.267-74.389V154.683
	c-0.182-38.819,29.573-71.224,68.267-74.347l112.896-9.899c49.797-4.334,99.877-4.334,149.675,0l112.96,9.813
	c38.717,3.158,68.454,35.629,68.203,74.475v202.667c0.204,38.835-29.557,71.265-68.267,74.389l0,0l-112.96,9.813
	C306.028,443.771,281.004,444.816,256.001,444.816z M256.001,88.549c-24.405,0-48.768,1.067-72.981,3.157L69.953,101.52
	c-27.614,2.317-48.794,25.495-48.619,53.205v202.667c-0.116,27.7,21.097,50.827,48.704,53.099l112.96,9.813
	c48.57,4.209,97.414,4.209,145.984,0l113.067-9.813c27.589-2.315,48.76-25.456,48.619-53.141V154.683
	c0.116-27.7-21.097-50.827-48.704-53.099l-112.96-9.813c-24.235-2.105-48.569-3.164-73.003-3.179V88.549z"/>
<path d="M202.668,362.704c-5.891,0-10.667-4.776-10.667-10.667v-192c-0.01-5.891,4.758-10.674,10.649-10.684
	c2.057-0.003,4.07,0.588,5.799,1.703l149.333,96c4.96,3.178,6.405,9.776,3.227,14.736c-0.83,1.296-1.931,2.397-3.227,3.227
	l-149.333,96C206.724,362.124,204.717,362.709,202.668,362.704z M213.334,179.579v152.917l118.933-76.459L213.334,179.579z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <br> <b>  Video </b>
            </button>
        </a>
</form>

  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-body">

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div id="video-view" class="embed-responsive embed-responsive-16by9">

          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Malware Analysis III</a><ul>
<li><a class="reference internal" href="#more-on-packing">More on packing</a><ul>
<li><a class="reference internal" href="#why-packing">Why packing?</a></li>
<li><a class="reference internal" href="#how-to-know-if-my-file-is-packed">How to know if my file is packed</a></li>
<li><a class="reference internal" href="#packing-challenges">Packing: challenges</a></li>
<li><a class="reference internal" href="#detect-it-easy-die">Detect it easy (DIE)</a></li>
<li><a class="reference internal" href="#unpacking-get-back-original-binary">Unpacking: get back original binary</a></li>
<li><a class="reference internal" href="#upx-what-is-it"><code class="docutils literal"><span class="pre">UPX</span></code>: what is it ?</a><ul>
<li><a class="reference internal" href="#execution-of-upx-packed-file">Execution of UPX packed file</a></li>
<li><a class="reference internal" href="#illustration">Illustration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unpacking-tricks">Unpacking tricks</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="malware-analysis-iii">
<h1>Malware Analysis III<a class="headerlink" href="#malware-analysis-iii" title="Permalink to this headline">¶</a></h1>
<div class="section" id="more-on-packing">
<h2>More on packing<a class="headerlink" href="#more-on-packing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-packing">
<h3>Why packing?<a class="headerlink" href="#why-packing" title="Permalink to this headline">¶</a></h3>
<p>To compress a file and reduce its size but also to obfuscate a file.</p>
<ul class="simple">
<li>Well known packers: <code class="docutils literal"><span class="pre">UPX,</span> <span class="pre">THEMIDA</span></code> , … (can be combined</li>
<li>Warning: Algorithms may vary with architecture (32 or 64 bits)</li>
</ul>
</div>
<div class="section" id="how-to-know-if-my-file-is-packed">
<h3>How to know if my file is packed<a class="headerlink" href="#how-to-know-if-my-file-is-packed" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">PE</span></code> or <code class="docutils literal"><span class="pre">ELF</span></code> file with unclassic sections</li>
<li>Few dynamic links</li>
</ul>
<p class="centered">
<strong><em>Unpacked</em></strong></p><img alt="../_images/48.PNG" class="align-center" src="../_images/48.PNG" style="width: 407.20000000000005px; height: 338.40000000000003px;" />
<p class="centered">
<strong><em>Packed</em></strong></p><img alt="../_images/49.PNG" class="align-center" src="../_images/49.PNG" style="width: 295.2px; height: 36.0px;" />
</div>
<div class="section" id="packing-challenges">
<h3>Packing: challenges<a class="headerlink" href="#packing-challenges" title="Permalink to this headline">¶</a></h3>
<p>Difficulties with packing:</p>
<ol class="arabic simple">
<li>To identify which packer has been used</li>
<li>To unpack the file</li>
</ol>
<p><strong>Solutions:</strong></p>
<ul class="simple">
<li>PIED, OLLYDBG, YARA rules , detect it easy (DIE), machine learning</li>
<li>Call the packer itself , or disassemble if the functionality does not
exists</li>
</ul>
</div>
<div class="section" id="detect-it-easy-die">
<h3>Detect it easy (DIE)<a class="headerlink" href="#detect-it-easy-die" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/50.PNG" class="align-center" src="../_images/50.PNG" style="width: 317.4px; height: 189.29999999999998px;" />
<p>DIE is based on Yara!</p>
</div>
<div class="section" id="unpacking-get-back-original-binary">
<h3>Unpacking: get back original binary<a class="headerlink" href="#unpacking-get-back-original-binary" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When you execute the packed file, you’ll reveal the true behavior of
your file at dynamic level but this does not mean that you’ll get back
the original code, i.e., you cannot do any type of static analysis.</div>
</div>
<div class="line-block">
<div class="line">To get back the original binary code you need to unpack the file and
dump the memory at the right moment.</div>
</div>
<ul class="simple">
<li>Right moment <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> when the cypher process has been reversed .</li>
</ul>
</div>
<div class="section" id="upx-what-is-it">
<h3><code class="docutils literal"><span class="pre">UPX</span></code>: what is it ?<a class="headerlink" href="#upx-what-is-it" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">UPX</span></code> uses a data compression algorithm called <code class="docutils literal"><span class="pre">UCL</span></code></li>
<li><code class="docutils literal"><span class="pre">UPX</span></code> (since 2.90 beta) can use <code class="docutils literal"><span class="pre">LZMA</span></code> (data compression based on
Markov Chains) on most platforms; however, this is disabled by
default for 16 bit due to slow decompression speed on older computers
(use lzma to force it on)</li>
<li>Starting with version 3.91, <code class="docutils literal"><span class="pre">UPX</span></code> also supports 64 Bit (x64)
executable files on the Windows platform. This feature is currently
declared as experimental</li>
</ul>
<div class="section" id="execution-of-upx-packed-file">
<h4>Execution of UPX packed file<a class="headerlink" href="#execution-of-upx-packed-file" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Assume a 32 bits architecture</div>
</div>
<div class="line-block">
<div class="line">There is a clear pattern to the unpacker code section:</div>
</div>
<ol class="arabic simple">
<li>Push all the registers with <code class="docutils literal"><span class="pre">pushad</span></code></li>
<li>Unpacks the code in physical memory (Lots of rewritting of sections)</li>
<li>Pop back all registers using <code class="docutils literal"><span class="pre">popad</span></code></li>
<li>Jump to unpacked code</li>
<li>Run it!</li>
</ol>
<img alt="../_images/51.PNG" class="align-center" src="../_images/51.PNG" style="width: 132.0px; height: 164.0px;" />
<p>Unpacking UPX is relatively easy</p>
<ol class="arabic simple">
<li>Put a break point after <code class="docutils literal"><span class="pre">popad</span></code></li>
<li>Follow the next jump</li>
<li><strong>Dump</strong> starting from jump destination (it become new entry point
address)</li>
<li>Restore import table with respect to new entry point address</li>
</ol>
<p><strong>Important observation:</strong></p>
<ul class="simple">
<li>this requires to disassemble the file!</li>
</ul>
</div>
<div class="section" id="illustration">
<h4>Illustration<a class="headerlink" href="#illustration" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/52.PNG" class="align-center" src="../_images/52.PNG" style="width: 638.0px; height: 352.5px;" />
<img alt="../_images/53.PNG" class="align-center" src="../_images/53.PNG" style="width: 714.0px; height: 347.5px;" />
<img alt="../_images/55.png" class="align-center" src="../_images/55.png" style="width: 651.0px; height: 394.5px;" />
<img alt="../_images/56.PNG" class="align-center" src="../_images/56.PNG" style="width: 628.5px; height: 337.0px;" />
<p><strong>Important observation:</strong></p>
<ul class="simple">
<li>this requires to disassemble the file!</li>
<li><code class="docutils literal"><span class="pre">pushad</span></code> and <code class="docutils literal"><span class="pre">popad</span></code> do not exist on 64bit architectures. But one
can still check for double 0 repetitions</li>
</ul>
<img alt="../_images/57.PNG" class="align-center" src="../_images/57.PNG" style="width: 350.0px; height: 179.5px;" />
</div>
</div>
<div class="section" id="unpacking-tricks">
<h3>Unpacking tricks<a class="headerlink" href="#unpacking-tricks" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Put breakpoints at the end of loops: At this point try to re analyze
the binary for new assembly routines</li>
<li>Look for calls that don’t return or jumps with no code after them</li>
<li>Look for long jumps that jump into a different section: These can
indicate a jump from the unpacking stub and the binary itself</li>
<li>Look for <code class="docutils literal"><span class="pre">pushad</span></code> . Sent a memory breakpoint on these stack
addresses, which should break on the corresponding <code class="docutils literal"><span class="pre">popad</span></code> . These
are often used to save the context for main.</li>
<li>Add breakpoints on <code class="docutils literal"><span class="pre">GetVersion</span></code> or <code class="docutils literal"><span class="pre">GetCommandLineA</span></code> : These are
often called from the normal main wrapper that windows compilers add
<code class="docutils literal"><span class="pre">GetModuleHandle</span></code> for GUI apps</li>
<li>Some more advanced unpacker only unpack ‘on demand’, meaning that the
whole binary is never fully unpacked unless you touch all
functionality. This can usually be avoided by scripting your debugger
to call the appropriate unpacking routines</li>
</ul>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Memory dump and memory forensics can be used in many situations</li>
<li>Dynamic analysis sometimes ) can go further than static analysis</li>
<li>But dynamic analysis can also easily be bypassed</li>
<li>Indeed, malware can detect if they’re in a virtualized environment</li>
<li><strong>Solution:</strong> let us do some research and take the best of boths</li>
</ol>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Duchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>