
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How to obtain malware sample ? The honey pot approach &#8212; Theory 2020 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/LINGI2144-Secured-System-Engineering-Syllabus/_build/html/index.html">Main</a></li>
                <li><a href="https://github.com/ElNiak/LINGI2144-Secured-System-Engineering-Syllabus.git">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#additional-content">Additional content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#the-off-by-one-vulnerability">The “off by one vulnerability”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Malware Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#id5">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#dynamic-analysis">Dynamic Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">How to obtain malware sample ? The honey pot approach</a><ul>
<li><a class="reference internal" href="#catching-malware-samples">Catching malware samples</a></li>
<li><a class="reference internal" href="#honeypots">Honeypots</a><ul>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#some-great-tutorial">Some great tutorial:</a></li>
<li><a class="reference internal" href="#some-honey-pots">Some honey pots</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-case-of-mirai">The case of Mirai</a></li>
<li><a class="reference internal" href="#how-to-catch-a-mirai">How to catch a Mirai</a></li>
<li><a class="reference internal" href="#from-observation-to-analysis-and-detection">From observation to analysis and detection</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="how-to-obtain-malware-sample-the-honey-pot-approach">
<h1>How to obtain malware sample ? The honey pot approach<a class="headerlink" href="#how-to-obtain-malware-sample-the-honey-pot-approach" title="Permalink to this headline">¶</a></h1>
<div class="section" id="catching-malware-samples">
<h2>Catching malware samples<a class="headerlink" href="#catching-malware-samples" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">It is important to collect and analyze new data corresponding to new
malware. It is also important to observe variant of known malware
(<strong>same family</strong>), example: change of payload in the Mirai malware.</div>
<div class="line">Looking for actions, code, … FROM WHERE A SIGNATURE WILL BE EXTRACTED.
For doing so, one has to deploy “traps”. In the malware world, they
are known under the name of “honeypots”.</div>
</div>
</div>
<div class="section" id="honeypots">
<h2>Honeypots<a class="headerlink" href="#honeypots" title="Permalink to this headline">¶</a></h2>
<p>A <strong>honeypot</strong> is a <strong>system</strong> that is intentionally left vulnerable to
catch attacks and malware and study their behavior. The honeypot records
the behavior of the attacker and saves all the files dropped to an
external location, then reflashes itself. Idea attributed to Bill
Cheswick , played with a pirate who was exploiting a vulnerability in
the sendmail daemon (1991).</p>
<div class="section" id="objectives">
<h3>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h3>
<p>Let the attacker believe that she can control the system. This allows
the administrator to observe what the attacker uses to compromise the
system.</p>
<ol class="arabic simple">
<li>Spies the network</li>
<li>Collect informations</li>
<li>Analyse information</li>
</ol>
<p><strong>Different level of control</strong>: weak , middle and strong interactions.</p>
<ol class="arabic">
<li><p class="first"><strong>Weak interactions</strong><em>Emulate</em> services, but offer no response.
Allows us to perform statistic:</p>
<ul class="simple">
<li>Which port is under attack?</li>
<li>Which malware (in case information is in first packet)?</li>
</ul>
<div class="line-block">
<div class="line">Example: <code class="docutils literal"><span class="pre">netcat</span></code> that listen to a port and log all commands sent
by attacker.</div>
<div class="line">Others: honeytrap</div>
</div>
<blockquote>
<div><img alt="../_images/31.PNG" class="align-center" src="../_images/31.PNG" style="width: 407.04999999999995px; height: 241.14999999999998px;" />
</div></blockquote>
</li>
</ol>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line"><strong>Middle interactions</strong> Problem with weak interaction: no response.</div>
<div class="line">Solution: Middle interaction:</div>
</div>
<ul class="simple">
<li>respond with what the attacker expects (emulates a dedicated
service)</li>
<li>She trusts it and send more</li>
</ul>
<blockquote>
<div><img alt="../_images/32.PNG" class="align-center" src="../_images/32.PNG" style="width: 409.5px; height: 179.89999999999998px;" />
</div></blockquote>
<ul class="simple">
<li>Payload is analyzed in a virtual machine (not always easy to put
in place!)</li>
</ul>
<blockquote>
<div><img alt="../_images/33.PNG" class="align-center" src="../_images/33.PNG" style="width: 418.59999999999997px; height: 170.1px;" />
</div></blockquote>
<p>Example: <code class="docutils literal"><span class="pre">nepenthes</span></code></p>
<ul class="simple">
<li>Web server IIS with webdav known to be vulnerable to buffer
overflow (2003)</li>
<li>Implement fake version that let the attacker exploit the
vulnerability</li>
<li>In case attacker exploits vulnerability, emulate a virtual machine
to analyse the content</li>
</ul>
</li>
<li><div class="first line-block">
<div class="line"><strong>Strong interactions</strong> Middle interaction problem: it is not
difficult to detect if we are in a virtual environment.</div>
<div class="line">Solution: Let the attacker to have access to the full system</div>
</div>
<ul class="simple">
<li>Allows us to discover new attacks</li>
<li>More dangerous as the full system is vulnerable</li>
<li>But very useful to detect new types of attacks</li>
</ul>
<blockquote>
<div><img alt="../_images/34.PNG" class="align-center" src="../_images/34.PNG" style="width: 402.84999999999997px; height: 172.54999999999998px;" />
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="some-great-tutorial">
<h3>Some great tutorial:<a class="headerlink" href="#some-great-tutorial" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference external" href="https://www.cse.wustl.edu/~jain/cse571-09/ftp/honey.pdf">https://www.cse.wustl.edu/~jain/cse571-09/ftp/honey.pdf</a></div>
<div class="line"><a class="reference external" href="https://www.diva-portal.org/smash/get/diva2:327476/FULLTEXT01.pdf">https://www.diva-portal.org/smash/get/diva2:327476/FULLTEXT01.pdf</a></div>
</div>
</div>
<div class="section" id="some-honey-pots">
<h3>Some honey pots<a class="headerlink" href="#some-honey-pots" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Mostly ssh services, can reply messages to another honey pot:
<img class="math" src="../_images/math/b1ccd922769a4761063130f111ef2545c9412782.png" alt="\left\{\begin{tabular}{&#64;{}r}
Cowrie\\
Kippo\\
Glastopf
\end{tabular}\right."/></div>
</div>
<p>Dionaea: against worms, effective for WannaCry</p>
</div>
</div>
<div class="section" id="the-case-of-mirai">
<h2>The case of Mirai<a class="headerlink" href="#the-case-of-mirai" title="Permalink to this headline">¶</a></h2>
<p>The Mirai flow of attack is known.</p>
<ul class="simple">
<li><strong>What we hunt:</strong> the code deployed depending on the architecture</li>
<li>Objective: to catch different versions to study variants of the
malware</li>
<li>To generate different malware signatures! (or even to predict new
ones)</li>
</ul>
<p>Again, the interesting part is the code that is deployed. We do not need
to let the code be executed, just catch it!</p>
<ul class="simple">
<li>Conclusion: A middle interaction honeypot is sufficient</li>
</ul>
<p>The <em>Cowrie</em> honey pot can be used to emulates an ARM IoT device. We
assume that this device accepts all connections attempts and store any
attempt to load a file into the honey pot.</p>
</div>
<div class="section" id="how-to-catch-a-mirai">
<h2>How to catch a Mirai<a class="headerlink" href="#how-to-catch-a-mirai" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>Bot scan</strong> How do you recognize when an attack comes from a Mirai
bot?</div>
<div class="line">Connects to port 23 (Telnet), tries to login with hardcoded
usernames and passwords, if successful runs the following commands:</div>
</div>
<blockquote>
<div><img alt="../_images/35.PNG" class="align-center" src="../_images/35.PNG" style="width: 455.7px; height: 120.05px;" />
</div></blockquote>
<div class="line-block">
<div class="line">If the commands above succeed, a Mirai server will contact you
next.</div>
<div class="line"><code class="docutils literal"><span class="pre">busybox</span></code> is file that emulate many version of linux.</div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line"><strong>C&amp;C server attack</strong></div>
<div class="line">The Mirai server will connect with the same credentials and
execute:</div>
</div>
<blockquote>
<div><img alt="../_images/36.PNG" class="align-center" src="../_images/36.PNG" style="width: 509.59999999999997px; height: 179.2px;" />
</div></blockquote>
<p>It try to have information about the mounted system since it try to
inject the mirai payload but the only way to do this is to write
something in you.</p>
</li>
<li><p class="first"><strong>Server attack</strong> Each mounted file system &lt;DIR&gt; found is tested for
writability by trying to write a file on it and see if its content
matches:</p>
<p><code class="docutils literal"><span class="pre">echo</span> <span class="pre">-e</span> <span class="pre">'\\x6b\\x61\\x6d</span> <span class="pre">\\x69</span> <span class="pre">&lt;DIR&gt;'&gt;</span> <span class="pre">&lt;./nippon/busybox</span> <span class="pre">cat&gt;</span> <span class="pre">&lt;DIR&gt;/.nippon/busybox</span> <span class="pre">rm</span> <span class="pre">&lt;DIR&gt;/.nippon</span></code></p>
<p>If it finds a writable &lt;DIR&gt; it moves to it and analyzes
<code class="docutils literal"><span class="pre">/bin/echo</span></code> and <code class="docutils literal"><span class="pre">/proc/cpuinfo</span></code> to determine the CPU architecture
(to adapt and know if victim is good candidate):</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;DIR&gt;
/busybox cp /bin/echo dvrHelper
dvrHelper
/busybox chmod <span class="m">777</span> &gt; dvrHelper
/busybox ECCHI
cat /proc/ cpuinfo
</pre></div>
</div>
</div></blockquote>
<p>Finally, the Mirai server uses <code class="docutils literal"><span class="pre">wget</span></code> or <code class="docutils literal"><span class="pre">tftp</span></code> to download and execute the Mirai
downloader for the correct architecture. The downloader downloads and
executes the Mirai bot for the correct architecture …so your
honeypot will record all the instructions executed by Mirai bot,
server, and downloader, and samples of the downloader and bot, and
save all of them somewhere for further analysis. Then the honeypot
with reflash itself to disinfect itself. That’s how you collect
malware samples and make sure it’s Mirai.</p>
</li>
</ol>
</div>
<div class="section" id="from-observation-to-analysis-and-detection">
<h2>From observation to analysis and detection<a class="headerlink" href="#from-observation-to-analysis-and-detection" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Honeypots are there to spy, collect, analyse</li>
<li>They lure the attacker</li>
<li>They are not intrusion detection systems/anti-virus (study, no
reaction)</li>
<li>Indeed, its up to you to decide if honeypot content correspond to a
malicious action</li>
<li>This information can be used to feed a malware analysis system</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/malware_analysis/malware_sample.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Dûchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>