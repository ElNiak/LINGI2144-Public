
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Malware Analysis II &#8212; Theory 2020 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Theory 2020 documentation" href="../index.html" />
    <link rel="next" title="Malware Analysis III" href="../malware_analysisIII/packing.html" />
    <link rel="prev" title="Malware Analysis I" href="../malware_analysisI/introduction.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/index.html">Main</a></li>
                <li><a href="/exercice/index.html">Tutorial</a></li>
                <li><a href="/qcm/index.html">MCQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#am-i-allowed-to-do-that">Am I allowed to do that?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#the-blaster-lovesan-worm">The Blaster/Lovesan worm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#the-off-by-one-vulnerability">The &#8220;off by one vulnerability&#8221;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#facts">Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisI/introduction.html">Malware Analysis I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Malware Analysis II</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#malware-analysis">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-analysis">Dynamic Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisIII/packing.html">Malware Analysis III</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisIII/packing.html#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="row" style="padding-top: 20px">
    <div class="col-xs-6">
        <form id="rar_tp"  target="_blank" style="text-align:center;" method="get" action="">
            <button style="text-align:center; border-radius:12px;" type="submit" class="up">
                <svg id="Capa_1"
                     width="50px" height="50px"
                     enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m453.31 460.125c0 24.508-19.907 44.375-44.464 44.375h-305.692c-24.557 0-44.464-19.867-44.464-44.375v-408.25c0-24.508 19.907-44.375 44.464-44.375h190.303c8.857 0 17.35 3.516 23.606 9.773l126.505 126.521c6.239 6.239 9.742 14.694 9.742 23.508z" fill="#f9f8f9"/><path d="m133.15 504.5h-30c-24.55 0-44.46-19.87-44.46-44.38v-408.24c0-24.51 19.91-44.38 44.46-44.38h30c-24.55 0-44.46 19.87-44.46 44.38v408.24c0 24.51 19.91 44.38 44.46 44.38z" fill="#e3e0e4"/><path d="m453.31 167.3v16.24h-115.96c-33.12 0-60.06-26.95-60.06-60.07v-115.97h16.17c8.85 0 17.35 3.52 23.6 9.77l126.51 126.52c6.24 6.24 9.74 14.7 9.74 23.51z" fill="#e3e0e4"/><path d="m450.32 153.54h-112.97c-16.6 0-30.06-13.46-30.06-30.07v-112.96c3.61 1.63 6.92 3.91 9.77 6.76l126.51 126.52c2.85 2.85 5.12 6.15 6.75 9.75z" fill="#b9a1d3"/><path d="m435 438.5h-358c-22.091 0-40-17.909-40-40v-146c0-22.091 17.909-40 40-40h358c22.091 0 40 17.909 40 40v146c0 22.091-17.909 40-40 40z" fill="#b9a1d3"/><path d="m102 438.5h-25c-22.09 0-40-17.91-40-40v-146c0-22.09 17.91-40 40-40h25c-22.09 0-40 17.91-40 40v146c0 22.09 17.91 40 40 40z" fill="#9573bb"/></g><g><path d="m58.689 153.851c4.143 0 7.5-3.357 7.5-7.5v-94.476c0-20.333 16.582-36.875 36.965-36.875h111.42c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-111.42c-28.653 0-51.965 23.271-51.965 51.875v94.476c0 4.142 3.358 7.5 7.5 7.5z"/><path d="m460.811 212.656v-45.354c0-10.879-4.24-21.111-11.938-28.811l-126.506-126.52c-7.718-7.72-17.985-11.971-28.91-11.971h-43.394c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h43.394c2.165 0 4.288.264 6.334.775v107.696c0 20.714 16.85 37.566 37.561 37.566h107.694c.505 2.025.765 4.125.765 6.265v38.954c-3.476-.812-7.092-1.256-10.811-1.256h-23.319c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h23.319c17.921 0 32.5 14.579 32.5 32.5v146c0 17.921-14.579 32.5-32.5 32.5h-268.66c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h268.66c3.719 0 7.335-.444 10.811-1.256v15.381c0 20.333-16.582 36.875-36.965 36.875h-305.692c-20.383 0-36.965-16.542-36.965-36.875v-15.381c3.476.812 7.092 1.256 10.811 1.256h53.319c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-53.319c-17.921 0-32.5-14.579-32.5-32.5v-146c0-17.921 14.579-32.5 32.5-32.5h299.702c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-299.702c-3.719 0-7.335.444-10.811 1.256v-24.905c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v31.305c-13.04 8.477-21.689 23.165-21.689 39.844v146c0 16.679 8.649 31.367 21.689 39.844v21.781c0 28.604 23.312 51.875 51.965 51.875h305.691c28.653 0 51.965-23.271 51.965-51.875v-21.781c13.041-8.477 21.689-23.165 21.689-39.844v-146c.001-16.679-8.648-31.367-21.688-39.844zm-146.02-89.185v-97.863l120.414 120.429h-97.854c-12.439 0-22.56-10.123-22.56-22.566z"/><path d="m265.669 264.091c-1.584-3.853-5.297-6.341-9.462-6.341-.003 0-.006 0-.009 0-4.168.004-7.882 2.499-9.461 6.356-.023.057-.046.114-.067.172l-45.247 118.803c-1.475 3.87.469 8.203 4.34 9.678 3.865 1.475 8.203-.468 9.678-4.34l9.429-24.757h62.347l9.335 24.736c1.458 3.914 5.891 5.823 9.665 4.368 3.875-1.462 5.831-5.789 4.368-9.665l-44.836-118.808c-.025-.067-.053-.135-.08-.202zm-35.087 84.571 25.603-67.226 25.37 67.226z"/><path d="m181.648 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.588-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/><path d="m410.5 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.589-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/></g></g>
                </svg>
                <br> <b> Slides </b>
            </button>
        </form>
    </div>
    <div class="col-xs-6">
        <form id="vid_tp" style="text-align:center;">
	<a id="notUp"  href="#!" style="text-align:center;"
   data-title="Watch now on youtube">
            <button class="video-btn up" onclick="topFunction()"
                    style="text-align:center; border-radius:12px;" data-toggle="modal" type="button"
                    data-target="#myModal"
                    data-src="">
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg width="50px" height="50px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512.003 512.003" style="enable-background:new 0 0 512.003 512.003;" xml:space="preserve">
<path style="fill:#E53935;" d="M443.734,80.336L330.86,70.437c-49.812-4.334-99.906-4.334-149.717,0L68.268,80.336
	c-38.702,3.124-68.459,35.541-68.267,74.368v202.667c-0.204,38.835,29.557,71.265,68.267,74.389l112.939,9.813
	c24.832,2.133,49.835,3.243,74.859,3.243c25.024,0,50.027-1.067,74.859-3.243l112.939-9.813c38.659-3.187,68.348-35.6,68.139-74.389
	V154.704C512.194,115.877,482.436,83.459,443.734,80.336z"/>
<path style="fill:#FAFAFA;" d="M357.782,247.077l-149.333-96c-4.951-3.193-11.552-1.768-14.745,3.183
	c-1.111,1.722-1.702,3.728-1.703,5.777v192c0.002,5.891,4.78,10.665,10.671,10.663c2.049-0.001,4.055-0.592,5.777-1.703l149.333-96
	c4.954-3.187,6.387-9.787,3.2-14.742c-0.825-1.283-1.917-2.374-3.2-3.2V247.077z"/>
<path d="M256.001,444.816c-25.003,0-50.005-1.088-74.837-3.243l-112.896-9.835c-38.71-3.124-68.471-35.554-68.267-74.389V154.683
	c-0.182-38.819,29.573-71.224,68.267-74.347l112.896-9.899c49.797-4.334,99.877-4.334,149.675,0l112.96,9.813
	c38.717,3.158,68.454,35.629,68.203,74.475v202.667c0.204,38.835-29.557,71.265-68.267,74.389l0,0l-112.96,9.813
	C306.028,443.771,281.004,444.816,256.001,444.816z M256.001,88.549c-24.405,0-48.768,1.067-72.981,3.157L69.953,101.52
	c-27.614,2.317-48.794,25.495-48.619,53.205v202.667c-0.116,27.7,21.097,50.827,48.704,53.099l112.96,9.813
	c48.57,4.209,97.414,4.209,145.984,0l113.067-9.813c27.589-2.315,48.76-25.456,48.619-53.141V154.683
	c0.116-27.7-21.097-50.827-48.704-53.099l-112.96-9.813c-24.235-2.105-48.569-3.164-73.003-3.179V88.549z"/>
<path d="M202.668,362.704c-5.891,0-10.667-4.776-10.667-10.667v-192c-0.01-5.891,4.758-10.674,10.649-10.684
	c2.057-0.003,4.07,0.588,5.799,1.703l149.333,96c4.96,3.178,6.405,9.776,3.227,14.736c-0.83,1.296-1.931,2.397-3.227,3.227
	l-149.333,96C206.724,362.124,204.717,362.709,202.668,362.704z M213.334,179.579v152.917l118.933-76.459L213.334,179.579z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <br> <b>  Video </b>
            </button>
        </a>
</form>

  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-body">

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div id="video-view" class="embed-responsive embed-responsive-16by9">

          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Malware Analysis II</a><ul>
<li><a class="reference internal" href="#malware-analysis">Malware Analysis</a></li>
<li><a class="reference internal" href="#static-analysis">Static Analysis</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#static-analysis-signatures-are-sequences-of-strings">Static Analysis: Signatures are sequences of strings</a></li>
<li><a class="reference internal" href="#static-analysis-processing-new-files">Static Analysis: processing new files</a></li>
<li><a class="reference internal" href="#malware-detection-static-via-yara">Malware detection static via <code class="docutils literal"><span class="pre">YARA</span></code></a><ul>
<li><a class="reference internal" href="#automatized-in-a-tool-yargen">Automatized in a tool: yarGen</a></li>
<li><a class="reference internal" href="#process">Process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#static-analysis-syntactic-pattern-matching-obfuscation">Static Analysis: Syntactic Pattern Matching: Obfuscation</a></li>
<li><a class="reference internal" href="#problem-packing-detection">Problem: Packing Detection</a></li>
<li><a class="reference internal" href="#packing-detection-ground-truth">Packing Detection: Ground Truth</a></li>
<li><a class="reference internal" href="#packing-detection-ml-classifiers">Packing Detection: ML Classifiers</a></li>
<li><a class="reference internal" href="#packing-detection-preliminary-results">Packing Detection: Preliminary Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-analysis">Dynamic Analysis</a><ul>
<li><a class="reference internal" href="#dynamic-analysis-virtualized-environment">Dynamic Analysis: virtualized environment</a><ul>
<li><a class="reference internal" href="#tools-software">Tools/software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computer-system-abstract-architecture">Computer system : abstract architecture</a><ul>
<li><a class="reference internal" href="#sandbox">Sandbox</a></li>
<li><a class="reference internal" href="#virtual-machines">Virtual machines</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-memory-forensics">What is memory forensics ?</a></li>
<li><a class="reference internal" href="#memory-dump-and-memory-profil">Memory dump and memory profil</a></li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-linux">Sample of tools to dump memory (Linux)</a><ul>
<li><a class="reference internal" href="#lime-illustration">Lime: Illustration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-windows">Sample of tools to dump memory (Windows)</a></li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-disassembler">Sample of tools to dump memory (disassembler)</a></li>
<li><a class="reference internal" href="#the-volatility-framework">The <code class="docutils literal"><span class="pre">volatility</span></code> framework</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#supports">Supports</a></li>
<li><a class="reference internal" href="#profile-creation-linux">Profile creation (linux)</a></li>
<li><a class="reference internal" href="#quick-usage-illustration">Quick usage illustration</a></li>
<li><a class="reference internal" href="#a-note-on-installation">A note on installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relation-with-virtual-machine">Relation with virtual machine</a></li>
<li><a class="reference internal" href="#the-limit-of-static-yara-analysis">The limit of static yara analysis</a></li>
<li><a class="reference internal" href="#dynamic-yara-analysis-in-action">Dynamic Yara analysis in action</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="malware-analysis-ii">
<h1>Malware Analysis II<a class="headerlink" href="#malware-analysis-ii" title="Permalink to this headline">¶</a></h1>
<div class="section" id="malware-analysis">
<h2>Malware Analysis<a class="headerlink" href="#malware-analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>Objective</strong>: Classification of an executable binary as clean or
malicious (+ malware type/family if possible)</p>
<ul class="simple">
<li>Always the same principle:<ul>
<li>Characterize the malwares you know with signatures</li>
<li>Try to detect it in new files under analyses.</li>
</ul>
</li>
<li>Detection process leads to several types of analysis<ul>
<li>First one: <strong>static analysis</strong> (read content of the file)</li>
<li>The <strong>signature</strong> is a (combination of) string(s) + static
properties (features)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="static-analysis">
<h2>Static Analysis<a class="headerlink" href="#static-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">malicious_behavior</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I am evil!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">malicious_behavior</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The malware’s behavior is to print the string “I am evil!!!”.</div>
</div>
<div class="line-block">
<div class="line">We will look for programs that produce this string but how do we
determine if a program has this malicious behavior ? How to know that
this string is indeed the malicious behavior to hunt?</div>
</div>
</div>
<div class="section" id="static-analysis-signatures-are-sequences-of-strings">
<h3>Static Analysis: Signatures are sequences of strings<a class="headerlink" href="#static-analysis-signatures-are-sequences-of-strings" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Principle</strong>: look for relevant strings in the binary ( that’s your
signature</li>
<li>How do the signatures look like?<ul>
<li>composed of characteristic strings extracted from the malware</li>
<li>other property that can be quickly verified without executing,
e.g., hash and size</li>
</ul>
</li>
<li>How do we extract the signature from a binary?<ul>
<li>major challenge, but when you’ve it you’re happy!</li>
<li>avoid false positive, false negative</li>
</ul>
</li>
<li>Before talking about the extraction, let us see what we can do when
we have it!</li>
</ul>
</div>
<div class="section" id="static-analysis-processing-new-files">
<h3>Static Analysis: processing new files<a class="headerlink" href="#static-analysis-processing-new-files" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Challenge</strong>: How to detect a potential new malware M1?</li>
<li><strong>Solution:</strong><ul>
<li>Compile all signatures of known malwares in a regular expression
(<strong>classification</strong>)</li>
<li>and scan the binary of M1 to see if any part matches
(<strong>detection</strong>)</li>
</ul>
</li>
<li>This is a <strong>Pattern matching</strong> approach (remember your translator
class!)</li>
<li>It is mostly performed via <strong>automata</strong>:<ul>
<li>Turn regular expression into automaton</li>
<li>Walk M1 file in the automaton and check if you reach an accepting
state</li>
</ul>
</li>
<li>A well known tool: <code class="docutils literal"><span class="pre">YARA</span></code></li>
</ul>
</div>
<div class="section" id="malware-detection-static-via-yara">
<h3>Malware detection static via <code class="docutils literal"><span class="pre">YARA</span></code><a class="headerlink" href="#malware-detection-static-via-yara" title="Permalink to this headline">¶</a></h3>
<p>Yara <strong>IS:</strong></p>
<ul class="simple">
<li><strong>Elegant way to specify any type of regular expression</strong></li>
<li>Fast and efficient at detection</li>
<li>Look for syntactic properties of file</li>
<li>Does not execute the sample during analysis (i.e. static)</li>
<li>Plugins to python and other languages</li>
<li>Protections against <strong>REGEX attacks</strong><ul>
<li>Remember : Regular expression are turned into automaton</li>
<li>If automaton is deterministic then one path</li>
<li>If automaton is non deterministic which arises for complex regular
expressions), then exponential number of paths</li>
<li>Example:<ul>
<li>regular expression: <code class="docutils literal"><span class="pre">[a-z]+&#64;[a-z]+([a-z</span> <span class="pre">\.]+.]+\.)+[a-z]+</span></code>
for mail</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Yara <strong>IS NOT:</strong></p>
<ul class="simple">
<li>a virus scanner (but act very similar to existing anti virus)</li>
<li>a correlation engine</li>
<li>a bayesian classifier</li>
<li>Or more generally: an artificial intelligence</li>
</ul>
<p>Rules can be very complex, but can be written in a very effective manner <a class="footnote-reference" href="#id3" id="id1">[3]</a></p>
<div class="highlight-c"><div class="highlight"><pre><span></span>rule 2018ISOLLATutorialYaraSimpler {
    meta:
        description = &quot;Simpler Yara rule for ISOLA 2018&quot;
    strings:
        $evil_string = &quot;i am evil&quot; wide ascii
    condition:
        $evil_string
}
</pre></div>
</div>
<p><strong>Main difficulty</strong>: how to write good (effective) YARA rules? I.e. How
to identify and extract malicious knowledge from a known database?</p>
<ul>
<li><p class="first"><strong>Things to avoid:</strong></p>
<ol class="arabic simple">
<li>Rules that generate many false positives and</li>
<li>Rules that match only the specific sample and are not much better
than a hashvalue.</li>
</ol>
</li>
<li><p class="first"><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p class="first">Comparison with cleanware database (<strong>reduce false positive</strong>
<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> Happens when the rule claims it is a malware, but it is
not)</p>
<ol class="arabic simple">
<li>Take a huge database of cleanware</li>
<li>Take a malware</li>
<li>Create a rule with strings that are specific to malware, and
not present (or almost not present) in the cleanware</li>
</ol>
<p>May generate plenty of strings</p>
<ol class="arabic simple">
<li>Take the x best ones</li>
<li>Best has to be defined.</li>
</ol>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">yarGen</span></code>: Keep strings that are likely to not be in goodware.</div>
<div class="line">Avoid false positive: Do not claim it is a malware if it not</div>
<div class="line"><strong>Danger</strong>:</div>
</div>
<ul class="simple">
<li>Rules may become too specific</li>
<li>Strings that were present in the sample used as malware may not
be part of the malware</li>
<li>And hence not present in another iteration of the same malware</li>
<li>Consequence: no detection!</li>
</ul>
<p>Example
<a class="reference external" href="https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/">https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/</a>
(<strong>ToREAD</strong>)</p>
</li>
<li><div class="first line-block">
<div class="line">Good practice (<strong>avoid false negative</strong>, less specific)</div>
<div class="line">Best practice by Florian Roth:</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>Very specific strings</strong> ($s) s)<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> hard indicators
for a malicious sample</div>
<div class="line">Ex: typos: &#8220;Micorsoft Corportation&#8221; instead of &#8220;Microsoft
Corporation&#8221; and &#8220;Monnitor&#8221; instead of &#8220;Monitor&#8221;</div>
</div>
</li>
<li><p class="first"><strong>Rare strings</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> likely that they do not appear in
goodware samples, but possible</p>
</li>
<li><p class="first"><strong>Strings that look common</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> (Optional) e.g. yarGen
output strings that do not seem to be specific but didn’t
appear in the goodware string database</p>
</li>
<li><p class="first"><strong>Question?</strong> How to rank the importance of the strings in the
rules?</p>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<div class="section" id="automatized-in-a-tool-yargen">
<h4>Automatized in a tool: yarGen<a class="headerlink" href="#automatized-in-a-tool-yargen" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Author: Florian Roth</p>
</li>
<li><p class="first">Repository: <a class="reference external" href="https://github.com/Neo23x0/yarGen">https://github.com/Neo23x0/yarGen</a></p>
</li>
<li><p class="first">Purpose: automatic creation of YARA rules</p>
<p>« The main principle is the creation of YARA rules from strings found
in malware files while removing all strings that also appear in
goodware files. »</p>
</li>
</ul>
</div>
<div class="section" id="process">
<h4>Process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h4>
<a class="reference internal image-reference" href="../_images/37.PNG"><img alt="../_images/37.PNG" class="align-center" src="../_images/37.PNG" style="width: 580.0px; height: 291.0px;" /></a>
</div>
</div>
<div class="section" id="static-analysis-syntactic-pattern-matching-obfuscation">
<h3>Static Analysis: Syntactic Pattern Matching: Obfuscation<a class="headerlink" href="#static-analysis-syntactic-pattern-matching-obfuscation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://hal.inria.fr/hal-01964222/file/main.pdf">https://hal.inria.fr/hal-01964222/file/main.pdf</a> (<strong>ToRead</strong>)</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">malicious_behavior</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I am&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; evil!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">malicious_behavior</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>Observation</strong>: Signature “I am evil!!!” is not detected anymore!</div>
</div>
<div class="line-block">
<div class="line">Can obfuscate with:</div>
</div>
<ul class="simple">
<li>Easy to obfuscate, just split the strings in the code... with
<code class="docutils literal"><span class="pre">strncat</span></code> and <code class="docutils literal"><span class="pre">strcpy</span></code></li>
<li>More advanced technique: encoding (byte code, xor + key)</li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span> <span class="n">keystream</span> <span class="o">=</span> <span class="s">&quot;ISOLA - TUTORIAL -2018 &quot;</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span> <span class="n">obf</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x00\x73\x2e\x21\x61\x48\x22\x3c\x38\x6e</span><span class="s"> </span><span class="se">\x73\x68\x4b</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kt">char</span> <span class="o">*</span> <span class="nf">xor</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">cipherstr</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">keystream</span><span class="p">);</span>
    <span class="n">cipherstr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cipherstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">keystream</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cipherstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cipherstr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">cipherstr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="problem-packing-detection">
<h3>Problem: Packing Detection<a class="headerlink" href="#problem-packing-detection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Code gets compressed/encrypted and only decrypted at runtime
(possibly one piece at the time)</li>
</ul>
<a class="reference internal image-reference" href="../_images/38.PNG"><img alt="../_images/38.PNG" class="align-center" src="../_images/38.PNG" style="width: 378.0px; height: 166.5px;" /></a>
<ul class="simple">
<li>Very effective against any static technique: as hard as breaking
encryption</li>
<li>Difficulties:<ol class="arabic">
<li>Hard to know if the program is packed</li>
<li>And by who necessary to unpack</li>
</ol>
</li>
<li>Solution: To unpack we need to know which technique was used.</li>
</ul>
<ol class="arabic simple">
<li><strong>YARA</strong></li>
</ol>
<div class="highlight-c"><div class="highlight"><pre><span></span>Import r2;
rule UPX {
    strings: $upx = &quot;UPX&quot;
    condition:
        r2.section(&quot;UPX0&quot;,&quot;&quot;) and r2.section(&quot;UPX1&quot;,&quot;&quot;) and $upx
}
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p class="first"><strong>Machine learning</strong>: we use <strong>signature based Machine Learning
classification</strong></p>
<ol class="arabic">
<li><p class="first"><strong>training</strong>:</p>
<ul class="simple">
<li>Extract relevant features from binaries</li>
<li>Link features to pack/unpack informations + name of packer (if
possible, Based on your knowledge)</li>
<li>Create a ground truth for training ML classifiers (test several
algorithms, Generalization step.)</li>
</ul>
</li>
<li><p class="first"><strong>testing</strong>:</p>
<ul>
<li><p class="first">Use the result to decide if a file is packed</p>
</li>
<li><div class="first line-block">
<div class="line">Efficiency is very important, two questions: Packed or
unpacked? Packed by who?</div>
</div>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>What is a feature ?</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Static features:</th>
<th class="head">Dynamic features:</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Number of non standard sections</li>
<li>Import table size</li>
<li>File header entropy</li>
<li>...</li>
<li>Extraction time:  10 ms/file</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Repeated instruction execution</li>
<li>Execution of data section</li>
<li>Execution of previously written memory</li>
<li>...</li>
<li>Extraction time:  1 s/file</li>
<li>In practice: Dynamic features are too expensive to extract</li>
</ul>
</td>
</tr>
</tbody>
</table>
<a class="reference internal image-reference" href="../_images/39.PNG"><img alt="../_images/39.PNG" class="align-center" src="../_images/39.PNG" style="width: 376.25px; height: 200.9px;" /></a>
</div>
<div class="section" id="packing-detection-ground-truth">
<h3>Packing Detection: Ground Truth<a class="headerlink" href="#packing-detection-ground-truth" title="Permalink to this headline">¶</a></h3>
<p>ML techniques are as good as the data used to train them. Binaries are
chosen for ground truth by combining:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="37%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Hash based</strong>
Proprietary analyzer</th>
<th class="head"><strong>Static signatures</strong></th>
<th class="head"><strong>Proprietary tools</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>No access to tool source</li>
<li>High quality detection</li>
<li>Only on known binaries</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Multiple sources: YARA, PeID…</li>
<li>Detects byte patterns of packers in
binaries</li>
<li>Detects packing on unknown binaries</li>
</ul>
</td>
<td>Often done with manual experience and
hash based</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Build ground truth based on <strong>consensus</strong> of these techniques.</div>
</div>
<div class="line-block">
<div class="line">ML techniques are as good as the data used to train them</div>
</div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="c1">//Experimental file packed by us:</span>
<span class="c1">//Not known to the proprietary tool</span>
<span class="s">&quot;./tests/binary1&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">Unpacked</span> <span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">TheMida</span> <span class="n">v1</span><span class="mf">.802</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">TheMida</span> <span class="n">v1</span><span class="mf">.8</span>
<span class="p">}</span>
<span class="c1">//Packed with modified NSIS:</span>
<span class="c1">//Not know to static signatures</span>
<span class="s">&quot;./tests/binary2&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">NSIS</span><span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">Unpacked</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">Unpacked</span>
<span class="p">}</span>
<span class="c1">//Consensus on UPX:</span>
<span class="c1">//Added to the ground truth</span>
<span class="s">&quot;./tests/binary3&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">UPX</span><span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">UPX</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">UPX</span>
<span class="p">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/40.PNG"><img alt="../_images/40.PNG" class="align-center" src="../_images/40.PNG" style="width: 528.0px; height: 351.5px;" /></a>
</div>
<div class="section" id="packing-detection-ml-classifiers">
<h3>Packing Detection: ML Classifiers<a class="headerlink" href="#packing-detection-ml-classifiers" title="Permalink to this headline">¶</a></h3>
<p>We test ML classifiers of various complexity:</p>
<ol class="arabic simple">
<li><strong>Naive Bayesian Classifier</strong> : performs Bayesian hypothesis testing
assuming independence of features</li>
<li><strong>Decision Tree</strong> : determines order of feature testing based on
greedy entropy minimization</li>
<li><strong>Random Forest</strong> : uses majority voting on multiple Decision Trees
to avoid local maxima</li>
<li><strong>Nearest Neighbors</strong> : clusters similar elements according to a
distance metric</li>
<li>...</li>
</ol>
<p>Algorithms are evaluated on:</p>
<ol class="arabic simple">
<li>Effectiveness (by F-score)</li>
<li>Training time</li>
<li>Classification time</li>
</ol>
</div>
<div class="section" id="packing-detection-preliminary-results">
<h3>Packing Detection: Preliminary Results<a class="headerlink" href="#packing-detection-preliminary-results" title="Permalink to this headline">¶</a></h3>
<p>Preliminary results on ML classifiers tested:</p>
<a class="reference internal image-reference" href="../_images/41.PNG"><img alt="../_images/41.PNG" class="align-center" src="../_images/41.PNG" style="width: 526.5px; height: 153.5px;" /></a>
<ul class="simple">
<li>Database of 160k unpacked and 40k packed PE files</li>
<li>Used 80% of database for training, 20% for testing</li>
<li>All classifiers are very effective (even simple ones)</li>
<li>Decision tree is very cost effective</li>
<li>Decide classifier to use according to available time</li>
</ul>
<p>Preliminary results on most relevant features: <a class="footnote-reference" href="#id4" id="id2">[4]</a></p>
<a class="reference internal image-reference" href="../_images/42.PNG"><img alt="../_images/42.PNG" class="align-center" src="../_images/42.PNG" style="width: 449.0px; height: 102.0px;" /></a>
<div class="line-block">
<div class="line">As expected, entropy is important to detect packing.</div>
</div>
<div class="line-block">
<div class="line">Packing classification relies on finer features, like:</div>
</div>
<ul class="simple">
<li>Specific bytes after entry point</li>
<li>Presence of non standard sections</li>
<li>Use of rarely used system calls</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <strong>Situation</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/></th>
<th class="head"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <strong>Next</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Static analysis is a fast and efficient way to detect known malwares</li>
<li>With known signatures</li>
<li>The approach is not robust to obfuscation</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Let us try to detect signatures <em>at execution time</em></li>
<li>This is the <strong>dynamic analysis</strong> approach.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[3]</a></td><td><a class="reference external" href="https://yara.readthedocs.io/en/stable/">https://yara.readthedocs.io/en/stable/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[4]</a></td><td>* computed as mean decrease impurity on tree based algorithms</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dynamic-analysis">
<h2>Dynamic Analysis<a class="headerlink" href="#dynamic-analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>Principle</strong>: execute the binary, analyze the memory looking for
malicious behavior (in our case, “I am evil!”)</p>
<ul class="simple">
<li>Works for <code class="docutils literal"><span class="pre">strcpy(&quot;i</span> <span class="pre">am</span> <span class="pre">&quot;);strncat(a,</span> <span class="pre">&quot;</span> <span class="pre">evil</span> <span class="pre">&quot;);printf(a)</span></code></li>
<li>Does not work for <code class="docutils literal"><span class="pre">printf(&quot;i</span> <span class="pre">am</span> <span class="pre">&quot;);</span> <span class="pre">printf(&quot;</span> <span class="pre">evil</span> <span class="pre">&quot;)</span></code></li>
</ul>
<a class="reference internal image-reference" href="../_images/43.PNG"><img alt="../_images/43.PNG" class="align-center" src="../_images/43.PNG" style="width: 500.5px; height: 225.0px;" /></a>
<p>How do we look for the signature in a binary?</p>
<ul class="simple">
<li>The binary is executed in a virtualized environment.</li>
<li>The memory <strong>is dumped</strong> at various times during execution, and</li>
<li>Search for the <strong>signature</strong> in the dump.</li>
</ul>
<div class="line-block">
<div class="line">In static analysis, signatures are defined as (sets of) string(s)
<img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> special flags. Observing malwares at runtime allows for new
perspectives.</div>
<div class="line">A signature can be:</div>
</div>
<ul class="simple">
<li>Any type of observable behavior</li>
<li>Example: A sequence of logs (hock the logs)</li>
<li>Very important, e.g., in case of packing strings are obfuscated</li>
</ul>
<p><strong>Main difficulty</strong>: make sure that the malware does not know it is
observed!</p>
<div class="section" id="dynamic-analysis-virtualized-environment">
<h3>Dynamic Analysis: virtualized environment<a class="headerlink" href="#dynamic-analysis-virtualized-environment" title="Permalink to this headline">¶</a></h3>
<p>Complexity: <strong>high</strong></p>
<ul class="simple">
<li>Requires setting up and maintaining the emulation of a realistic
environment</li>
<li>Each file analysis requires time to execute the sample plus time to
reflash and restart virtualized environment</li>
</ul>
<div class="section" id="tools-software">
<h4>Tools/software<a class="headerlink" href="#tools-software" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">There are various virtualized environment:</div>
</div>
<ul class="simple">
<li>Sandboxes: Cuckoo, VirusTotal , sandboxie</li>
<li>Virtual machines: VirtualBox, …</li>
<li>Native hypervisors</li>
</ul>
<div class="line-block">
<div class="line">There are various tools to dump memory: <code class="docutils literal"><span class="pre">LiMe</span></code>, <code class="docutils literal"><span class="pre">fmem</span></code>,
<code class="docutils literal"><span class="pre">HBGary</span></code>, ...</div>
<div class="line">There are many tools to examine a dump: <code class="docutils literal"><span class="pre">Volatility</span></code> (works with
python, embeds dynamic version of YARA)</div>
</div>
</div>
</div>
<div class="section" id="computer-system-abstract-architecture">
<h3>Computer system : abstract architecture<a class="headerlink" href="#computer-system-abstract-architecture" title="Permalink to this headline">¶</a></h3>
<div class="section" id="sandbox">
<h4>Sandbox<a class="headerlink" href="#sandbox" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Everything installed stays inside</li>
<li>Cannot be viewed from external world</li>
<li>Not saved when application exits</li>
<li>Hock calls, observe, …</li>
<li>Time out after some time</li>
</ul>
<a class="reference internal image-reference" href="../_images/44.PNG"><img alt="../_images/44.PNG" class="align-center" src="../_images/44.PNG" style="width: 690.5px; height: 358.5px;" /></a>
<p><strong>Limits</strong></p>
<ul class="simple">
<li>Does not analyze malware if it requires command line arguments or
packets from C&amp;C server</li>
<li>Sleep and similar operations can timeout analysis</li>
<li>Multi file malware (e.g. with DLLs) not analyzed</li>
<li>May have incorrect environment e.g. OS type</li>
<li>Analysis result may be hard to understand</li>
</ul>
</div>
<div class="section" id="virtual-machines">
<h4>Virtual machines<a class="headerlink" href="#virtual-machines" title="Permalink to this headline">¶</a></h4>
<a class="reference internal image-reference" href="../_images/45.PNG"><img alt="../_images/45.PNG" class="align-center" src="../_images/45.PNG" style="width: 729.5px; height: 384.5px;" /></a>
<p><strong>Limits</strong></p>
<ul>
<li><p class="first">Not lightweight</p>
</li>
<li><p class="first">Reconstitute a computer within a computer</p>
</li>
<li><p class="first">Can still be detected</p>
</li>
<li><div class="first line-block">
<div class="line"><strong>Other solutions</strong>: hypervisor (beyond this introduction)</div>
</div>
</li>
</ul>
<p>Am I in a VM ?</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">hv_bit</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">cpu_feats</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">__asm__</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot; cpuid &quot;</span>
            <span class="o">:</span> <span class="s">&quot;=c&quot;</span> <span class="p">(</span> <span class="n">cpu_feats</span> <span class="p">)</span> <span class="c1">// output : ecx or rcx -&gt; cpu_feat</span>
            <span class="o">:</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="mi">1</span><span class="p">));</span>          <span class="c1">// input : 1 -&gt; eax or rax</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">cpu_feats</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Dynamic analysis forces to execute the malware, this goes beyond
static analysis</li>
<li>But may requires more sophisticated deployments</li>
<li>Unfortunately: all virtual environments can be detected and evaded</li>
<li>When a malware is executed, one can get information with memory dump</li>
</ol>
</div>
</div>
<div class="section" id="what-is-memory-forensics">
<h3>What is memory forensics ?<a class="headerlink" href="#what-is-memory-forensics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Data are stored in either main memory unit or auxiliary memory unit</li>
<li>RAM (Random Access Memory) is the main memory unit</li>
<li>It retrieves the programs or data from the auxiliary memory unit</li>
<li>It temporarily stores the information until the power is turned off.</li>
</ul>
<p>“Memory forensics is forensic analysis of a computer’s memory dump. Its
primary application is investigation of advanced computer attacks which
are stealthy enough to avoid leaving data on the computer’s hard drive.
Consequently, the memory (RAM) must be analyzed for forensic
information. [From Wikipedia]&#8221;</p>
<p>There are at least two main reasons to observe the physical memory:</p>
<ol class="arabic simple">
<li>Contains data related to the real time execution of the system<ul>
<li>Currently mounter file system</li>
<li>List of active processes, connections, …</li>
</ul>
</li>
<li>Encrypted data are generally decrypted before being used<ul>
<li>Password is now visible, …</li>
<li>Code is unpacked before being executed</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="memory-dump-and-memory-profil">
<h3>Memory dump and memory profil<a class="headerlink" href="#memory-dump-and-memory-profil" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Main difficulty</strong>: organisation of memory depends of architecture
and kernel symbols</li>
<li>This information is called the <strong>memory profil</strong> (can be created from
distribution)</li>
<li>When dumping memory it is of interest to specify the memory profil</li>
<li>If it is unknown , we obtain a &#8220;<strong>raw</strong>&#8221; <strong>memory dump</strong></li>
<li>In this case, tools exists to identify the dump (but they are not
perfect)&#8221;</li>
<li>Dumping memory is not hard</li>
<li>Retrieving informations from dump requires to know the profil</li>
<li>Identifying profil is thus crucial</li>
<li>This class does not aim to investiguate the shape of memory</li>
<li>However, students need to understand that there is no tool able to
handle all memory shape and all architecture</li>
</ul>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-linux">
<h3>Sample of tools to dump memory (Linux)<a class="headerlink" href="#sample-of-tools-to-dump-memory-linux" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><code class="docutils literal"><span class="pre">LiME</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">dd</span></code> command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Loadable kernel module</li>
<li>first tool that can perform entire memory dumps from Linux devices
and from Android.</li>
<li>Perform memory dumps by loading modules immediately after compiling
without any other operations, such as a change in kernel settings</li>
<li>Work with both 32 and 64 bits</li>
<li>Can generate its own memory format for compatibility with analysis
tools</li>
</ul>
</td>
<td><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">dd</span></code> can copy files of various sizes (<code class="docutils literal"><span class="pre">dd</span></code> if = origine of =
destination)</li>
<li>In Linux, all the devices are managed through files</li>
<li>physical memory data are in <code class="docutils literal"><span class="pre">/dev/mem</span></code> file</li>
<li>However, recent versions restrict access to memory stored in
<code class="docutils literal"><span class="pre">/dev/mem</span></code></li>
<li>Work with both 32 and 64 bits</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="section" id="lime-illustration">
<h4>Lime: Illustration<a class="headerlink" href="#lime-illustration" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="first line-block">
<div class="line">The following command:</div>
<div class="line"><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">insmod</span> <span class="pre">lime-4.18.0-17-generic.ko</span> <span class="pre">&quot;path=/home/axel/memory.mem</span> <span class="pre">format=lime&quot;</span></code></div>
<div class="line">Creates a lime format copy of the RAM and write it into
<code class="docutils literal"><span class="pre">/home/</span> <span class="pre">memory.mem</span></code></div>
</div>
</li>
<li><p class="first">Observe that <code class="docutils literal"><span class="pre">lime-4.18.0-17-generic.ko</span></code> is the lime module
directly identified by Lime during installation on your distribution!
(LiMe version directly link to you kernel distribution version
because it need to keep the structure of you memory!)</p>
</li>
<li><p class="first">It actually depends on the memory <code class="docutils literal"><span class="pre">System.map</span></code> in <code class="docutils literal"><span class="pre">/boot</span></code>
directory!</p>
</li>
<li><p class="first">To clean up: <code class="docutils literal"><span class="pre">rrmod</span> <span class="pre">lime</span></code></p>
</li>
</ul>
</div>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-windows">
<h3>Sample of tools to dump memory (Windows)<a class="headerlink" href="#sample-of-tools-to-dump-memory-windows" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><code class="docutils literal"><span class="pre">Dumpit</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">OllyDBG</span></code> and <code class="docutils literal"><span class="pre">LordPE</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>generate a physical memory dump of Windows
machines.</li>
<li>The raw memory dump is generated in the current
directory</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Free</li>
<li>Only works properly on 32 bit architecture</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-disassembler">
<h3>Sample of tools to dump memory (disassembler)<a class="headerlink" href="#sample-of-tools-to-dump-memory-disassembler" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Most of disassembler have their own memory dump</div>
<div class="line"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">GDB</span></code></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">dump</span> <span class="pre">binary</span> <span class="pre">memory</span> <span class="pre">result.bin</span> <span class="pre">0x200000000</span> <span class="pre">0x20000c350</span></code></li>
</ul>
<p><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">x64dbg</span></code></p>
<ul class="simple">
<li>Scylla Plugin</li>
</ul>
<p><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">IDA,</span> <span class="pre">RADARE</span></code>,...</p>
</div>
<div class="section" id="the-volatility-framework">
<h3>The <code class="docutils literal"><span class="pre">volatility</span></code> framework<a class="headerlink" href="#the-volatility-framework" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Volatility is an open source memory forensics framework for incident
response and malware analysis. Volatility is written in <code class="docutils literal"><span class="pre">python</span></code>.</div>
</div>
<div class="line-block">
<div class="line">Volatility can be used to retrieve information from memory dump:</div>
</div>
<ul class="simple">
<li>List of processes</li>
<li>connections</li>
<li>Dump process from memory for finer analysis</li>
<li>Process organization structure</li>
<li>Command link to process</li>
<li>Yara (pattern matching inside</li>
<li>Malfind (detect known)</li>
<li>...</li>
</ul>
</div>
<div class="section" id="supports">
<h4>Supports<a class="headerlink" href="#supports" title="Permalink to this headline">¶</a></h4>
<p>Volatility Framework support (taken from their website):</p>
<ul class="simple">
<li>memory dumps from all major 32 and 64 bit Windows</li>
<li>Linux memory dumps in raw or LiME format and include 35+ plugins for
analyzing 32 and 64 bit Linux kernels from 2.6.11 3.16 and
distributions such as Debian, Ubuntu, OpenSuSE , Fedora, CentOS, and
Mandrake</li>
<li>38 versions of Mac OSX memory dumps from 10.5 to 10.9.4 Mavericks,
both 32 and 64 bit. Android phones with ARM processors are also
supported</li>
</ul>
<p>But is is likely that you’ll have to create your own profile (especially
for Linux)</p>
</div>
<div class="section" id="profile-creation-linux">
<h4>Profile creation (linux)<a class="headerlink" href="#profile-creation-linux" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">A profil contains: kernel data structures (<code class="docutils literal"><span class="pre">.dwarf</span></code>) and debug
symbols (<code class="docutils literal"><span class="pre">.map</span></code>)</div>
</div>
<div class="line-block">
<div class="line">Remember:</div>
</div>
<ul class="simple">
<li>it is used to locate critical information inside the memory dump</li>
<li>Hence to understand the structure of the memory.</li>
</ul>
<p>It’s imperative that the profile is created on the same machine to be
analyzed. Indeed, kernel data structure and debug symbols are specific
to distribution and kernel used.</p>
<ol class="arabic">
<li><p class="first">Create the kernel data structure</p>
<ul>
<li><p class="first">Use <code class="docutils literal"><span class="pre">dwarf</span></code> for debugging information</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">axel&#64;axel-VirtualBox:~/volatility/linux</span> <span class="pre">ls</span></code></p>
<p><code class="docutils literal"><span class="pre">info</span> <span class="pre">kcore</span> <span class="pre">Makefile</span> <span class="pre">Makefile.enterprise</span> <span class="pre">module.c</span> <span class="pre">module.dwarf</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Get the kernel symbols of the current kernel</p>
<ul>
<li><p class="first">tells Volatility how are memory analysis snapshot structured</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">axel&#64;axel</span> <span class="pre">VirtualBox</span> <span class="pre">:~</span> <span class="pre">ls</span> <span class="pre">/boot/System*</span></code></p>
<p><code class="docutils literal"><span class="pre">/boot/System.map-4.18.0-16-generic</span> <span class="pre">/boot/System.map-4.18.0-17-generic</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Archive the profile</p>
<ul class="simple">
<li>in <code class="docutils literal"><span class="pre">/volatility/volatility/plugins/linux</span></code></li>
<li><code class="docutils literal"><span class="pre">zip</span> <span class="pre">nomprofil.zip</span> <span class="pre">/boot/System.map-4.18.0-17-generic/volatility</span> <span class="pre">/linux.module.dwarf</span></code></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="quick-usage-illustration">
<h4>Quick usage illustration<a class="headerlink" href="#quick-usage-illustration" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="first line-block">
<div class="line">Command line:</div>
<div class="line"><code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">(--profil=profiltodefine)</span> <span class="pre">-f</span> <span class="pre">file</span> <span class="pre">(-p</span> <span class="pre">processnumber)</span>&#160; <span class="pre">command</span></code></div>
</div>
</li>
<li><p class="first">To know the list of available profiles: <code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">--info</span></code></p>
</li>
<li><div class="first line-block">
<div class="line">Example: how to list all process from dump <code class="docutils literal"><span class="pre">memory.mem</span></code> with
profil ubuntu</div>
<div class="line"><code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">--profil=ubuntu</span> <span class="pre">-f</span> <span class="pre">memory.mem</span> <span class="pre">linux_pslist</span></code></div>
</div>
</li>
<li><p class="first">Can be combined with Yara and other tools</p>
</li>
</ul>
</div>
<div class="section" id="a-note-on-installation">
<h4>A note on installation<a class="headerlink" href="#a-note-on-installation" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">get</span> <span class="pre">install</span> <span class="pre">volatility</span></code> works for linux but is not providing
a nice structure to add profiles (especially overlay directory). Better
to follow installation from original <a class="reference external" href="https://github.com/volatilityfoundation/volatility/wiki/Installation#getting-volatility">website</a>.</p>
<p>Fully integrated version for windows: <code class="docutils literal"><span class="pre">volatility_standalone</span></code></p>
</div>
</div>
<div class="section" id="relation-with-virtual-machine">
<h3>Relation with virtual machine<a class="headerlink" href="#relation-with-virtual-machine" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Tool such as Virtualbox allow us to perform memory dump of a virtual
machine.</div>
<div class="line">Example:
<code class="docutils literal"><span class="pre">vboxmanage</span> <span class="pre">debugvm</span> <span class="pre">&quot;windows10&quot;</span>&#160; <span class="pre">dumpvmcore</span> <span class="pre">--filename</span> <span class="pre">test.elf</span></code></div>
</div>
<ul class="simple">
<li>Extract dump of Ubuntu 2019 and place it into <code class="docutils literal"><span class="pre">test.elf</span></code>.</li>
<li>Vboximage are always ELF files (even if windows runs inside the
machine!)</li>
</ul>
<p><strong>Important</strong>: <code class="docutils literal"><span class="pre">test.elf</span></code> contains the entire virtualbox environment,
that is not only the RAM of the system running within windows10 , but
also the RAM for the entire machine. One must thus locate the RAM of the
system running within the machine, that is to identify the first LOAD
section , and take a subimage.</p>
<p><a class="reference external" href="https://www.andreafortuna.org/2017/06/23/how-to-extract-a-ram-dump-from-a-running-virtualbox-machine/">https://www.andreafortuna.org/2017/06/23/how-to-extract-a-ram-dump-from-a-running-virtualbox-machine/</a></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>The entire raw memory occupied by the machine will be
dumped. As an example, if 10GB of raw memory are allocated to the
machine, then they’ll be all dumped. Even if they are not entirely
used by the machine.</strong></p>
</div>
<div class="line-block">
<div class="line"><strong>Problem</strong>: tools may not be able to analyse such size (extract sub
image, save, etc</div>
</div>
<ul class="simple">
<li>Configure your machine properly when you perform an analysis</li>
</ul>
</div>
<div class="section" id="the-limit-of-static-yara-analysis">
<h3>The limit of static yara analysis<a class="headerlink" href="#the-limit-of-static-yara-analysis" title="Permalink to this headline">¶</a></h3>
<p>Consider that any program which prints &#8220;catanddog123&#8221; is a malware. The
following yara rule should be able to catch such malware:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>rule silent_banker : banker {
    meta:
        description = &quot;This is just an example&quot;
    strings:
        $a = &quot;catanddog123&quot;
    condition:
        $a
}
</pre></div>
</div>
<p>However , the following program (test.c) will not be detected</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">table1</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">table2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">table1</span><span class="p">,</span><span class="s">&quot;catanddog1&quot;</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span><span class="s">&quot;23&quot;</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">table1</span><span class="p">,</span><span class="n">table2</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">table1</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nothing happened ; Yara found nothing, this is because « catanddog123 »
is not in stored in the file. However , it appears in memory before it
is printed.</p>
<ul class="simple">
<li>Solution: dump the memory and apply yara on it</li>
<li>Remember : memory contains almost everything you need</li>
</ul>
</div>
<div class="section" id="dynamic-yara-analysis-in-action">
<h3>Dynamic Yara analysis in action<a class="headerlink" href="#dynamic-yara-analysis-in-action" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="../_images/46.PNG"><img alt="../_images/46.PNG" class="align-center" src="../_images/46.PNG" style="width: 640.0px; height: 213.5px;" /></a>
<a class="reference internal image-reference" href="../_images/47.PNG"><img alt="../_images/47.PNG" class="align-center" src="../_images/47.PNG" style="width: 639.5px; height: 239.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">There are several tutorial availables:</div>
</div>
<p><a class="reference external" href="https://eforensicsmag.com/finding-advanced-malware-using-volatility/">https://eforensicsmag.com/finding-advanced-malware-using-volatility/</a></p>
<p>It assumes that a dump of the problematic file has been created under
<code class="docutils literal"><span class="pre">vinfected.vmem</span></code>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Duchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.<br/>
    </p>
  </div>
</footer>
  </body>
</html>