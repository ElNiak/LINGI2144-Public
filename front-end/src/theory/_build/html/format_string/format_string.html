
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Format String &#8212; Theory 2020 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Theory 2020 documentation" href="../index.html" />
    <link rel="next" title="Malware Analysis I" href="../malware_analysisI/introduction.html" />
    <link rel="prev" title="Stack Protection" href="../stack_protection/nonexec.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/index.html">Main</a></li>
                <li><a href="/exercice/index.html">Tutorial</a></li>
                <li><a href="/qcm/index.html">MCQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#am-i-allowed-to-do-that">Am I allowed to do that?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#the-blaster-lovesan-worm">The Blaster/Lovesan worm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#the-off-by-one-vulnerability">The &#8220;off by one vulnerability&#8221;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#facts">Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisI/introduction.html">Malware Analysis I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisII/analysis.html">Malware Analysis II</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#malware-analysis">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#dynamic-analysis">Dynamic Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisIII/packing.html">Malware Analysis III</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisIII/packing.html#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="row" style="padding-top: 20px">
    <div class="col-xs-6">
        <form id="rar_tp"  target="_blank" style="text-align:center;" method="get" action="">
            <button style="text-align:center; border-radius:12px;" type="submit" class="up">
                <svg id="Capa_1"
                     width="50px" height="50px"
                     enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m453.31 460.125c0 24.508-19.907 44.375-44.464 44.375h-305.692c-24.557 0-44.464-19.867-44.464-44.375v-408.25c0-24.508 19.907-44.375 44.464-44.375h190.303c8.857 0 17.35 3.516 23.606 9.773l126.505 126.521c6.239 6.239 9.742 14.694 9.742 23.508z" fill="#f9f8f9"/><path d="m133.15 504.5h-30c-24.55 0-44.46-19.87-44.46-44.38v-408.24c0-24.51 19.91-44.38 44.46-44.38h30c-24.55 0-44.46 19.87-44.46 44.38v408.24c0 24.51 19.91 44.38 44.46 44.38z" fill="#e3e0e4"/><path d="m453.31 167.3v16.24h-115.96c-33.12 0-60.06-26.95-60.06-60.07v-115.97h16.17c8.85 0 17.35 3.52 23.6 9.77l126.51 126.52c6.24 6.24 9.74 14.7 9.74 23.51z" fill="#e3e0e4"/><path d="m450.32 153.54h-112.97c-16.6 0-30.06-13.46-30.06-30.07v-112.96c3.61 1.63 6.92 3.91 9.77 6.76l126.51 126.52c2.85 2.85 5.12 6.15 6.75 9.75z" fill="#b9a1d3"/><path d="m435 438.5h-358c-22.091 0-40-17.909-40-40v-146c0-22.091 17.909-40 40-40h358c22.091 0 40 17.909 40 40v146c0 22.091-17.909 40-40 40z" fill="#b9a1d3"/><path d="m102 438.5h-25c-22.09 0-40-17.91-40-40v-146c0-22.09 17.91-40 40-40h25c-22.09 0-40 17.91-40 40v146c0 22.09 17.91 40 40 40z" fill="#9573bb"/></g><g><path d="m58.689 153.851c4.143 0 7.5-3.357 7.5-7.5v-94.476c0-20.333 16.582-36.875 36.965-36.875h111.42c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-111.42c-28.653 0-51.965 23.271-51.965 51.875v94.476c0 4.142 3.358 7.5 7.5 7.5z"/><path d="m460.811 212.656v-45.354c0-10.879-4.24-21.111-11.938-28.811l-126.506-126.52c-7.718-7.72-17.985-11.971-28.91-11.971h-43.394c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h43.394c2.165 0 4.288.264 6.334.775v107.696c0 20.714 16.85 37.566 37.561 37.566h107.694c.505 2.025.765 4.125.765 6.265v38.954c-3.476-.812-7.092-1.256-10.811-1.256h-23.319c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h23.319c17.921 0 32.5 14.579 32.5 32.5v146c0 17.921-14.579 32.5-32.5 32.5h-268.66c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h268.66c3.719 0 7.335-.444 10.811-1.256v15.381c0 20.333-16.582 36.875-36.965 36.875h-305.692c-20.383 0-36.965-16.542-36.965-36.875v-15.381c3.476.812 7.092 1.256 10.811 1.256h53.319c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-53.319c-17.921 0-32.5-14.579-32.5-32.5v-146c0-17.921 14.579-32.5 32.5-32.5h299.702c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-299.702c-3.719 0-7.335.444-10.811 1.256v-24.905c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v31.305c-13.04 8.477-21.689 23.165-21.689 39.844v146c0 16.679 8.649 31.367 21.689 39.844v21.781c0 28.604 23.312 51.875 51.965 51.875h305.691c28.653 0 51.965-23.271 51.965-51.875v-21.781c13.041-8.477 21.689-23.165 21.689-39.844v-146c.001-16.679-8.648-31.367-21.688-39.844zm-146.02-89.185v-97.863l120.414 120.429h-97.854c-12.439 0-22.56-10.123-22.56-22.566z"/><path d="m265.669 264.091c-1.584-3.853-5.297-6.341-9.462-6.341-.003 0-.006 0-.009 0-4.168.004-7.882 2.499-9.461 6.356-.023.057-.046.114-.067.172l-45.247 118.803c-1.475 3.87.469 8.203 4.34 9.678 3.865 1.475 8.203-.468 9.678-4.34l9.429-24.757h62.347l9.335 24.736c1.458 3.914 5.891 5.823 9.665 4.368 3.875-1.462 5.831-5.789 4.368-9.665l-44.836-118.808c-.025-.067-.053-.135-.08-.202zm-35.087 84.571 25.603-67.226 25.37 67.226z"/><path d="m181.648 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.588-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/><path d="m410.5 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.589-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/></g></g>
                </svg>
                <br> <b> Slides </b>
            </button>
        </form>
    </div>
    <div class="col-xs-6">
        <form id="vid_tp" style="text-align:center;">
	<a id="notUp"  href="#!" style="text-align:center;"
   data-title="Watch now on youtube">
            <button class="video-btn up" onclick="topFunction()"
                    style="text-align:center; border-radius:12px;" data-toggle="modal" type="button"
                    data-target="#myModal"
                    data-src="">
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg width="50px" height="50px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512.003 512.003" style="enable-background:new 0 0 512.003 512.003;" xml:space="preserve">
<path style="fill:#E53935;" d="M443.734,80.336L330.86,70.437c-49.812-4.334-99.906-4.334-149.717,0L68.268,80.336
	c-38.702,3.124-68.459,35.541-68.267,74.368v202.667c-0.204,38.835,29.557,71.265,68.267,74.389l112.939,9.813
	c24.832,2.133,49.835,3.243,74.859,3.243c25.024,0,50.027-1.067,74.859-3.243l112.939-9.813c38.659-3.187,68.348-35.6,68.139-74.389
	V154.704C512.194,115.877,482.436,83.459,443.734,80.336z"/>
<path style="fill:#FAFAFA;" d="M357.782,247.077l-149.333-96c-4.951-3.193-11.552-1.768-14.745,3.183
	c-1.111,1.722-1.702,3.728-1.703,5.777v192c0.002,5.891,4.78,10.665,10.671,10.663c2.049-0.001,4.055-0.592,5.777-1.703l149.333-96
	c4.954-3.187,6.387-9.787,3.2-14.742c-0.825-1.283-1.917-2.374-3.2-3.2V247.077z"/>
<path d="M256.001,444.816c-25.003,0-50.005-1.088-74.837-3.243l-112.896-9.835c-38.71-3.124-68.471-35.554-68.267-74.389V154.683
	c-0.182-38.819,29.573-71.224,68.267-74.347l112.896-9.899c49.797-4.334,99.877-4.334,149.675,0l112.96,9.813
	c38.717,3.158,68.454,35.629,68.203,74.475v202.667c0.204,38.835-29.557,71.265-68.267,74.389l0,0l-112.96,9.813
	C306.028,443.771,281.004,444.816,256.001,444.816z M256.001,88.549c-24.405,0-48.768,1.067-72.981,3.157L69.953,101.52
	c-27.614,2.317-48.794,25.495-48.619,53.205v202.667c-0.116,27.7,21.097,50.827,48.704,53.099l112.96,9.813
	c48.57,4.209,97.414,4.209,145.984,0l113.067-9.813c27.589-2.315,48.76-25.456,48.619-53.141V154.683
	c0.116-27.7-21.097-50.827-48.704-53.099l-112.96-9.813c-24.235-2.105-48.569-3.164-73.003-3.179V88.549z"/>
<path d="M202.668,362.704c-5.891,0-10.667-4.776-10.667-10.667v-192c-0.01-5.891,4.758-10.674,10.649-10.684
	c2.057-0.003,4.07,0.588,5.799,1.703l149.333,96c4.96,3.178,6.405,9.776,3.227,14.736c-0.83,1.296-1.931,2.397-3.227,3.227
	l-149.333,96C206.724,362.124,204.717,362.709,202.668,362.704z M213.334,179.579v152.917l118.933-76.459L213.334,179.579z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <br> <b>  Video </b>
            </button>
        </a>
</form>

  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-body">

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div id="video-view" class="embed-responsive embed-responsive-16by9">

          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Format String</a><ul>
<li><a class="reference internal" href="#definition">Definition</a><ul>
<li><a class="reference internal" href="#fortatted-output-functions">Fortatted output functions</a></li>
<li><a class="reference internal" href="#conversion-specification">Conversion specification</a></li>
<li><a class="reference internal" href="#variadic-functions-on-the-stack">Variadic functions on the stack</a></li>
<li><a class="reference internal" href="#dynamic-format-string-a-potential-vulnerability">Dynamic format string: a potential vulnerability</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shellcode-and-format-string">Shellcode and Format String</a><ul>
<li><a class="reference internal" href="#difficulty">Difficulty</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prevention-detection">Prevention/Detection</a><ul>
<li><a class="reference internal" href="#lexical-analysis">Lexical Analysis</a></li>
<li><a class="reference internal" href="#formatguard-counting-the-number-of-arguments-old">FormatGuard: Counting the number of arguments (old)</a></li>
<li><a class="reference internal" href="#compiler-option-now-replace-formatguard">Compiler option (now replace formatguard)</a></li>
<li><a class="reference internal" href="#libsafe-implementation-for-n">Libsafe Implementation (for <code class="docutils literal"><span class="pre">%n</span></code>)</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#static-taint-analysis">Static Taint Analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#format-string-versus-bo">Format String versus BO</a></li>
<li><a class="reference internal" href="#some-vulnerabilities">Some vulnerabilities</a><ul>
<li><a class="reference internal" href="#the-stunnem-vulnerability">The Stunnem vulnerability</a></li>
<li><a class="reference internal" href="#the-wu-ftpd-vulnerability">The <code class="docutils literal"><span class="pre">wu-ftpd</span></code> vulnerability</a></li>
<li><a class="reference internal" href="#the-cde-tooltalk-vulnerability">The CDE ToolTalk vulnerability</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="format-string">
<h1>Format String<a class="headerlink" href="#format-string" title="Permalink to this headline">¶</a></h1>
<div class="section" id="definition">
<h2>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h2>
<p>In, e.g., C language , format string are strings that contains specific
characters , called <strong>conversion specifications</strong> characters
(<code class="docutils literal"><span class="pre">%d,%s,etc.</span></code>). Format string also exist in other language such as
Python for example.</p>
<div class="section" id="fortatted-output-functions">
<h3>Fortatted output functions<a class="headerlink" href="#fortatted-output-functions" title="Permalink to this headline">¶</a></h3>
<p>Format strings are usually exploited by <strong>formatted output functions</strong>
such as <code class="docutils literal"><span class="pre">printf</span></code> and derivatives (<code class="docutils literal"><span class="pre">fprintf,</span> <span class="pre">vprintf,</span> <span class="pre">sprint</span></code>,...).
Formatted output functions consist of a format string and a variable
number of arguments, usually one for each conversion specification of
the format string.</p>
<a class="reference internal image-reference" href="../_images/24.PNG"><img alt="../_images/24.PNG" class="align-center" src="../_images/24.PNG" style="width: 504.8px; height: 122.4px;" /></a>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">fprintf()</span></code> writes output to a <strong>stream</strong> based on the contents of
the format string. The stream, format string, and a variable list of
arguments are provided as arguments</li>
<li><code class="docutils literal"><span class="pre">printf()</span></code> is equivalent to <code class="docutils literal"><span class="pre">fprintf()</span></code> except that <code class="docutils literal"><span class="pre">printf()</span></code>
assumes that the output stream is stdout</li>
<li><code class="docutils literal"><span class="pre">sprintf()</span></code> is equivalent to <code class="docutils literal"><span class="pre">fprintf()</span></code> except that the output
is written into an array rather than to a stream</li>
</ul>
<p>Formatted output functions are <strong>variadic</strong> functions. This means that
they accept a variable number of arguments</p>
<ul class="simple">
<li><strong>User Contract:</strong> #of calling conventions <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> #of arguments
(<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> Vulnerability)</li>
</ul>
<p>Variadic functions are implemented using either the UNIX System V or the
ANSI C approach. Both approaches require that the contract between the
developer and user of the variadic function not be violated by the user.
But the architecture may allow you to violate this contract ... (no way
to count). This should remind of the “memory management class.
<strong>Potential error</strong> forget one argument linked to a convention call.</p>
</div>
<div class="section" id="conversion-specification">
<h3>Conversion specification<a class="headerlink" href="#conversion-specification" title="Permalink to this headline">¶</a></h3>
<p>There are two main types of conversion specification:</p>
<ol class="arabic">
<li><p class="first"><strong>Direct:</strong></p>
<ul class="simple">
<li>Argument is transmitted as a <em>value</em></li>
<li><code class="docutils literal"><span class="pre">%d</span></code>, expect an integer transmitted as a value</li>
<li><code class="docutils literal"><span class="pre">%u</span></code>, expect a natural transmitted as a value</li>
<li><code class="docutils literal"><span class="pre">%x</span></code>, expect an hexadecimal transmitted as a value</li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I have %d cats&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first"><strong>Address based:</strong></p>
<ul class="simple">
<li>Argument is transmitted as a <em>reference</em></li>
<li><code class="docutils literal"><span class="pre">%s</span></code>, expect a pointer to a string</li>
<li><code class="docutils literal"><span class="pre">%n</span></code>, save number of chars printed before reaching <code class="docutils literal"><span class="pre">%n</span></code></li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">&quot;UCLouvain &quot;</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;name of the university : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">%i$d</span></code> <strong>allows us to print variadic argument number i.</strong></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">%Xd</span></code> <strong>generates an integer of size X.</strong></p>
</div>
</div>
<div class="section" id="variadic-functions-on-the-stack">
<h3>Variadic functions on the stack<a class="headerlink" href="#variadic-functions-on-the-stack" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">uc</span> <span class="o">=</span> <span class="s">&quot;UCLouvain &quot;</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;name of the university : %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">uc</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/25.PNG"><img alt="../_images/25.PNG" class="align-center" src="../_images/25.PNG" style="width: 283.2px; height: 423.2px;" /></a>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">uc</span> <span class="o">=</span> <span class="s">&quot;UCLouvain &quot;</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;name of the university : %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="c1">// No argument is passed: what will be read ?</span>
    <span class="c1">// What is in the stack where the arguments should</span>
    <span class="c1">//have been. Here: local variables before printf!</span>
<span class="p">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/26.PNG"><img alt="../_images/26.PNG" class="align-center" src="../_images/26.PNG" style="width: 277.6px; height: 425.6px;" /></a>
</div>
<div class="section" id="dynamic-format-string-a-potential-vulnerability">
<h3>Dynamic format string: a potential vulnerability<a class="headerlink" href="#dynamic-format-string-a-potential-vulnerability" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A problem arises when a format string contains conversion specifications
that are not matched with arguments. Mostly when the system <strong>gives the
control of the content</strong> of the output function <strong>to the user</strong>. This is
called a dynamic format string cannot be guessed by reading the code).</div>
</div>
<div class="line-block">
<div class="line">Let us first show how <code class="docutils literal"><span class="pre">%x</span></code> can help us to read anywhere on the stack
and <code class="docutils literal"><span class="pre">%n</span></code> to write there.</div>
</div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">arv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1024</span><span class="p">);</span>
    <span class="n">msg</span><span class="p">[</span><span class="mi">1023</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">yop</span></code> <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/> <code class="docutils literal"><span class="pre">yop</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">%x%x%x%x%x</span></code> <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/>
<code class="docutils literal"><span class="pre">ffc5b3f44005658b5c7f7d2bcb8</span></code></p>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">./vuln</span>&#160; <span class="pre">AAAA%x%x%x%x%x%x%x%x%x%x%x</span></code> <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/></div>
<div class="line"><code class="docutils literal"><span class="pre">AAAAffe1f3e2400566545c7f7d58cb8</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">677f9a5ff7f4f110ffe1dd1411f7d5bdc841414141</span></code>,
41 <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> A , 8th %x point to beginning of msg. Indeed, we went
to higher addresses in the stack and eventually met msg. We control
msg , and more generally anything higher in the stack, which may be
dangerous. <img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">%x</span></code> allows to <strong>read</strong> on the
stack</div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">%s</span></code> <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/> <code class="docutils literal"><span class="pre">Segmentation</span> <span class="pre">fault</span></code> Tries to
print the string at address pointed by s. This address is likely to
not be defined but this could change if one could put an interesting
address on the vulnerable buffer, use <code class="docutils literal"><span class="pre">%x</span></code> to reach it and then
<code class="docutils literal"><span class="pre">%s</span></code> to display it</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">0xbffffe48%x%x%x%x%x%x%x%n</span></code> <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/> will save
66 at <code class="docutils literal"><span class="pre">0xbffffe48</span></code>. We have 66 because 10 char for <code class="docutils literal"><span class="pre">0xbffffe48</span></code>
and 8 char for each of the seven <code class="docutils literal"><span class="pre">%x</span></code>. <img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">%n</span></code>
allows to <strong>write</strong> on the stack</p>
</li>
</ul>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="kt">char</span> <span class="n">text</span> <span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">test_val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">72</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;the right way to do things </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;the wrong way to do things </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;test val is %d at 0x%08x and contains 0x%08x&quot;</span><span class="p">,</span><span class="n">test_val</span><span class="p">,</span><span class="o">&amp;</span><span class="n">test_val</span><span class="p">,</span><span class="n">test_val</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">AAAA%x%x%x%x</span></code></li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>the right way to <span class="k">do</span> things:
§UV%x%x%x%n the wrong way to <span class="k">do</span> things:
§UVffffcdb0f7fcd110565561f3
<span class="nb">test</span> val is <span class="m">28</span> at 0x56559008 and contains 0x0000001c
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">./vuln</span> <span class="pre">$(printf</span> <span class="pre">&quot;\x08\x90\x55\x56&quot;)%x%x%x%n</span></code></li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>the right way to <span class="k">do</span> things:
AAAA%x%x%x%x the wrong way to <span class="k">do</span> things:
AAAAffffcdb0f7fcd110565561f3 <span class="m">41414141</span>
<span class="nb">test</span> val is -72 at 0x56559008 and contains 0xffffffb8
</pre></div>
</div>
<p>In case of a client/server:</p>
<ul class="simple">
<li>Vulnerability can be exploited to read to eventually rewrite
variables on server’s stack</li>
<li>Vulnerability can be used to crash the system</li>
</ul>
</div>
</div>
<div class="section" id="shellcode-and-format-string">
<h2>Shellcode and Format String<a class="headerlink" href="#shellcode-and-format-string" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Stack cannot be smatched (but one can still write on the stack!).
However, one can rewrite content of addresses stored in the stack with
<code class="docutils literal"><span class="pre">%n</span></code>. The principle is very similar to the one used to evade a
canary. Let us write address of saved EIP in an appropriate place, so
that we can modify its content. <a class="footnote-reference" href="#id3" id="id1">[1]</a> <a class="footnote-reference" href="#id4" id="id2">[2]</a></div>
</div>
<div class="line-block">
<div class="line">Use GDB to find:</div>
</div>
<ul class="simple">
<li>saved EIP</li>
<li>beginning of buffer</li>
<li>Write A1 at beginning of buffer (i.e., A2), then use several <code class="docutils literal"><span class="pre">%x</span></code>
to reach the beginning of the buffer, i.e., A2, with <code class="docutils literal"><span class="pre">printf</span></code> and
<code class="docutils literal"><span class="pre">%n</span></code> to write some interesting address A3, which is inside the
buffer (to be expended, but likely to be a shellcode)</li>
</ul>
<p><strong>Observations:</strong></p>
<ol class="arabic simple">
<li>The position of the buffer in terms of arguments (<code class="docutils literal"><span class="pre">%x</span></code>) can be
obtained</li>
<li>Writing A3 requires to write several chars, indeed <code class="docutils literal"><span class="pre">%n</span></code> only counts
number of chars that are printed before reaching it!</li>
</ol>
<p><strong>How to:</strong></p>
<ol class="arabic simple">
<li>Prepare a shell code contained in a buffer, just as before</li>
<li>Write A1, address where saved EIP is saved at beginning of buffer,
i.e. at address A2</li>
<li>Then add some NOPS in the buffer and the shell code.</li>
<li>Then print several characteres with <code class="docutils literal"><span class="pre">%n</span></code> to write an adress A3 in
NOPS on A1 (preceded by # of <code class="docutils literal"><span class="pre">%x</span></code> to reach the buffer)</li>
<li>The address in NOPS thus replaces the one of saved EIP</li>
</ol>
<p>Assume that 5 times <code class="docutils literal"><span class="pre">%x</span></code> are enough to print beginning of buffer.
Position of beginning of arguments in terms of convention calls
<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> 5 argument.</p>
<ul>
<li><div class="first line-block">
<div class="line">|NOPS| <img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> |Shellcode| <img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> |Plenty of arguments|
<img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> |%Xd| <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> A3</div>
<div class="line">So one must chose X adequately. (not sure of the representation)</div>
</div>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/27.PNG"><img alt="../_images/27.PNG" class="align-center" src="../_images/27.PNG" style="width: 433.6px; height: 422.4px;" /></a>
<div class="section" id="difficulty">
<h3>Difficulty<a class="headerlink" href="#difficulty" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">We said to use <code class="docutils literal"><span class="pre">%n</span></code> to write an address in NOPS on A1 (<code class="docutils literal"><span class="pre">%n</span></code> counts
the number of characters printed before <code class="docutils literal"><span class="pre">%n</span></code>) We thus need to
display a lot of characters by using <code class="docutils literal"><span class="pre">$Xd</span></code>. <code class="docutils literal"><span class="pre">0xbffffe48</span></code> (A3)
corresponds to <code class="docutils literal"><span class="pre">3221225032</span></code> char in decimal. It may be the case that
displaying <code class="docutils literal"><span class="pre">0xbffffe48</span></code> chars is not possible (do not forget it is
an argument!) The argument would be too large.</div>
</div>
<div class="line-block">
<div class="line"><strong>Solution</strong>: how to write <code class="docutils literal"><span class="pre">0xbffffe48</span></code> (A3) in <code class="docutils literal"><span class="pre">0xbffffcec</span></code> (A1)</div>
</div>
<ul>
<li><p class="first">Use <code class="docutils literal"><span class="pre">%hn</span></code>, it is the same as <code class="docutils literal"><span class="pre">%n</span></code> except that it writes 2 bytes
instead of 4</p>
</li>
<li><p class="first">Split <code class="docutils literal"><span class="pre">0xbffffcec</span></code> into <code class="docutils literal"><span class="pre">0xbffffcee</span></code> and <code class="docutils literal"><span class="pre">bffffcec</span></code></p>
</li>
<li><p class="first">The objective will be to write <code class="docutils literal"><span class="pre">fe48</span></code> (65096) in<code class="docutils literal"><span class="pre">bffffcec</span></code> and
<code class="docutils literal"><span class="pre">bfff</span></code> (49151) in <code class="docutils literal"><span class="pre">bffffcee</span></code></p>
</li>
<li><div class="first line-block">
<div class="line">The form of the buffer is now:</div>
<div class="line"><code class="docutils literal"><span class="pre">bffffcee</span> <span class="pre">+</span> <span class="pre">bffffcec</span> <span class="pre">+</span> <span class="pre">NOPS</span> <span class="pre">+</span> <span class="pre">shellcode</span> <span class="pre">+</span> <span class="pre">%Xd</span> <span class="pre">+</span> <span class="pre">%5$hn</span> <span class="pre">+</span> <span class="pre">%Yd</span> <span class="pre">+</span> <span class="pre">6$hn</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Assume a shell code of size 39, and 34 NOPS</div>
<div class="line">Values for X and Y:</div>
</div>
<ul class="simple">
<li><img class="math" src="../_images/math/340798804a2b507db2548fb2e0bbc70951e311ba.png" alt="X= 49151 - 8- NOPS - SHELLCODE = 49070"/></li>
<li><img class="math" src="../_images/math/37ae355e5f41860994ed0bb41f476bf057abe2e2.png" alt="Y = 65096 - X - 8 - NOPS - SHELLCODE = 15945"/></li>
</ul>
</li>
</ul>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://github.com/JonathanSalwan/ROPgadget">https://github.com/JonathanSalwan/ROPgadget</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://www.exploit-db.com/docs/english/28553-linux-classic-return-to-libc-&amp;-return-to-libc-chaining-tutorial.pdf">https://www.exploit-db.com/docs/english/28553-linux-classic-return-to-libc-&amp;-return-to-libc-chaining-tutorial.pdf</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="prevention-detection">
<h2>Prevention/Detection<a class="headerlink" href="#prevention-detection" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><strong>Forbid</strong> <code class="docutils literal"><span class="pre">%n</span></code>: Does not prevent from reading memory and some
programs needs it.</li>
<li><strong>Permit only static format strings:</strong> Many programs use dynamic ones
(e.g Client/Server). In fact, the GNU internationalization library,
generate format strings dynamically, so this too would break an
undesirable amount of software.</li>
</ol>
<div class="section" id="lexical-analysis">
<h3>Lexical Analysis<a class="headerlink" href="#lexical-analysis" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">pscan</span></code> tool is a lexical analysis tool that automatically scans
source code for format string vulnerabilities. The scan works by
searching for formatted output functions and applying the following rule</p>
<p class="centered">
<strong>“<strong>IF</strong> the last parameter of the function is the format string, <strong>AND</strong> the
format string is <strong>NOT</strong> a static string, <strong>THEN</strong> complain”</strong></p><p><strong>Limits:</strong></p>
<ul class="simple">
<li>Does not detect vulnerabilities if arguments follow the string</li>
</ul>
</div>
<div class="section" id="formatguard-counting-the-number-of-arguments-old">
<h3>FormatGuard: Counting the number of arguments (old)<a class="headerlink" href="#formatguard-counting-the-number-of-arguments-old" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Patch to <code class="docutils literal"><span class="pre">glibc</span></code> rather old (from 2002) by restricting the number of
arguments processed by a variadic function to the actual number of
arguments passed. Done by replacing the normal call to a modified
function that uses a specific token based mechanism to count
arguments. Counting is hard arguments are passed as <code class="docutils literal"><span class="pre">varargs</span> <span class="pre">list</span></code>,
which has no counting mechanism. Use CPP macros and specific methods
to count arguments using <code class="docutils literal"><span class="pre">varargs</span></code>.</div>
</div>
<div class="line-block">
<div class="line"><strong>Limits:</strong></div>
</div>
<ul class="simple">
<li>Block function that contains fewer conversion convention than
arguments, can be fixed</li>
<li>Indirect call to functions disabled the mechanism</li>
<li>Some functions such as <code class="docutils literal"><span class="pre">vprintf</span></code> have their own <code class="docutils literal"><span class="pre">varargs</span> <span class="pre">list</span></code></li>
<li>CPP macros may not all be compatible with C</li>
<li>Requires <code class="docutils literal"><span class="pre">glibc</span></code> compilation, i e source code</li>
</ul>
</div>
<div class="section" id="compiler-option-now-replace-formatguard">
<h3>Compiler option (now replace formatguard)<a class="headerlink" href="#compiler-option-now-replace-formatguard" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">To warm about uses of format functions where the format string is not
a string literal and there are no format arguments. View it as
format-guard embedded.</div>
</div>
<div class="line-block">
<div class="line">Options Wformat (called with <code class="docutils literal"><span class="pre">-Wall</span></code>) and <code class="docutils literal"><span class="pre">-Wformat-security</span></code> of
gcc</div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gcc Wformat o fmt fmt.c fmt.c:19: warning: format %08x expects <span class="nb">type</span> unsigned int’, but argument <span class="m">3</span> has <span class="nb">type</span> ’int *’
    fmt.c:19: warning: too few arguments <span class="k">for</span> format
$ gcc Wformat Wformat security o fmt2 fmt2.c fmt2.c:13: warning: format not a string literal and no format arguments
</pre></div>
</div>
<p><strong>Limits:</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">int</span> <span class="pre">(*printf_ptr)</span> <span class="pre">(const</span> <span class="pre">char</span> <span class="pre">*format,...)=&amp;printf;</span></code></li>
</ul>
</div>
<div class="section" id="libsafe-implementation-for-n">
<h3>Libsafe Implementation (for <code class="docutils literal"><span class="pre">%n</span></code>)<a class="headerlink" href="#libsafe-implementation-for-n" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">Libsafe</span></code> known to implement safer versions of vulnerable ones.
Version 2 0 prevents format string vulnerability exploits that attempt
to overwrite return addresses on the stack. <code class="docutils literal"><span class="pre">Libsafe</span></code> logs a warning
and terminates the targeted process Its first task is to make sure
that the functions can be safely executed based on their arguments.
<strong>Does not require source code</strong>. <a class="footnote-reference" href="#id6" id="id5">[3]</a></div>
</div>
<div class="line-block">
<div class="line">Two checks:</div>
</div>
<ol class="arabic simple">
<li>The first check examines the pointer argument associated with each
<code class="docutils literal"><span class="pre">%n</span></code> conversion specifier to determine whether the address
references a return address or frame pointer</li>
<li>The second check determines whether the initial location of the
argument pointer is in the same stack frame as the final location of
the argument pointer</li>
</ol>
<p><strong>Limits:</strong></p>
<ul class="simple">
<li>Restrict access to current stack frame</li>
<li><strong>Problem:</strong> password may be stored there (hence can be modified/read)</li>
<li><strong>Conclusion:</strong> Does not protect from programs trying to read in the
stack frame</li>
</ul>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">It is extremely difficult to construct a test suite that exercises all
possible paths through a program. A major source of format string bugs
comes from error reporting code. Because such code is triggered as a
result of exceptional conditions, these paths are often missed by
runtime testing.</div>
</div>
<div class="line-block">
<div class="line"><strong>News</strong>: situation is changing (work of Xavier Devroye).</div>
</div>
</div>
<div class="section" id="static-taint-analysis">
<h3>Static Taint Analysis<a class="headerlink" href="#static-taint-analysis" title="Permalink to this headline">¶</a></h3>
<p>Inputs from untrusted sources are marked as tainted, data propagated
from a tainted source is marked as tainted. A warning is generated if
tainted data is interpreted as a format string but can generate a lot of
false positives.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td><a class="reference external" href="https://www.researchgate.net/publication/2400968_Libsafe_20_Detection_of_Format_String_Vulnerability_Exploits">Libsafe</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="format-string-versus-bo">
<h2>Format String versus BO<a class="headerlink" href="#format-string-versus-bo" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../_images/28.PNG"><img alt="../_images/28.PNG" class="align-center" src="../_images/28.PNG" style="width: 620.0px; height: 317.6px;" /></a>
</div>
<div class="section" id="some-vulnerabilities">
<h2>Some vulnerabilities<a class="headerlink" href="#some-vulnerabilities" title="Permalink to this headline">¶</a></h2>
<p><a class="footnote-reference" href="#id10" id="id7">[4]</a> <a class="footnote-reference" href="#id11" id="id8">[5]</a> <a class="footnote-reference" href="#id12" id="id9">[6]</a></p>
<a class="reference internal image-reference" href="../_images/29.PNG"><img alt="../_images/29.PNG" class="align-center" src="../_images/29.PNG" style="width: 592.0px; height: 319.2px;" /></a>
<div class="section" id="the-stunnem-vulnerability">
<h3>The Stunnem vulnerability<a class="headerlink" href="#the-stunnem-vulnerability" title="Permalink to this headline">¶</a></h3>
<p>Secure TCP connection via shannel. <code class="docutils literal"><span class="pre">smtp_client()</span></code> from version 3.2 is
vulnerable</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">stunnel</span> <span class="pre">-c</span> <span class="pre">-n</span> <span class="pre">smtp</span> <span class="pre">\</span> <span class="pre">-r</span> <span class="pre">127.0.0.1:4444</span></code> (client)</li>
<li><code class="docutils literal"><span class="pre">nc</span> <span class="pre">-l</span> <span class="pre">-p</span> <span class="pre">4444</span></code> (simulate smtp), <code class="docutils literal"><span class="pre">AAAA%x%x%x%x</span></code> will read
client’s stack</li>
</ul>
</div>
<div class="section" id="the-wu-ftpd-vulnerability">
<h3>The <code class="docutils literal"><span class="pre">wu-ftpd</span></code> vulnerability<a class="headerlink" href="#the-wu-ftpd-vulnerability" title="Permalink to this headline">¶</a></h3>
<p>Washington University FTP daemon <code class="docutils literal"><span class="pre">wu-ftpd</span></code> is a popular UNIX FTP
server shipped with many distributions of Linux and other UNIX operating
systems. A format string vulnerability exists in the <code class="docutils literal"><span class="pre">insite_exec()</span></code>
function of <code class="docutils literal"><span class="pre">wu-ftpd</span></code> versions before 2.6.1. <code class="docutils literal"><span class="pre">wu-ftpd</span></code> is a string
vulnerability where the user input is incorporated in the format string
of a formatted output function in the Site <code class="docutils literal"><span class="pre">Exec</span></code> command
functionality.</p>
</div>
<div class="section" id="the-cde-tooltalk-vulnerability">
<h3>The CDE ToolTalk vulnerability<a class="headerlink" href="#the-cde-tooltalk-vulnerability" title="Permalink to this headline">¶</a></h3>
<p>The common desktop environment CDE is an integrated graphical user
interface that runs on UNIX and Linux operating systems. CDE ToolTalk is
a message brokering system that provides an architecture for
applications to communicate with each other across hosts and platforms.
There is a remotely exploitable format string vulnerability in versions
of the CDE ToolTalk RPC database server.</p>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[4]</a></td><td><a class="reference external" href="https://repo.zenk-security.com/Techniques%20d.attaques%20%20.%20%20Failles/Hackin9%20Vulnerabilites%20de%20type%20format%20string.pdf">Technique</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[5]</a></td><td><a class="reference external" href="http://slidegur.com/doc/1080849/formatted-output-secure-coding-in-c-and-c---robert-c.-sea">http://slidegur.com/doc/1080849/formatted-output-secure-coding-in-c-and-c&#8212;robert-c.-sea</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[6]</a></td><td><a class="reference external" href="https://cs155.stanford.edu/papers/formatstring-1.2.pdf">https://cs155.stanford.edu/papers/formatstring-1.2.pdf</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Duchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.<br/>
    </p>
  </div>
</footer>
  </body>
</html>