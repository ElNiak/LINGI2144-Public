
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Memory Safety &#8212; Theory 2022 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Assembly/Debugger" href="../assembly/assembly.html" />
    <link rel="prev" title="Basic attacks/defences" href="../basis/privilege.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2022</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/index.html">Main</a></li>
                <li><a href="/exercice/index.html">Tutorial</a></li>
                <li><a href="/qcm/index.html">MCQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#am-i-allowed-to-do-that">Am I allowed to do that?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#the-blaster-lovesan-worm">The Blaster/Lovesan worm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#the-off-by-one-vulnerability">The “off by one vulnerability”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#facts">Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisI/introduction.html">Malware Analysis I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisI/introduction.html#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisII/analysis.html">Malware Analysis II</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#malware-analysis">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisII/analysis.html#dynamic-analysis">Dynamic Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../malware_analysisIII/packing.html">Malware Analysis III</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../malware_analysisIII/packing.html#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="row" style="padding-top: 20px">
    <div class="col-xs-6">
        <form id="rar_tp"  target="_blank" style="text-align:center;" method="get" action="">
            <button style="text-align:center; border-radius:12px;" type="submit" class="up">
                <svg id="Capa_1"
                     width="50px" height="50px"
                     enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><path d="m453.31 460.125c0 24.508-19.907 44.375-44.464 44.375h-305.692c-24.557 0-44.464-19.867-44.464-44.375v-408.25c0-24.508 19.907-44.375 44.464-44.375h190.303c8.857 0 17.35 3.516 23.606 9.773l126.505 126.521c6.239 6.239 9.742 14.694 9.742 23.508z" fill="#f9f8f9"/><path d="m133.15 504.5h-30c-24.55 0-44.46-19.87-44.46-44.38v-408.24c0-24.51 19.91-44.38 44.46-44.38h30c-24.55 0-44.46 19.87-44.46 44.38v408.24c0 24.51 19.91 44.38 44.46 44.38z" fill="#e3e0e4"/><path d="m453.31 167.3v16.24h-115.96c-33.12 0-60.06-26.95-60.06-60.07v-115.97h16.17c8.85 0 17.35 3.52 23.6 9.77l126.51 126.52c6.24 6.24 9.74 14.7 9.74 23.51z" fill="#e3e0e4"/><path d="m450.32 153.54h-112.97c-16.6 0-30.06-13.46-30.06-30.07v-112.96c3.61 1.63 6.92 3.91 9.77 6.76l126.51 126.52c2.85 2.85 5.12 6.15 6.75 9.75z" fill="#b9a1d3"/><path d="m435 438.5h-358c-22.091 0-40-17.909-40-40v-146c0-22.091 17.909-40 40-40h358c22.091 0 40 17.909 40 40v146c0 22.091-17.909 40-40 40z" fill="#b9a1d3"/><path d="m102 438.5h-25c-22.09 0-40-17.91-40-40v-146c0-22.09 17.91-40 40-40h25c-22.09 0-40 17.91-40 40v146c0 22.09 17.91 40 40 40z" fill="#9573bb"/></g><g><path d="m58.689 153.851c4.143 0 7.5-3.357 7.5-7.5v-94.476c0-20.333 16.582-36.875 36.965-36.875h111.42c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-111.42c-28.653 0-51.965 23.271-51.965 51.875v94.476c0 4.142 3.358 7.5 7.5 7.5z"/><path d="m460.811 212.656v-45.354c0-10.879-4.24-21.111-11.938-28.811l-126.506-126.52c-7.718-7.72-17.985-11.971-28.91-11.971h-43.394c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h43.394c2.165 0 4.288.264 6.334.775v107.696c0 20.714 16.85 37.566 37.561 37.566h107.694c.505 2.025.765 4.125.765 6.265v38.954c-3.476-.812-7.092-1.256-10.811-1.256h-23.319c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h23.319c17.921 0 32.5 14.579 32.5 32.5v146c0 17.921-14.579 32.5-32.5 32.5h-268.66c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h268.66c3.719 0 7.335-.444 10.811-1.256v15.381c0 20.333-16.582 36.875-36.965 36.875h-305.692c-20.383 0-36.965-16.542-36.965-36.875v-15.381c3.476.812 7.092 1.256 10.811 1.256h53.319c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-53.319c-17.921 0-32.5-14.579-32.5-32.5v-146c0-17.921 14.579-32.5 32.5-32.5h299.702c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-299.702c-3.719 0-7.335.444-10.811 1.256v-24.905c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v31.305c-13.04 8.477-21.689 23.165-21.689 39.844v146c0 16.679 8.649 31.367 21.689 39.844v21.781c0 28.604 23.312 51.875 51.965 51.875h305.691c28.653 0 51.965-23.271 51.965-51.875v-21.781c13.041-8.477 21.689-23.165 21.689-39.844v-146c.001-16.679-8.648-31.367-21.688-39.844zm-146.02-89.185v-97.863l120.414 120.429h-97.854c-12.439 0-22.56-10.123-22.56-22.566z"/><path d="m265.669 264.091c-1.584-3.853-5.297-6.341-9.462-6.341-.003 0-.006 0-.009 0-4.168.004-7.882 2.499-9.461 6.356-.023.057-.046.114-.067.172l-45.247 118.803c-1.475 3.87.469 8.203 4.34 9.678 3.865 1.475 8.203-.468 9.678-4.34l9.429-24.757h62.347l9.335 24.736c1.458 3.914 5.891 5.823 9.665 4.368 3.875-1.462 5.831-5.789 4.368-9.665l-44.836-118.808c-.025-.067-.053-.135-.08-.202zm-35.087 84.571 25.603-67.226 25.37 67.226z"/><path d="m181.648 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.588-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/><path d="m410.5 296.566c0-21.403-18.208-38.816-40.589-38.816h-32.021c-.007 0-.013.001-.02.001-.006 0-.013-.001-.019-.001-4.143 0-7.5 3.357-7.5 7.5v120.5c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-50.27c1.064-.006 2.204-.012 3.398-.018l48.62 55.243c2.745 3.118 7.488 3.403 10.585.675 3.109-2.736 3.411-7.476.675-10.585l-39.967-45.411c.438 0 .862-.001 1.249-.001 22.381 0 40.589-17.413 40.589-38.817zm-40.589-23.816c13.87 0 25.589 10.906 25.589 23.816s-11.719 23.816-25.589 23.816c-5.593 0-16.825.056-24.342.096-.042-7.433-.099-18.474-.099-23.912 0-4.577-.032-16.093-.057-23.816z"/></g></g>
                </svg>
                <br> <b> Slides </b>
            </button>
        </form>
    </div>
    <div class="col-xs-6">
        <form id="vid_tp" style="text-align:center;">
	<a id="notUp"  href="#!" style="text-align:center;"
   data-title="Watch now on youtube">
            <button class="video-btn up" onclick="topFunction()"
                    style="text-align:center; border-radius:12px;" data-toggle="modal" type="button"
                    data-target="#myModal"
                    data-src="">
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg width="50px" height="50px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 512.003 512.003" style="enable-background:new 0 0 512.003 512.003;" xml:space="preserve">
<path style="fill:#E53935;" d="M443.734,80.336L330.86,70.437c-49.812-4.334-99.906-4.334-149.717,0L68.268,80.336
	c-38.702,3.124-68.459,35.541-68.267,74.368v202.667c-0.204,38.835,29.557,71.265,68.267,74.389l112.939,9.813
	c24.832,2.133,49.835,3.243,74.859,3.243c25.024,0,50.027-1.067,74.859-3.243l112.939-9.813c38.659-3.187,68.348-35.6,68.139-74.389
	V154.704C512.194,115.877,482.436,83.459,443.734,80.336z"/>
<path style="fill:#FAFAFA;" d="M357.782,247.077l-149.333-96c-4.951-3.193-11.552-1.768-14.745,3.183
	c-1.111,1.722-1.702,3.728-1.703,5.777v192c0.002,5.891,4.78,10.665,10.671,10.663c2.049-0.001,4.055-0.592,5.777-1.703l149.333-96
	c4.954-3.187,6.387-9.787,3.2-14.742c-0.825-1.283-1.917-2.374-3.2-3.2V247.077z"/>
<path d="M256.001,444.816c-25.003,0-50.005-1.088-74.837-3.243l-112.896-9.835c-38.71-3.124-68.471-35.554-68.267-74.389V154.683
	c-0.182-38.819,29.573-71.224,68.267-74.347l112.896-9.899c49.797-4.334,99.877-4.334,149.675,0l112.96,9.813
	c38.717,3.158,68.454,35.629,68.203,74.475v202.667c0.204,38.835-29.557,71.265-68.267,74.389l0,0l-112.96,9.813
	C306.028,443.771,281.004,444.816,256.001,444.816z M256.001,88.549c-24.405,0-48.768,1.067-72.981,3.157L69.953,101.52
	c-27.614,2.317-48.794,25.495-48.619,53.205v202.667c-0.116,27.7,21.097,50.827,48.704,53.099l112.96,9.813
	c48.57,4.209,97.414,4.209,145.984,0l113.067-9.813c27.589-2.315,48.76-25.456,48.619-53.141V154.683
	c0.116-27.7-21.097-50.827-48.704-53.099l-112.96-9.813c-24.235-2.105-48.569-3.164-73.003-3.179V88.549z"/>
<path d="M202.668,362.704c-5.891,0-10.667-4.776-10.667-10.667v-192c-0.01-5.891,4.758-10.674,10.649-10.684
	c2.057-0.003,4.07,0.588,5.799,1.703l149.333,96c4.96,3.178,6.405,9.776,3.227,14.736c-0.83,1.296-1.931,2.397-3.227,3.227
	l-149.333,96C206.724,362.124,204.717,362.709,202.668,362.704z M213.334,179.579v152.917l118.933-76.459L213.334,179.579z"/>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <br> <b>  Video </b>
            </button>
        </a>
</form>

  <!-- Modal -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-body">

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div id="video-view" class="embed-responsive embed-responsive-16by9">

          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Memory Safety</a><ul>
<li><a class="reference internal" href="#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a><ul>
<li><a class="reference internal" href="#processor-and-memory">Processor and memory</a></li>
<li><a class="reference internal" href="#memory-principles">Memory principles</a></li>
<li><a class="reference internal" href="#registers-organisation">Registers organisation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a><ul>
<li><a class="reference internal" href="#heap-memory-management">Heap memory management</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">Memory Safety</a><ul>
<li><a class="reference internal" href="#conditions-to-break-memory-safety">Conditions to break memory safety</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prevention-detection">Prevention/detection</a><ul>
<li><a class="reference internal" href="#protections">Protections</a></li>
<li><a class="reference internal" href="#static-detection">Static Detection</a></li>
<li><a class="reference internal" href="#runtime-solutions">Runtime Solutions</a><ul>
<li><a class="reference internal" href="#what-about-untyped-languages">What about untyped languages</a></li>
<li><a class="reference internal" href="#what-about-java">What about java</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="memory-safety">
<h1>Memory Safety<a class="headerlink" href="#memory-safety" title="Permalink to this headline">¶</a></h1>
<div class="section" id="memory-handling-and-impact-of-memory-corruption">
<h2>Memory handling and impact of memory corruption<a class="headerlink" href="#memory-handling-and-impact-of-memory-corruption" title="Permalink to this headline">¶</a></h2>
<p>Memory corruption is as old as operating systems and networks and
exploitation/facilities really depends on the programming language in
use. <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</p>
<p>As small reminder, one byte is the concatenation of 8 bits and allow to
encode 255 values in the decimal system. For the hexadecimal system,
digits are between 0 and 15(F) and are the concatenation of 4 bits so
two digits make one byte.</p>
<div class="section" id="processor-and-memory">
<h3>Processor and memory<a class="headerlink" href="#processor-and-memory" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A computer is composed of a processor which read and write instruction
stored in memory. Processor can also use specific memory locations
called registers.</div>
</div>
<div class="line-block">
<div class="line">Execution can modify registers and memory, it repeat :</div>
</div>
<ol class="arabic">
<li><p class="first">Processor <strong>fetches</strong> instruction whose address is stored in EIP
(<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> register containing the next instruction to be executed)</p>
</li>
<li><p class="first">Processor <strong>decodes</strong> the instruction</p>
</li>
<li><div class="first line-block">
<div class="line">Processor <strong>executes</strong> the instruction</div>
</div>
</li>
</ol>
<p><strong>Instructions</strong> are the building blocks of assembly programs. In x86
assembly (32 bits systems), it is made of a</p>
<ul>
<li><p class="first">mnemonic/instruction <img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> zero or more operands</p>
</li>
<li><p class="first">Operands are typically registers, memory addresses, or data
(immediate)</p>
</li>
<li><p class="first">Example : <code class="docutils literal notranslate"><span class="pre">MOV</span> <span class="pre">ECX,</span> <span class="pre">0x42</span></code></p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MOV</span> <span class="pre">ECX</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">0XB9</span></code> (instruction)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">0x42</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">0x42000000</span></code> (operands)</p>
</li>
<li><div class="first line-block">
<div class="line">The machine views <code class="docutils literal notranslate"><span class="pre">B9</span> <span class="pre">42</span> <span class="pre">00</span> <span class="pre">00</span> <span class="pre">00</span></code></div>
</div>
</li>
</ul>
</li>
</ul>
<p>Two types of processors:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">CISC (Complex Instruction Set) (e.g intel 8086)</th>
<th class="head">RISC (Reduced Instruction) (e.g sparc)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Lots of instructions and different clock cycles</td>
<td>Small number of instructions, and more predictable clock cycles</td>
</tr>
<tr class="row-odd"><td>Lots of transfers with memory</td>
<td>Few transfers with memory, lots of registers</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="memory-principles">
<h3>Memory principles<a class="headerlink" href="#memory-principles" title="Permalink to this headline">¶</a></h3>
<p>Memory is viewed as a large table where addresses are coded on bytes, a
<strong>word</strong> is a sequence of bytes (between 32 and 64 bits) and also define the
size of addresses and registers (for 32 bits, it’s 4 bytes, i.e 8
hexadecimal digits).</p>
<ul class="simple">
<li>Number of addresses <strong>excluding</strong> the “start” and “end” address:
<img class="math" src="../_images/math/fce64ed6cb1b3a4b8db20a0a71c8e4d397af34b6.png" alt="end_{10/decimal} - start_{10} -1"/></li>
<li>Number of addresses <strong>including</strong> the “start and “end” address:
<img class="math" src="../_images/math/0036138eb8573247483074394e7d7d8bf7841896.png" alt="end_{10} - start_{10} +1"/></li>
</ul>
<p>Note that memory gestion unit <strong>virtualizes</strong> the memory space which
means that each software program thus has the impression to access the
entire memory space even if not.</p>
<a class="reference internal image-reference" href="../_images/5.PNG"><img alt="../_images/5.PNG" class="align-center" src="../_images/5.PNG" style="width: 575.5px; height: 399.5px;" /></a>
</div>
<div class="section" id="registers-organisation">
<h3>Registers organisation<a class="headerlink" href="#registers-organisation" title="Permalink to this headline">¶</a></h3>
<p>General registers (32 bits) for data :</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">EAX</span></code>: usually reserved to store the output of function call</li>
<li><code class="docutils literal notranslate"><span class="pre">EBX</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ECX</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">EDX</span></code></li>
</ol>
<div class="line-block">
<div class="line">Six segments registers (16 bits) for part of memory address: <code class="docutils literal notranslate"><span class="pre">CS</span></code> ,
<code class="docutils literal notranslate"><span class="pre">SS</span></code>, <code class="docutils literal notranslate"><span class="pre">DS</span></code>, <code class="docutils literal notranslate"><span class="pre">ES</span></code>, <code class="docutils literal notranslate"><span class="pre">FS</span></code>, <code class="docutils literal notranslate"><span class="pre">GS</span></code>.</div>
</div>
<div class="line-block">
<div class="line">Offset registers (offset wrt to segment register)</div>
</div>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">EIP</span></code> contains address of the next instruction to be executed</li>
<li><code class="docutils literal notranslate"><span class="pre">EBP</span></code> is the base stack register, used to know where we are in the
stack</li>
<li><code class="docutils literal notranslate"><span class="pre">ESP</span></code> is the top stack pointer (hence lowest address in the stack)</li>
<li><code class="docutils literal notranslate"><span class="pre">ESI</span></code> and <code class="docutils literal notranslate"><span class="pre">EDI</span></code> are used to offset position of some data for
specific operations</li>
</ol>
<p>And finally, special registers for the processor.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://ieeexplore.ieee.org/document/6547101/?arnumber=6547101">https://ieeexplore.ieee.org/document/6547101/?arnumber=6547101</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="vulnerabilities-stack-and-heap">
<h2>Vulnerabilities stack and heap<a class="headerlink" href="#vulnerabilities-stack-and-heap" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Languages such as C offer a wide range of memory access errors. Those
are known to be exploitable vulnerabilities for a wide range of
exploits. <a class="footnote-reference" href="#id8" id="id3">[2]</a> <a class="footnote-reference" href="#id9" id="id4">[3]</a> <a class="footnote-reference" href="#id10" id="id5">[4]</a></div>
</div>
<div class="line-block">
<div class="line">Two important structures, (1) <strong>the stack</strong> which store local variables and
parameters function and (2) <strong>the heap</strong> that stores dynamic variables. Those
two structures interact with each other through pointers:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>                     <span class="c1">//The address of memory allocated for buffer is stored in the stack</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">);</span> <span class="c1">//The allocated memory is “somewhere” in the heap.</span>
</pre></div>
</div>
<p><strong>Main stack exploit/vulnerability :</strong></p>
<ul>
<li><p class="first"><strong>Buffer overflow (Stack)</strong>: Buffer overflow is when you’re allowed
to <strong>smash</strong> the stack, that is to write in the stack where you
should not. (Can also happen on heap, but with different
consequences). Often requires the <strong>ability to execute the stack</strong>.</p>
<ul class="simple">
<li>Potential exploits are: shellcode, backdoor, variable value
modification, or denial of service</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;here is the value d&quot;</span><span class="p">,</span><span class="n">buffer</span><span class="p">[</span><span class="mi">1000</span><span class="p">]);</span>
    <span class="c1">//Segmentation fault = Access data which is potentially outside of stack of the process, or not allowed</span>
    <span class="c1">//No SF certainly means that we touch something still in the stack</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Format string (Stack)</strong>: Format string is simply abusing functions
like <code class="docutils literal notranslate"><span class="pre">printf</span></code> to read/write memory</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">//If no argument matches %d , then one reads what it at the place where the argument should be</span>
    <span class="c1">//It create a hole in memory that may be written</span>
    <span class="c1">//With %n , can also be used to write on the</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello, %d %d %d %d&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="heap-memory-management">
<h3>Heap memory management<a class="headerlink" href="#heap-memory-management" title="Permalink to this headline">¶</a></h3>
<p>Heap works by allocating chunks of bytes allocated as free memory
(<code class="docutils literal notranslate"><span class="pre">malloc</span></code>). The heap is thus a double linked list of chunks with:</p>
<ul class="simple">
<li>A pointer to the first element (head of heap), i.e., to the first
free memory space</li>
<li>A pointer to previous chunk, one to next chunk</li>
<li>Data from the user.</li>
</ul>
<a class="reference internal image-reference" href="../_images/6.PNG"><img alt="../_images/6.PNG" class="align-center" src="../_images/6.PNG" style="width: 632.5px; height: 184.5px;" /></a>
<p>When one frees some memory (free), chunks are stored in list to be
“quickly”. Those list are <code class="docutils literal notranslate"><span class="pre">fastbin</span></code> (very few bytes), small bin, unsorted
bin and they depend on the size of the chunk and playing with them may
lead to vulnerabilities. When allocating memory, always replace the
first most similar chunk in size.</p>
<p><strong>Main heap exploit/vulnerability :</strong></p>
<ul>
<li><p class="first"><strong>Used after free vulnerability</strong>: Potential exploit consist to
program allocates and then later frees memory block A. Attacker
allocates a memory block B, reusing the memory previously allocated
to block A. Attacker writes data into block B. Program uses freed
block A, accessing the data the attacker left there <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> <strong>Code
reuse exploit</strong></p>
<ul class="simple">
<li><strong>This is a memory safety issue:</strong> the semantics of the language does
not match the one on the system where it is executed.</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//example 1</span>
<span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">vulnfunc</span> <span class="p">)();</span>
<span class="p">}</span> <span class="n">exploitable</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">legitimate</span><span class="p">(){</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;I am the legitimate </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;I am the bad function </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">exploitable</span> <span class="o">*</span><span class="n">malloc1</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">exploitable</span><span class="p">));</span>
    <span class="n">malloc1</span><span class="o">-&gt;</span><span class="n">vulnfunc</span> <span class="o">=</span> <span class="n">legitimate</span><span class="p">;</span>
    <span class="n">malloc1</span><span class="o">-&gt;</span><span class="n">vulnfunc</span><span class="p">();</span>         <span class="c1">//I am the legitimate function</span>
    <span class="n">free</span><span class="p">(</span><span class="n">malloc1</span><span class="p">);</span>               <span class="c1">//Prevention: malloc1 = NULL;</span>
    <span class="c1">//long *malloc3 = malloc(0); //with that we got a segfault at L1 =&gt; malloc3 has now taken the place of malloc2</span>
                                 <span class="c1">//in the chunk of the stack.Consequently, malloc3 points to a new chunk that must be assigned</span>
    <span class="kt">long</span> <span class="o">*</span><span class="n">malloc2</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>   <span class="c1">//Will access the preceding free memory without erasing it.</span>
    <span class="o">*</span><span class="n">malloc2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">bad</span><span class="p">;</span>
    <span class="n">malloc1</span><span class="o">-&gt;</span><span class="n">vulnfunc</span><span class="p">();</span>         <span class="c1">//L1 : I am the bad function</span>
                                 <span class="c1">//Should throw memory error</span>
                                 <span class="c1">//Explanation : malloc2 took the space of malloc1</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//example 2</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">admin</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">admin</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="n">admin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">admin</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">admin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//(1) we have admin[0] = 0</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;not allowed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">admin</span><span class="p">);</span> <span class="c1">//(2) we free admin, but not set it to Null</span>
  <span class="n">name</span><span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span> <span class="c1">//(3) ) name takes the place of admin</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;pixis&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">//(4) name[0] is set to “p” and so is admin[0]</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">admin</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">admin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//(5) admin[0] is thus no longer equal to 0</span>
       <span class="n">printf</span><span class="p">(</span><span class="s">&quot;not allowed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
       <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allowed: you&#39;re in secret zone! !</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="n">free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> 
   <span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
   <span class="cm">/*</span>
<span class="cm">   should give:                                 </span>
<span class="cm">    not allowed!</span>
<span class="cm">    not allowed!</span>
<span class="cm">   However, it gives:</span>
<span class="cm">    not allowed!</span>
<span class="cm">    Allowed: you’re in secret zone!</span>
<span class="cm">   Admin has been freed, but not set to NULL</span>
<span class="cm">   */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Complementary: Use tools such as <code class="docutils literal notranslate"><span class="pre">VALGRIND</span></code>.</p>
<a class="reference internal image-reference" href="../_images/valgrind.png"><img alt="../_images/valgrind.png" class="align-center" src="../_images/valgrind.png" style="width: 390.5px; height: 280.0px;" /></a>
</li>
<li><p class="first"><strong>Double free vulnerability</strong>: the <strong>exploit</strong> is here to read write part
of the memory you should not touch. Here the justification with the
state of the <code class="docutils literal notranslate"><span class="pre">freelist/fastbin</span></code> according to free and malloc:</p>
<ol class="arabic simple">
<li><img class="math" src="../_images/math/1ed05f5b0969b6a16408254c875153422523a82c.png" alt="head \rightarrow a \rightarrow tail"/></li>
<li><img class="math" src="../_images/math/af11b22aead0305fe89fbfc8b7cacfa9cb936885.png" alt="head \rightarrow b \rightarrow a \rightarrow tail"/></li>
<li><img class="math" src="../_images/math/eaa1587f0edb8bd8e7685b3d25fd4308ac6906a6.png" alt="head \rightarrow a \rightarrow b \rightarrow a \rightarrow tail"/></li>
<li><img class="math" src="../_images/math/af11b22aead0305fe89fbfc8b7cacfa9cb936885.png" alt="head \rightarrow b \rightarrow a \rightarrow tail"/> [’a’ is
returned]</li>
<li><img class="math" src="../_images/math/1ed05f5b0969b6a16408254c875153422523a82c.png" alt="head \rightarrow a \rightarrow tail"/> [’b’ is returned]</li>
<li><img class="math" src="../_images/math/1161a23d2a3ac0c6f416786276bb7463bb9e0a90.png" alt="head \rightarrow tail"/> [’a’ is returned]</li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="o">*</span><span class="n">e</span><span class="p">,</span><span class="o">*</span><span class="n">f</span><span class="p">;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">free</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>                 <span class="c1">//Justification from here</span>
    <span class="n">free</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>                 <span class="c1">//double free</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;voici la valeur %d&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">d</span><span class="p">);</span><span class="c1">//5</span>
    <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;voici la valeur %d&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">d</span><span class="p">);</span><span class="c1">//6</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Null pointer abuse</strong>: This example takes an IP address from a user,
verifies that it is well formed and then looks up the hostname and
copies it into a buffer. <a class="footnote-reference" href="#id11" id="id6">[5]</a></p>
<p>If an attacker provides an address that appears to be well formed,
but the address does not resolve to a hostname, then the call to
<code class="docutils literal notranslate"><span class="pre">gethostbyaddr()</span></code> will return NULL. Since the code does not check
the return value from <code class="docutils literal notranslate"><span class="pre">gethostbyaddr()</span></code> , a NULL pointer
dereference would then occur in the call to <code class="docutils literal notranslate"><span class="pre">strcpy()</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">host_lookup</span><span class="p">(</span><span class="kt">char</span>  <span class="o">*</span><span class="n">user_supplied_addr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">hostent</span> <span class="o">*</span><span class="n">hp</span><span class="p">;</span>
    <span class="n">in_addr_t</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">hostname</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="n">in_addr_t</span> <span class="n">inet_addr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cp</span><span class="p">);</span>
    <span class="cm">/*routine that ensures user_supplied_addr is in the right format for conversion */</span>
    <span class="n">validate_addr_form</span><span class="p">(</span><span class="n">user_supplied_addr</span><span class="p">);</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">user_supplied_addr</span><span class="p">);</span>
    <span class="n">hp</span> <span class="o">=</span> <span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">in_addr</span><span class="p">),</span> <span class="n">AF_INET</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span><span class="n">hp</span><span class="o">-&gt;</span><span class="n">h_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Control flow Hijacking</strong>: Redirect the flow to an already
existing executable code in memory.</div>
<div class="line">Example: buffer overflow and executable shell code in the stack</div>
</div>
</li>
<li><p class="first"><strong>Return Oriented Programming</strong>: 64 bit X86 processors the first
argument to a function to be passed in a register. ROPlooks for
functions that pop values from the stack into registers.</p>
</li>
<li><div class="first line-block">
<div class="line"><strong>Non control data attacks</strong>: Corrupt the data. <a class="footnote-reference" href="#id12" id="id7">[6]</a></div>
<div class="line">Example: corrupt the parameters of a sensitive function (disable
security check)</div>
</div>
</li>
</ul>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>“<em>Control Flow Bending: On the effectiveness of control flow
integrity</em>”</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>“<em>Softbound : Highly Compatible and Complete Spacial Memory Safety
for C</em>”</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td><a class="reference external" href="https://nebelwet.net/teaching/16-527-SoftSec/slides/02-memory_safety.pdf">https://nebelwet.net/teaching/16-527-SoftSec/slides/02-memory_safety.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[5]</a></td><td><a class="reference external" href="https://cwe.mitre.org/data/definitions/476.html">https://cwe.mitre.org/data/definitions/476.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[6]</a></td><td><a class="reference external" href="https://github.com/JonathanSalwan/ROPgadget">https://github.com/JonathanSalwan/ROPgadget</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id13">
<h2>Memory Safety<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">There is often a gap between the semantic of the language and the one
of the machine on which it is executed. Allows us to step out of the
restrictions imposed by the programming language and access memory out
of context. <strong>In fact C is considered to be memory unsafe.</strong> This
weakness/vulnerability is the root for many exploits (crash, leakage,
…). Enforcing memory safety has a (potentially high) complexity
cost.</div>
</div>
<div class="line-block">
<div class="line">To avoid the above mention exploits/vulnerabilities, a definition of
memory safety is required:</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">The SoK paper proposes : <strong>“A program execution is memory safe so
long as memory access error does not occur”</strong>.</div>
<div class="line">This is not a definition, but rather a consequence of a potential
definition (what is an error?)</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Prof Mathias Payers proposes a definition based on the concept of
“runtime”: “Memory safety is a property that ensures that all memory
accesses adhere to the semantics defined by the source programming
language.” <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> <strong>A contract</strong> is thus passed between user and
compiler.</div>
<div class="line">Payer: “The gap between the operational semantics of the programming
language and the underlying instructions provided by the hardware
allow an attacker to step out of the restrictions imposed by the
programming language and access memory out of context.”</div>
</div>
</li>
</ol>
<p>Example :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span><span class="sc">&#39;c&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>By definition of the semantics of C language, pointer
deference have to stay within bounds of their pointer’s valid objects.
However, if the outside bound memory location is available, the machine
on which the program is executed may accept it.</p>
<ul class="simple">
<li><strong>Conclusion:</strong> memory safety is a general property that should be
defined at runtime. A program is memory safe if all of its executions
are safe</li>
</ul>
<div class="section" id="conditions-to-break-memory-safety">
<h3>Conditions to break memory safety<a class="headerlink" href="#conditions-to-break-memory-safety" title="Permalink to this headline">¶</a></h3>
<p>Memory access errors can be split into two classes:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Those where a pointer become “dangling”</div>
<div class="line"><strong>Temporal memory safety</strong></div>
</div>
<ul>
<li><div class="first line-block">
<div class="line">All memory dereferences are valid at the time of the dereference</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">the pointed to object is the same as when the pointer was created.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Example: used after free, double free, etc</div>
</div>
</li>
</ul>
</li>
<li><div class="first line-block">
<div class="line">Those where a pointer goes out of bound</div>
<div class="line"><strong>Spacial memory safety</strong></div>
</div>
<ul class="simple">
<li>all memory dereferences are within bounds of their pointer’s valid
objects.</li>
<li>An object’s bounds are defined when the object is allocated.</li>
<li>Any computed pointer to that object inherits the bounds of the
object. Any pointer arithmetic can only result in a pointer inside
the same object.</li>
<li>Example :</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span><span class="sc">&#39;c&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="prevention-detection">
<h2>Prevention/detection<a class="headerlink" href="#prevention-detection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="protections">
<h3>Protections<a class="headerlink" href="#protections" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><strong>(static) Detection</strong> consists in deploying a series of techniques
to check whether software suffers from a memory access error<ul>
<li>Techniques for detection includes (but are not limited to):
fuzzing, static code analysis, formal verification, model based
testing, control flow integrity…</li>
</ul>
</li>
<li><strong>Runtime solution</strong> consists in deploying techniques to prevent
memory access errors during execution (in which case the software is
stopped)<ul>
<li>Runtime solutions include fat pointers and global objects.</li>
</ul>
</li>
</ol>
<div class="line-block">
<div class="line">Should be deployed when being <strong>taken off-the-shell</strong>, detection is
definitively useful but is likely to cost or to be imprecise. We have
a false positive vs a false negative trade off.</div>
</div>
<div class="line-block">
<div class="line">There are also problems related to knowledge since we may not have all
information regarding dynamic libraries or about the environment in
where the software is used. Unfortunately detection tools are very
static and need full knowledge consequently, a runtime protection may
be useful. In fact, it will mainly depends on the time you have, on
code compatibility, or on code complexity.</div>
</div>
</div>
<div class="section" id="static-detection">
<h3>Static Detection<a class="headerlink" href="#static-detection" title="Permalink to this headline">¶</a></h3>
<p>Detection solutions typically done at <strong>conception</strong> time.</p>
<p>They execute the code:</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Testing</strong> (which test specification)</div>
<div class="line">Compares input/output wrt a model/some requirements and requires
manual writing of all the test code/cases. Good for testing what
the test writer knows/spec but <strong>rarely catches anything unexpected
(problematic for security)</strong>. Good coverage requires extensive test
writing (E.g. to test all of a <img class="math" src="../_images/math/5b7b6f62ca680b9dbe723209d5f3dfc7bf2e4a29.png" alt="64"/> bit input requires
<img class="math" src="../_images/math/35a5844e58da255d6c258648f3abcd8ddfd1986b.png" alt="2^{64}"/> tests). Not effective for (non trivial) memory
problems, difficult for concurrent systems (quantitative systems
are even worse)</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Fuzzing inputs</strong> (modify structure, outside specifications)</div>
<div class="line">Good for adding “noise” to functions/values (push it where things
are not specified). Good fuzzers can find interesting errors
(exhausts unspecified inputs <img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/> <strong>great for
security</strong>). As before, good coverage requires extensive running of
the fuzzer. Difficult to fuzz input without clear strategy
(symbolic execution or deep learning) but purely random in many
cases.</div>
</div>
<ul class="simple">
<li>Well known tool: <code class="docutils literal notranslate"><span class="pre">American</span> <span class="pre">fuzzer</span> <span class="pre">loop</span></code>, <code class="docutils literal notranslate"><span class="pre">radamsa</span></code> , <code class="docutils literal notranslate"><span class="pre">zzuff</span></code>, <code class="docutils literal notranslate"><span class="pre">webfuzz</span></code>
(for the web).</li>
</ul>
</li>
</ul>
<p>They work on a math model:</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Verification</strong></div>
<div class="line">Tries to verify system represented by a <strong>math model</strong>. Usually a
combination of manual and automated efforts (fully not yet
feasible). It allow to prove that bugs do not exist, since lack of
proof implies bug is possible. Longly considered as impractical
since too big and unclear semantics/specification but recent
progress can make it useful for ecology/energy saving.</div>
</div>
</li>
<li><p class="first"><strong>Model checking</strong> (not really used)</p>
<a class="reference internal image-reference" href="../_images/7.PNG"><img alt="../_images/7.PNG" class="align-center" src="../_images/7.PNG" style="width: 367.5px; height: 172.5px;" /></a>
<p>Example of model checker:</p>
<ul class="simple">
<li>SPIN (<a class="reference external" href="http://spinroot.com/spin/whatispin.html">http://spinroot.com/spin/whatispin.html</a>)</li>
<li>UPPAAL (<a class="reference external" href="https://uppaal.org/">https://uppaal.org/</a>)</li>
<li>Able to handle case of large size (Metro, Nasa Rover, …)</li>
<li>Don’t forget the math model (for system and specifications)!</li>
<li><strong>The checker can handle things that can be represented within the
model</strong></li>
</ul>
<p>Examples of a “math model”:</p>
<a class="reference internal image-reference" href="../_images/mathmodel.png"><img alt="../_images/mathmodel.png" class="align-center" src="../_images/mathmodel.png" style="width: 547.5px; height: 279.5px;" /></a>
<p>Difficulties with model checking:</p>
<ol class="arabic simple">
<li>The math model needs to be created (often manually)</li>
<li>Often done via pseudo-code</li>
<li>Warning: Explore all behaviors <img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> State-space
explosion problem</li>
</ol>
<p>In practice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>C Good to handle global specification: «if I have the access code,
then I can enter»

Not so good to handle memory-based properties: «there is no buffer
overflow in this code»
</pre></div>
</div>
<p><strong>Solution</strong>: Bounded model checking</p>
<ul>
<li><p class="first">Explore all paths up to a certain depth (no liveness)</p>
</li>
<li><p class="first">Often based on translating the code to Boolean Formula (automatic)</p>
</li>
<li><p class="first">Still a math model … but with efficient decision procedures</p>
</li>
<li><p class="first">Can handle specifications and code properties</p>
</li>
<li><p class="first">Example: CBMC (<a class="reference external" href="https://www.cprover.org/cbmc/">https://www.cprover.org/cbmc/</a>)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//cbmc file1.c --show-properties --bounds-check --pointer-check</span>
<span class="c1">//result: [main.pointer_dereference.6] line 7</span>
<span class="c1">//dereference failure: pointer outside object</span>
<span class="c1">//bounds in argv[(signed long int)2]: FAILURE</span>

<span class="kt">int</span> <span class="nf">puts</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span> 
    <span class="n">puts</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</div>
<p>Only static !</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// cbmc file1.c --show-properties --bounds-check --pointer-check</span>
<span class="c1">// result: nothing bad</span>
<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// &lt;- ERROR</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
    <span class="n">foo</span><span class="p">(</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p>Difficulties with bounded model checking:</p>
<ol class="arabic simple">
<li>Even if bounded, number of paths may still be too big</li>
<li>Solution: Symbolic execution: Explore several paths symbolically but
do not explore all paths</li>
</ol>
</li>
<li><div class="first line-block">
<div class="line"><strong>Symbolic execution</strong> (may use CP to be solved but may not always be applied and may lead to</div>
</div>
<p>state explosion)
| Tries to combine execution (testing, fuzzing) with formal methods
(verification), T-towards “clever coverage fuzzing”. Advanced static
analysis, decompile the binary and execute it symbolically to detect
many execution paths. Group variables in domains (<span class="math">x</span> in
<span class="math">[0,2]</span> instead of <span class="math">x=0,x=1,x=2</span>). Good for reasoning over
complex code, better coverage than classical fuzzing. Can find memory
problems with precise examples, can produce constraints/conditions of
memory problem.</p>
<ul class="simple">
<li>Well known tools: <code class="docutils literal notranslate"><span class="pre">Dart</span></code>, <code class="docutils literal notranslate"><span class="pre">Cute</span></code>, <code class="docutils literal notranslate"><span class="pre">Klee</span></code> (used by Microsoft)</li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/8.PNG"><img alt="../_images/8.PNG" class="align-center" src="../_images/8.PNG" style="width: 330.5px; height: 225.5px;" /></a>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Concolic execution</strong></div>
</div>
<ul>
<li><div class="first line-block">
<div class="line">In symbolic testing constraints may be hard to solve</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Moreover sometimes one needs a precise representation of data (API, …)</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">So the solution is to execute the system both symbolically and concretely on specific inputs.</div>
</div>
</li>
</ul>
</li>
<li><div class="first line-block">
<div class="line"><strong>Hybrid Concolic testing</strong> (K. Sen and R. Majumdar)</div>
</div>
<ul class="simple">
<li>Mix of random fuzzing:<ul>
<li>After few thousand trials we reach state 9</li>
<li>However, probability to generate reset is weak!</li>
</ul>
</li>
<li>and concolic execution: 17 choices and at least 9 iterations to reach ERROR (This means 17^9)</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>char *s,c; int state = 0;
while(1){
    c = input();
    s = input();
    if(c ==&#39;[&#39; &amp;&amp; state == 0) state=1; if(c ==&#39;(&#39; &amp;&amp; state == 1) state=2;
    if(c ==&#39;{&#39; &amp;&amp; state == 2) state=3; if(c ==&#39;~&#39; &amp;&amp; state == 3) state=4;
    if(c ==&#39;a&#39; &amp;&amp; state == 4) state=5; if(c ==&#39;x&#39; &amp;&amp; state == 5) state=6;
    if(c ==&#39;}&#39; &amp;&amp; state == 6) state=7; if(c ==&#39;)&#39; &amp;&amp; state == 7) state=8;
    if(c ==&#39;]&#39; &amp;&amp; state == 8) state=9;
    if(s[0]==&#39;r&#39; &amp;&amp; s[1] =&#39;=e&#39; &amp;&amp; s[2] = &#39;s&#39; &amp;&amp; s[3] == &#39;e&#39;
    &amp;&amp; s[4] == &#39;t&#39; &amp;&amp; s[5] == 0 &amp;&amp; state == 9){ ERROR;}
}
</pre></div>
</div>
</li>
<li><p class="first">…</p>
</li>
</ul>
<p>Goal is to help development avoid mistakes, but all have limitations.</p>
</div>
<div class="section" id="runtime-solutions">
<h3>Runtime Solutions<a class="headerlink" href="#runtime-solutions" title="Permalink to this headline">¶</a></h3>
<p>All the previous detection techniques are based on models and/or exploring paths (sometimes with selections). Let us try to work at execution time directly!
Detection solutions designed to operate at runtime:</p>
<ol class="arabic">
<li><p class="first"><strong>Tripwire</strong>: Add markers in memory (at the bounds of allocations, of
the stack and in freed memory) that “trip” when accessed to show
problems, used by Valgrind, …</p>
<ul class="simple">
<li>Memory, stack and lookup overhead</li>
<li>Works with existing code</li>
<li>Not perfect</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Old code</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="c1">// New (rewritten) code</span>
<span class="k">if</span><span class="p">(</span><span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">TRIPVAL</span><span class="p">)</span> <span class="n">abort</span><span class="p">();</span>
<span class="k">else</span> <span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="c1">//If you exceed the value, then you can attack !</span>
</pre></div>
</div>
</li>
</ol>
<a class="reference internal image-reference" href="../_images/9.PNG"><img alt="../_images/9.PNG" class="align-center" src="../_images/9.PNG" style="width: 133.0px; height: 255.0px;" /></a>
<ol class="arabic" start="2">
<li><p class="first"><strong>Object Based</strong>: Store information on memory allocations and check
pointers are valid on dereference. All “objects” are stored with
their metadata in a global store which has lookup from pointer value,
used by SafeCode</p>
<ul class="simple">
<li>Global store requires memory, Store lookup overhead is high</li>
<li>Works with existing code</li>
<li>Not perfect (object table can be corrupted)</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Old code</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="c1">// New (rewritten) code</span>
<span class="n">meminfo</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">mem</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">unsafe</span><span class="p">(</span><span class="n">meminfo</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="n">abort</span><span class="p">();</span>
<span class="k">else</span>  <span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Pointer based</strong>: Change how pointers are defined modifications
(e.g. “fat pointers”) and then check their additional information
(current address, pointer base address and pointer allocation size)
on dereference. Pointer access is now an inlined function to check
the access is safe (value inside base + size), used by Cyclone,
CCured</p>
<ul class="simple">
<li>Small memory overhead, Local and easy checking</li>
<li>Does not work with existing code (change of data structure for
pointers)</li>
<li>Not perfect</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Old code</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="c1">// New (rewritten) code</span>
<span class="k">if</span><span class="p">(</span><span class="n">mem</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">||</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">+</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="n">abort</span><span class="p">();</span>
<span class="k">else</span>  <span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Softbound</strong>: Add additional pointer information as extra variables
in the code (Pointers are now accompanied by local variables that
also store metadata, pointer base address and pointer allocation size
<img class="math" src="../_images/math/db2555e54bec0d091b2124dccd645c2d7ddaae68.png" alt="\rightarrow"/> Main difference with fat pointers. Makes it
compatible with existing code!) and check their values at
dereference. Pointer access is now an inlined function check the
access is safe (value inside base + size), used by SoftBound</p>
<ul class="simple">
<li>Very small memory overhead but some stack overhead</li>
<li>Local and easy checking</li>
<li>Works with existing code</li>
<li>Not perfect</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Old code</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="c1">// New (rewritten) code</span>
<span class="k">if</span><span class="p">(</span><span class="n">mem</span> <span class="o">&lt;</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">||</span> <span class="n">mem</span> <span class="o">&gt;</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">+</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="n">abort</span><span class="p">();</span>
<span class="k">else</span>  <span class="n">val</span> <span class="o">=</span> <span class="n">mem</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Breaking SoftBound</strong>: Softbound pointer information fails for sub objects. (see slide 108)
Consider code example of “my_object” and the following two “normal” examples:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span> <span class="n">my_object</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* example A */</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">other_object</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="s">&quot;name</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* example B */</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">new_obj</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">my_object</span><span class="p">));</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">other_object</span><span class="p">);</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span><span class="n">ptr</span><span class="p">,);</span>
</pre></div>
</div>
<p>If SoftBound prevents “Example A” by checking the size of “str”, then this will also stop “Example B” since “ptr” is bigger than the
size of “name” (8 bytes). This would break copy constructors and lots of normal code that has the structure of “Example B”.</p>
<p>If SoftBound allows “Example A”, then this allows an overflow of the “name” field into the “id” field (but allows “Example B”).
So if SoftBound allows normal copy constructors, then this allows overflow of sub-objects such as “name” here into “id”!</p>
</li>
</ol>
<div class="section" id="what-about-untyped-languages">
<h4>What about untyped languages<a class="headerlink" href="#what-about-untyped-languages" title="Permalink to this headline">¶</a></h4>
<p>Languages such as Python or HTML are weakly typed, however such language
are often written with language such as C. Consequently, they can suffer
from memory vulnerability, we just need to know internal detail of the
language we are using.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>axel@axel-VirtualBox:~$ python
Python <span class="m">2</span>.7.15+ <span class="o">(</span>default, Oct  <span class="m">2</span> <span class="m">2018</span>, <span class="m">22</span>:12:08<span class="o">)</span> 
<span class="o">[</span>GCC <span class="m">8</span>.2.0<span class="o">]</span> on linux2
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for</span> more information.
&gt;&gt;&gt; <span class="nv">a</span> <span class="o">=</span>  <span class="o">[</span><span class="m">1</span>,3,3<span class="o">]</span>
&gt;&gt;&gt; a<span class="o">[</span><span class="m">4</span><span class="o">]</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in &lt;module&gt;
IndexError: list index out of range
&gt;&gt;&gt; 
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>axel@axel-VirtualBox:~$ python
Python <span class="m">2</span>.7.15+ <span class="o">(</span>default, Oct  <span class="m">2</span> <span class="m">2018</span>, <span class="m">22</span>:12:08<span class="o">)</span> 
<span class="o">[</span>GCC <span class="m">8</span>.2.0<span class="o">]</span> on linux2
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for</span> more information.
&gt;&gt;&gt; def foo<span class="o">()</span>:
...     <span class="k">return</span> foo<span class="o">()</span>
... 
&gt;&gt;&gt; 
&gt;&gt;&gt; foo<span class="o">()</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in &lt;module&gt;
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
….

  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
  File <span class="s2">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">2</span>, in foo
RuntimeError: maximum recursion depth exceeded
&gt;&gt;&gt; 
s
</pre></div>
</div>
</div>
<div class="section" id="what-about-java">
<h4>What about java<a class="headerlink" href="#what-about-java" title="Permalink to this headline">¶</a></h4>
<p>Some languages do handle memory vulnerability as “exceptions” In case
cmd is not defined cmd string will be NULL and Java will throw a
<code class="docutils literal notranslate"><span class="pre">NULL</span> <span class="pre">POINTER</span> <span class="pre">EXCEPTION</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;cmd&quot;</span><span class="o">);</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
</pre></div>
</div>
<p>There is also vulnerability when using <strong>reflexion</strong>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">SecureData</span> <span class="o">{</span>   
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;MySecretPassword&quot;</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecuredDataHack</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">SecureData</span> <span class="n">s</span> <span class="o">=</span> <span class="n">SecureData</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>   
        <span class="n">Field</span> <span class="n">f</span><span class="o">[]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredFields</span><span class="o">();</span>   
        <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>   
        <span class="n">Object</span> <span class="n">pass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>   
        <span class="n">pass</span> <span class="o">=</span> <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>   
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Here is your &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; : &quot;</span> <span class="o">+</span> <span class="n">pass</span> <span class="o">);</span>   
        <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">set</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="s">&quot;NewPassword&quot;</span><span class="o">);</span>   
        <span class="n">pass</span> <span class="o">=</span> <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>   
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Here is new &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; : &quot;</span> <span class="o">+</span> <span class="n">pass</span> <span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**</span>
<span class="cm">axel@axel-VirtualBox:~/javamerde$ java SecuredDataHack </span>
<span class="cm">Here is your password : MySecretPassword</span>
<span class="cm">Here is new password : NewPassword</span>
<span class="cm"> */</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2022, Legay Axel, Duchene Fabien, Crochet Christophe, Sebastien Strebelle, Thomas Given-Wilson, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>