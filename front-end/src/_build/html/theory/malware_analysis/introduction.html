
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Malware Analysis &#8212; Theory 2020 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/my-style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2020',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Format String" href="../format_string/format_string.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/script.js"></script>





  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/UCLouvain_Logo+moodle.png"></span>
          LINGI2144</a>
        <span class="navbar-text navbar-version pull-left"><b>2020</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/LINGI2144-Secured-System-Engineering-Syllabus/_build/html/index.html">Main</a></li>
                <li><a href="https://github.com/ElNiak/LINGI2144-Secured-System-Engineering-Syllabus.git">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#security-a-definition">Security: A definition ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attackers-motivations">Attacker’s motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#risk-analysis">Risk analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#attacks-classification">Attacks classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#from-vulnerabilities-to-exploit">From vulnerabilities to exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#some-counter-measures">Some counter measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#hardware-hack">Hardware Hack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#additional-content">Additional content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basis/privilege.html">Basic attacks/defences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#privileges-escalation">Privileges escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#integer-overflow">Integer Overflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basis/privilege.html#exploit-concurrency">Exploit Concurrency</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../memory_safety/corruption.html">Memory Safety</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#memory-handling-and-impact-of-memory-corruption">Memory handling and impact of memory corruption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#vulnerabilities-stack-and-heap">Vulnerabilities stack and heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#id13">Memory Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory_safety/corruption.html#prevention-detection">Prevention/detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../assembly/assembly.html">Assembly/Debugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#assembly">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly/assembly.html#debugger-disassembler-decompiler">Debugger - disassembler - decompiler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../buffer_overflow/exploit1.html">Buffer Overflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-erase-value-of-other-local-variables">Exploit: Erase value of other local variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-dos">Exploit: DoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_overflow/exploit1.html#exploit-shellcode">Exploit: Shellcode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../complement_on_buffer/complement.html">Complement on BO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#situation-a-function-foo-that-call-function-bar">Situation: a function FOO that call function BAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#the-off-by-one-vulnerability">The “off by one vulnerability”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#a-note-on-architecture">A note on architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complement_on_buffer/complement.html#common-student-questions">Common student questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shellcode/handmake.html">Shellcode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#hand-made-shellcode">Hand made shellcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shellcode/handmake.html#dedicated-tools">Dedicated tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stack_protection/nonexec.html">Stack Protection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#non-executable-stack">Non Executable Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackshield">StackShield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#stackguard">StackGuard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stack_protection/nonexec.html#address-space-layout-randomization-aslr">Address Space Layout Randomization (ASLR)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../format_string/format_string.html">Format String</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#definition">Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#shellcode-and-format-string">Shellcode and Format String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#prevention-detection">Prevention/Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#format-string-versus-bo">Format String versus BO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../format_string/format_string.html#some-vulnerabilities">Some vulnerabilities</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Malware Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-study-mirai">Case Study: Mirai</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Malware Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-analysis">Static Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-analysis">Dynamic Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-on-packing">More on packing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container" >
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><ul>
<li><a class="reference internal" href="#">Malware Analysis</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#what-is-a-malware">What is a malware ?</a></li>
<li><a class="reference internal" href="#vector-surface-of-attack">Vector/Surface of attack</a></li>
<li><a class="reference internal" href="#malware-classification-sample">Malware classification (sample)</a></li>
<li><a class="reference internal" href="#some-famous-malware">Some famous malware</a></li>
<li><a class="reference internal" href="#malware-analysis-steps">Malware analysis: Steps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-mirai">Case Study: Mirai</a><ul>
<li><a class="reference internal" href="#preamble-denial-of-service-dos">Preamble: Denial of Service (DoS)</a><ul>
<li><a class="reference internal" href="#how-to-ddos">How to DDos</a></li>
<li><a class="reference internal" href="#the-mirai-botnet-trojan">The Mirai botnet trojan</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mirai-botnet-timeline">Mirai botnet: timeline</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work ?</a></li>
<li><a class="reference internal" href="#mirai-in-the-wild">Mirai in the wild</a></li>
<li><a class="reference internal" href="#mirai-trojan-infective-behavior">Mirai trojan: infective behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-obtain-malware-sample-the-honey-pot-approach">How to obtain malware sample ? The honey pot approach</a><ul>
<li><a class="reference internal" href="#catching-malware-samples">Catching malware samples</a></li>
<li><a class="reference internal" href="#honeypots">Honeypots</a><ul>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#some-great-tutorial">Some great tutorial:</a></li>
<li><a class="reference internal" href="#some-honey-pots">Some honey pots</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-case-of-mirai">The case of Mirai</a></li>
<li><a class="reference internal" href="#how-to-catch-a-mirai">How to catch a Mirai</a></li>
<li><a class="reference internal" href="#from-observation-to-analysis-and-detection">From observation to analysis and detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">Malware Analysis</a></li>
<li><a class="reference internal" href="#static-analysis">Static Analysis</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#static-analysis-signatures-are-sequences-of-strings">Static Analysis: Signatures are sequences of strings</a></li>
<li><a class="reference internal" href="#static-analysis-processing-new-files">Static Analysis: processing new files</a></li>
<li><a class="reference internal" href="#malware-detection-static-via-yara">Malware detection static via <code class="docutils literal"><span class="pre">YARA</span></code></a><ul>
<li><a class="reference internal" href="#automatized-in-a-tool-yargen">Automatized in a tool: yarGen</a></li>
<li><a class="reference internal" href="#process">Process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#static-analysis-syntactic-pattern-matching-obfuscation">Static Analysis: Syntactic Pattern Matching: Obfuscation</a></li>
<li><a class="reference internal" href="#problem-packing-detection">Problem: Packing Detection</a></li>
<li><a class="reference internal" href="#packing-detection-ground-truth">Packing Detection: Ground Truth</a></li>
<li><a class="reference internal" href="#packing-detection-ml-classifiers">Packing Detection: ML Classifiers</a></li>
<li><a class="reference internal" href="#packing-detection-preliminary-results">Packing Detection: Preliminary Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-analysis">Dynamic Analysis</a><ul>
<li><a class="reference internal" href="#dynamic-analysis-virtualized-environment">Dynamic Analysis: virtualized environment</a><ul>
<li><a class="reference internal" href="#tools-software">Tools/software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computer-system-abstract-architecture">Computer system : abstract architecture</a><ul>
<li><a class="reference internal" href="#sandbox">Sandbox</a></li>
<li><a class="reference internal" href="#virtual-machines">Virtual machines</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-memory-forensics">What is memory forensics ?</a></li>
<li><a class="reference internal" href="#memory-dump-and-memory-profil">Memory dump and memory profil</a></li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-linux">Sample of tools to dump memory (Linux)</a><ul>
<li><a class="reference internal" href="#lime-illustration">Lime: Illustration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-windows">Sample of tools to dump memory (Windows)</a></li>
<li><a class="reference internal" href="#sample-of-tools-to-dump-memory-disassembler">Sample of tools to dump memory (disassembler)</a></li>
<li><a class="reference internal" href="#the-volatility-framework">The <code class="docutils literal"><span class="pre">volatility</span></code> framework</a><ul>
<li><a class="reference internal" href="#id10">Introduction</a></li>
<li><a class="reference internal" href="#supports">Supports</a></li>
<li><a class="reference internal" href="#profile-creation-linux">Profile creation (linux)</a></li>
<li><a class="reference internal" href="#quick-usage-illustration">Quick usage illustration</a></li>
<li><a class="reference internal" href="#a-note-on-installation">A note on installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relation-with-virtual-machine">Relation with virtual machine</a></li>
<li><a class="reference internal" href="#the-limit-of-static-yara-analysis">The limit of static yara analysis</a></li>
<li><a class="reference internal" href="#dynamic-yara-analysis-in-action">Dynamic Yara analysis in action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-on-packing">More on packing</a><ul>
<li><a class="reference internal" href="#why-packing">Why packing?</a></li>
<li><a class="reference internal" href="#how-to-know-if-my-file-is-packed">How to know if my file is packed</a></li>
<li><a class="reference internal" href="#packing-challenges">Packing: challenges</a></li>
<li><a class="reference internal" href="#detect-it-easy-die">Detect it easy (DIE)</a></li>
<li><a class="reference internal" href="#unpacking-get-back-original-binary">Unpacking: get back original binary</a></li>
<li><a class="reference internal" href="#upx-what-is-it"><code class="docutils literal"><span class="pre">UPX</span></code>: what is it ?</a><ul>
<li><a class="reference internal" href="#execution-of-upx-packed-file">Execution of UPX packed file</a></li>
<li><a class="reference internal" href="#illustration">Illustration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unpacking-tricks">Unpacking tricks</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main" >
      
  <div class="section" id="malware-analysis">
<h1>Malware Analysis<a class="headerlink" href="#malware-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-a-malware">
<h3>What is a malware ?<a class="headerlink" href="#what-is-a-malware" title="Permalink to this headline">¶</a></h3>
<p>Malware is a  <strong>piece of code which changes the behavior</strong> of either
the operating system kernel or some security sensitive
applications, <strong>without a user consent</strong> and in such a way that it
is then <strong>impossible to detect those changes using a documented
features</strong> of the operating system or the application (e.g.
API).  <a class="footnote-reference" href="#id3" id="id1">[1]</a></p>
</div>
<div class="section" id="vector-surface-of-attack">
<h3>Vector/Surface of attack<a class="headerlink" href="#vector-surface-of-attack" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><strong>With consent</strong>: for example, using teamviewer for technical
support. In this case you gave your consent to someone to get full
access to your computer. I let you enter, but does not mean you can
install any type of code on my system ! (insiders). Another case is
when you download your self a bad stuff.</li>
<li><strong>Without consent</strong>: for example, again using teamviewer, an attacker
could use it to maliciously take control of your computer. For
example finding at vulnerability in protocol to do malicious things
without the user “consent”.</li>
<li>Here we have an example of <strong>Potentially Unwanted Application
(PUA)</strong>. The more you let access to your computer the more you give
your consent.</li>
</ol>
</div>
<div class="section" id="malware-classification-sample">
<h3>Malware classification (sample)<a class="headerlink" href="#malware-classification-sample" title="Permalink to this headline">¶</a></h3>
<p><strong>Malware classification</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> General traits of the malware, it
is useful to provide an overall description of malware’s behaviour and
to catch them with <strong>honeypot</strong>. It also help to characterize its
<strong>signature</strong> which is what identified the malware and hence is useful
to detect new one.</p>
<ul class="simple">
<li><strong>Worm/Virus</strong>: “a contagious piece of code that infects the other
software on the host system and spreads itself once it is run. It is
mostly known to spread when software is shared between computers.
This acts more like a parasite”. A virus is a specific type of
malware that spread and replicates. Malware are more general: “any
expected/unwanted behavior”. Most of Anti Viruses are anti malware.</li>
<li><strong>Spyware</strong>: give information about what the victim is doing, collect
information and send it, classical: keyloggers. (E.g keylogger)</li>
<li><strong>Bot(Net)</strong>: can be use as computer power (E.g mirai botnet), same
as backdoor, but all botnet infected with the same malware are
controlled by a command and control server (C&amp;C).</li>
<li><strong>Backdoor</strong>: install itself onto a computer to allow the attacker
access</li>
<li><strong>(Down)Loader</strong>: load some file to prepare an attack, (E.g loading
spyware)</li>
<li><strong>Ransomware</strong>: encrypt data of the victim and promise decryption in
exchange of ransom.</li>
<li><strong>Spam sending</strong>: use the machine to send spam (that may contain
infected behaviors)</li>
<li><strong>Scareware</strong>: scare the user to make him/her buying something (e.g
sexual scare)</li>
<li><strong>Rootkit</strong>: code used to conceal existence of to her code</li>
<li>…</li>
</ul>
<div class="line-block">
<div class="line">But there is no clear border, malware often belong to multiple
categories. Example: a program that collect information and sends
spam. It can be classified as keylogger if e.g. it collects
information such as passwords and t can be classified as worm if it
spreads within the spams it sends.</div>
</div>
<div class="line-block">
<div class="line">We should not confused <strong>classification of malware</strong> (“this is a
ransomware whose name is wannacry”) and <strong>family of malware</strong> (“this
is a rewriting of the code of wannacry”). Two malwares from the same
family may have the same signature, <em>but this is rare</em>. Indeed: the
objective of a family is to fool the detector with many variants.</div>
</div>
</div>
<div class="section" id="some-famous-malware">
<h3>Some famous malware<a class="headerlink" href="#some-famous-malware" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Creeper</td>
<td><ul class="first last simple">
<li>1971, First networked virus.</li>
<li>Infected several banks of mainframe computers through a proto
Internet, causing displays to flash an ominous “I’m the creeper,
catch me if you can.”</li>
<li>Result: programmers created the <strong>first anti virus called Reaper</strong></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>Michelangelo</td>
<td><ul class="first last simple">
<li>1991, Famous for creating the first widespread malware panic</li>
<li>Infects boot sectors</li>
<li>Viral infection of the news media “this virus would infect millions
of computers and shut down automation on March 6 (the real
Michelangelo’s birthday)”.</li>
<li>Invisible until March 6, where it would essentially make all storage
irretrievable.</li>
</ul>
</td>
</tr>
<tr class="row-even"><td>I Love You</td>
<td><ul class="first last simple">
<li>Released in 2000, when malware were a “myth”</li>
<li><strong>Spreads via emails, and via mIRC (love)</strong></li>
<li>Slowdown services, 5 billions dollars</li>
<li>From Philipines , but no law against</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>MyDoom.A</td>
<td><ul class="first last simple">
<li>Released in 2004, worm spread via emails or Kazaa</li>
<li>Open backdoors, tries to crash website via DDOS attacks</li>
<li>In 2004, roughly somewhere between 16 25% of all emails had been
infected by MyDoom , cost 38 billions dollars.</li>
</ul>
</td>
</tr>
<tr class="row-even"><td>StuxNet</td>
<td><ul class="first last simple">
<li>Spread by a USB thumb drive and targeted software controlling a
facility in Iran that held uranium.</li>
<li><strong>Requires state power, first digital weapon</strong></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>CryptoLocker</td>
<td><ul class="first last simple">
<li>Released in September 2013, spread through email attachments and
encrypted the user’s files so that they couldn’t access them.</li>
<li>With 500,000 victims, CryptoLocker made upwards of 30 million dollars
in 100 days <a class="footnote-reference" href="#id4" id="id2">[2]</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <strong>Situation</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/></p>
<ul class="simple">
<li>More and more complex</li>
<li>With specific targets</li>
<li>With specific damages</li>
<li>Two examples: Wannacry and Mirai</li>
<li>… Sadly, Coronavirus illustrates the problem</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WannaCry</td>
<td><ul class="first last simple">
<li>Self propagating ransomware</li>
<li>Worm like behavior</li>
<li>200K computers infects across 150 countries</li>
<li>SMBv1 vulnerability exploited by EternalBlue and DoublePulsar</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>Coronavirus</td>
<td><ul class="first last simple">
<li>Lots of hackers have exploited the situation</li>
<li>To attack hospital (ransomware, keylogger, …)</li>
<li>Difference between white hats and black hats</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="malware-analysis-steps">
<h3>Malware analysis: Steps<a class="headerlink" href="#malware-analysis-steps" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Malware is noticed by someone/ something</li>
<li>Analyst examines sample and confirms it’s malware</li>
<li>Analyst write a signatur e for the malware</li>
<li>Anti malware engines receive the rule and update themselves</li>
<li>Malware now detected and stopped</li>
</ol>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://blog.invisiblethings.org/papers/2006/rutkowska_malware_taxonomy.pdf">https://blog.invisiblethings.org/papers/2006/rutkowska_malware_taxonomy.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://www.pcworld.com/article/2082204/crime-pays-very-well-cryptolocker-grosses-up-to-30-million-in-ransom.html">https://www.pcworld.com/article/2082204/crime-pays-very-well-cryptolocker-grosses-up-to-30-million-in-ransom.html</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="case-study-mirai">
<h2>Case Study: Mirai<a class="headerlink" href="#case-study-mirai" title="Permalink to this headline">¶</a></h2>
<div class="section" id="preamble-denial-of-service-dos">
<h3>Preamble: Denial of Service (DoS)<a class="headerlink" href="#preamble-denial-of-service-dos" title="Permalink to this headline">¶</a></h3>
<p>A <strong>Denial of Service</strong> (DoS) attack aims at preventing a target from
providing its service.</p>
<ul class="simple">
<li>Most common: attack a server to take down a website</li>
<li>If server detects the attack, it can “blacklist” the attacker, i.e.
ignore all packets coming from the attacker</li>
<li>Solution: Attack from a lot of IPs → <strong>Distributed Dos</strong> (DDoS)</li>
</ul>
<div class="section" id="how-to-ddos">
<h4>How to DDos<a class="headerlink" href="#how-to-ddos" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Attacker infects lots of devices (called zombies or <strong>bots</strong>)</li>
<li>Zombies await for commands from a <strong>Command &amp; Control</strong> (C&amp;C) server</li>
<li>To DDoS attack, the C&amp;C server orders all zombies to flood the victim
with requests</li>
<li>Zombies can use <strong>amplification</strong> techniques to increase attack size
(e.g DNS amplification)</li>
<li>Very hard to know who to blacklist!</li>
</ul>
<img alt="../_images/30.PNG" class="align-center" src="../_images/30.PNG" style="width: 375.0px; height: 256.5px;" />
</div>
<div class="section" id="the-mirai-botnet-trojan">
<h4>The Mirai botnet trojan<a class="headerlink" href="#the-mirai-botnet-trojan" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Where do you find a lot of Internet connected, low security devices?</li>
<li>In the Internet of Things! (IoT ) almost zero security! Mirai is a
botnet trojan infecting IoT devices (targets Linux, mostly CCTVs and
DVRs)</li>
</ul>
</div>
</div>
<div class="section" id="mirai-botnet-timeline">
<h3>Mirai botnet: timeline<a class="headerlink" href="#mirai-botnet-timeline" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">20th-22nd September 2016:</p>
<ul class="simple">
<li>620 Gbps DDoS to KrebsOnSecurity using  120k devices.</li>
<li>1 Tbps DDoS to French hosting OVH using  150k devices</li>
</ul>
<p>“<em>According to Akamai, it was nearly double the size of the largest
attack they’d seen previously, and was among the biggest assaults the
internet has ever witnessed</em>”</p>
</li>
<li><p class="first">30th September 2016: Mirai author Anna-senpai releases source code
hoping to divert attention (did not work, authors pleaded guilty on
Dec 2017)</p>
</li>
</ol>
</div>
<div class="section" id="how-does-it-work">
<h3>How does it work ?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Vulnerable IoT devices exposed in the Internet are scanned</p>
</li>
<li><p class="first">Botnet malware is installed on the IoT devices that use common
password (63 are tried in)</p>
</li>
<li><div class="first line-block">
<div class="line">IoT device connects connect to C&amp;C</div>
<div class="line">Receive a payload that corresponds to their architecture</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Awaits instructions from the C&amp;C</div>
<div class="line">Example: please perform a DDOS attack on victim X</div>
</div>
</li>
</ol>
</div>
<div class="section" id="mirai-in-the-wild">
<h3>Mirai in the wild<a class="headerlink" href="#mirai-in-the-wild" title="Permalink to this headline">¶</a></h3>
<p>Remember: source code has been released</p>
<ul class="simple">
<li>Different Mirai versions <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> notion of <strong>family</strong></li>
<li>Different servers and IP that are scanned (XOR domain), or</li>
<li>Different C&amp;C → different version</li>
</ul>
</div>
<div class="section" id="mirai-trojan-infective-behavior">
<h3>Mirai trojan: infective behavior<a class="headerlink" href="#mirai-trojan-infective-behavior" title="Permalink to this headline">¶</a></h3>
<p>The Mirai trojan <strong>bot</strong> is the core of the botnet:</p>
<ul class="simple">
<li><strong>Deletes itself</strong> from disk <img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> hard to detect</li>
<li><strong>Modifies its process name</strong> into a random string</li>
<li><strong>Kills all processes listening on</strong> TCP ports 22 (SSH), 23 (Telnet), 80
(HTTP)</li>
<li><strong>Generates random IPs</strong> to scan avoiding dangerous subnets e.g. NSA</li>
<li>Attempts to login with <strong>60 default username/password pairs</strong> (not very
complicated one in this case)</li>
<li><strong>Signals vulnerable IPs</strong> and credentials to Mirai server</li>
<li>Finally, the bot <strong>waits for instructions from C&amp;C server</strong></li>
</ul>
</div>
</div>
<div class="section" id="how-to-obtain-malware-sample-the-honey-pot-approach">
<h2>How to obtain malware sample ? The honey pot approach<a class="headerlink" href="#how-to-obtain-malware-sample-the-honey-pot-approach" title="Permalink to this headline">¶</a></h2>
<div class="section" id="catching-malware-samples">
<h3>Catching malware samples<a class="headerlink" href="#catching-malware-samples" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">It is important to collect and analyze new data corresponding to new
malware. It is also important to observe variant of known malware
(<strong>same family</strong>), example: change of payload in the Mirai malware.</div>
<div class="line">Looking for actions, code, … FROM WHERE A SIGNATURE WILL BE EXTRACTED.
For doing so, one has to deploy “traps”. In the malware world, they
are known under the name of “honeypots”.</div>
</div>
</div>
<div class="section" id="honeypots">
<h3>Honeypots<a class="headerlink" href="#honeypots" title="Permalink to this headline">¶</a></h3>
<p>A <strong>honeypot</strong> is a <strong>system</strong> that is intentionally left vulnerable to
catch attacks and malware and study their behavior. The honeypot records
the behavior of the attacker and saves all the files dropped to an
external location, then reflashes itself. Idea attributed to Bill
Cheswick , played with a pirate who was exploiting a vulnerability in
the sendmail daemon (1991).</p>
<div class="section" id="objectives">
<h4>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h4>
<p>Let the attacker believe that she can control the system. This allows
the administrator to observe what the attacker uses to compromise the
system.</p>
<ol class="arabic simple">
<li>Spies the network</li>
<li>Collect informations</li>
<li>Analyse information</li>
</ol>
<p><strong>Different level of control</strong>: weak , middle and strong interactions.</p>
<ol class="arabic">
<li><p class="first"><strong>Weak interactions</strong><em>Emulate</em> services, but offer no response.
Allows us to perform statistic:</p>
<ul class="simple">
<li>Which port is under attack?</li>
<li>Which malware (in case information is in first packet)?</li>
</ul>
<div class="line-block">
<div class="line">Example: <code class="docutils literal"><span class="pre">netcat</span></code> that listen to a port and log all commands sent
by attacker.</div>
<div class="line">Others: honeytrap</div>
</div>
<blockquote>
<div><img alt="../_images/31.PNG" class="align-center" src="../_images/31.PNG" style="width: 407.04999999999995px; height: 241.14999999999998px;" />
</div></blockquote>
</li>
</ol>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line"><strong>Middle interactions</strong> Problem with weak interaction: no response.</div>
<div class="line">Solution: Middle interaction:</div>
</div>
<ul class="simple">
<li>respond with what the attacker expects (emulates a dedicated
service)</li>
<li>She trusts it and send more</li>
</ul>
<blockquote>
<div><img alt="../_images/32.PNG" class="align-center" src="../_images/32.PNG" style="width: 409.5px; height: 179.89999999999998px;" />
</div></blockquote>
<ul class="simple">
<li>Payload is analyzed in a virtual machine (not always easy to put
in place!)</li>
</ul>
<blockquote>
<div><img alt="../_images/33.PNG" class="align-center" src="../_images/33.PNG" style="width: 418.59999999999997px; height: 170.1px;" />
</div></blockquote>
<p>Example: <code class="docutils literal"><span class="pre">nepenthes</span></code></p>
<ul class="simple">
<li>Web server IIS with webdav known to be vulnerable to buffer
overflow (2003)</li>
<li>Implement fake version that let the attacker exploit the
vulnerability</li>
<li>In case attacker exploits vulnerability, emulate a virtual machine
to analyse the content</li>
</ul>
</li>
<li><div class="first line-block">
<div class="line"><strong>Strong interactions</strong> Middle interaction problem: it is not
difficult to detect if we are in a virtual environment.</div>
<div class="line">Solution: Let the attacker to have access to the full system</div>
</div>
<ul class="simple">
<li>Allows us to discover new attacks</li>
<li>More dangerous as the full system is vulnerable</li>
<li>But very useful to detect new types of attacks</li>
</ul>
<blockquote>
<div><img alt="../_images/34.PNG" class="align-center" src="../_images/34.PNG" style="width: 402.84999999999997px; height: 172.54999999999998px;" />
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="some-great-tutorial">
<h4>Some great tutorial:<a class="headerlink" href="#some-great-tutorial" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line"><a class="reference external" href="https://www.cse.wustl.edu/~jain/cse571-09/ftp/honey.pdf">https://www.cse.wustl.edu/~jain/cse571-09/ftp/honey.pdf</a></div>
<div class="line"><a class="reference external" href="https://www.diva-portal.org/smash/get/diva2:327476/FULLTEXT01.pdf">https://www.diva-portal.org/smash/get/diva2:327476/FULLTEXT01.pdf</a></div>
</div>
</div>
<div class="section" id="some-honey-pots">
<h4>Some honey pots<a class="headerlink" href="#some-honey-pots" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Mostly ssh services, can reply messages to another honey pot:
<img class="math" src="../_images/math/b1ccd922769a4761063130f111ef2545c9412782.png" alt="\left\{\begin{tabular}{&#64;{}r}
Cowrie\\
Kippo\\
Glastopf
\end{tabular}\right."/></div>
</div>
<p>Dionaea: against worms, effective for WannaCry</p>
</div>
</div>
<div class="section" id="the-case-of-mirai">
<h3>The case of Mirai<a class="headerlink" href="#the-case-of-mirai" title="Permalink to this headline">¶</a></h3>
<p>The Mirai flow of attack is known.</p>
<ul class="simple">
<li><strong>What we hunt:</strong> the code deployed depending on the architecture</li>
<li>Objective: to catch different versions to study variants of the
malware</li>
<li>To generate different malware signatures! (or even to predict new
ones)</li>
</ul>
<p>Again, the interesting part is the code that is deployed. We do not need
to let the code be executed, just catch it!</p>
<ul class="simple">
<li>Conclusion: A middle interaction honeypot is sufficient</li>
</ul>
<p>The <em>Cowrie</em> honey pot can be used to emulates an ARM IoT device. We
assume that this device accepts all connections attempts and store any
attempt to load a file into the honey pot.</p>
</div>
<div class="section" id="how-to-catch-a-mirai">
<h3>How to catch a Mirai<a class="headerlink" href="#how-to-catch-a-mirai" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>Bot scan</strong> How do you recognize when an attack comes from a Mirai
bot?</div>
<div class="line">Connects to port 23 (Telnet), tries to login with hardcoded
usernames and passwords, if successful runs the following commands:</div>
</div>
<blockquote>
<div><img alt="../_images/35.PNG" class="align-center" src="../_images/35.PNG" style="width: 455.7px; height: 120.05px;" />
</div></blockquote>
<div class="line-block">
<div class="line">If the commands above succeed, a Mirai server will contact you
next.</div>
<div class="line"><code class="docutils literal"><span class="pre">busybox</span></code> is file that emulate many version of linux.</div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line"><strong>C&amp;C server attack</strong></div>
<div class="line">The Mirai server will connect with the same credentials and
execute:</div>
</div>
<blockquote>
<div><img alt="../_images/36.PNG" class="align-center" src="../_images/36.PNG" style="width: 509.59999999999997px; height: 179.2px;" />
</div></blockquote>
<p>It try to have information about the mounted system since it try to
inject the mirai payload but the only way to do this is to write
something in you.</p>
</li>
<li><p class="first"><strong>Server attack</strong> Each mounted file system &lt;DIR&gt; found is tested for
writability by trying to write a file on it and see if its content
matches:</p>
<p><code class="docutils literal"><span class="pre">echo</span> <span class="pre">-e</span> <span class="pre">'\\x6b\\x61\\x6d</span> <span class="pre">\\x69</span> <span class="pre">&lt;DIR&gt;'&gt;</span> <span class="pre">&lt;./nippon/busybox</span> <span class="pre">cat&gt;</span> <span class="pre">&lt;DIR&gt;/.nippon/busybox</span> <span class="pre">rm</span> <span class="pre">&lt;DIR&gt;/.nippon</span></code></p>
<p>If it finds a writable &lt;DIR&gt; it moves to it and analyzes
<code class="docutils literal"><span class="pre">/bin/echo</span></code> and <code class="docutils literal"><span class="pre">/proc/cpuinfo</span></code> to determine the CPU architecture
(to adapt and know if victim is good candidate):</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;DIR&gt;
/busybox cp /bin/echo dvrHelper
dvrHelper
/busybox chmod <span class="m">777</span> &gt; dvrHelper
/busybox ECCHI
cat /proc/ cpuinfo
</pre></div>
</div>
</div></blockquote>
<p>Finally, the Mirai server uses <code class="docutils literal"><span class="pre">wget</span></code> or <code class="docutils literal"><span class="pre">tftp</span></code> to download and execute the Mirai
downloader for the correct architecture. The downloader downloads and
executes the Mirai bot for the correct architecture …so your
honeypot will record all the instructions executed by Mirai bot,
server, and downloader, and samples of the downloader and bot, and
save all of them somewhere for further analysis. Then the honeypot
with reflash itself to disinfect itself. That’s how you collect
malware samples and make sure it’s Mirai.</p>
</li>
</ol>
</div>
<div class="section" id="from-observation-to-analysis-and-detection">
<h3>From observation to analysis and detection<a class="headerlink" href="#from-observation-to-analysis-and-detection" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Honeypots are there to spy, collect, analyse</li>
<li>They lure the attacker</li>
<li>They are not intrusion detection systems/anti-virus (study, no
reaction)</li>
<li>Indeed, its up to you to decide if honeypot content correspond to a
malicious action</li>
<li>This information can be used to feed a malware analysis system</li>
</ol>
</div>
</div>
<div class="section" id="id5">
<h2>Malware Analysis<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p><strong>Objective</strong>: Classification of an executable binary as clean or
malicious (+ malware type/family if possible)</p>
<ul class="simple">
<li>Always the same principle:<ul>
<li>Characterize the malwares you know with signatures</li>
<li>Try to detect it in new files under analyses.</li>
</ul>
</li>
<li>Detection process leads to several types of analysis<ul>
<li>First one: <strong>static analysis</strong> (read content of the file)</li>
<li>The <strong>signature</strong> is a (combination of) string(s) + static
properties (features)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="static-analysis">
<h2>Static Analysis<a class="headerlink" href="#static-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">malicious_behavior</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I am evil!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">malicious_behavior</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The malware’s behavior is to print the string “I am evil!!!”.</div>
<div class="line">We will look for programs that produce this string but how do we
determine if a program has this malicious behavior ? How to know that
this string is indeed the malicious behavior to hunt?</div>
</div>
</div>
<div class="section" id="static-analysis-signatures-are-sequences-of-strings">
<h3>Static Analysis: Signatures are sequences of strings<a class="headerlink" href="#static-analysis-signatures-are-sequences-of-strings" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Principle</strong>: look for relevant strings in the binary ( that’s your
signature</li>
<li>How do the signatures look like?<ul>
<li>composed of characteristic strings extracted from the malware</li>
<li>other property that can be quickly verified without executing,
e.g., hash and size</li>
</ul>
</li>
<li>How do we extract the signature from a binary?<ul>
<li>major challenge, but when you’ve it you’re happy!</li>
<li>avoid false positive, false negative</li>
</ul>
</li>
<li>Before talking about the extraction, let us see what we can do when
we have it!</li>
</ul>
</div>
<div class="section" id="static-analysis-processing-new-files">
<h3>Static Analysis: processing new files<a class="headerlink" href="#static-analysis-processing-new-files" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Challenge</strong>: How to detect a potential new malware M1?</li>
<li><strong>Solution:</strong><ul>
<li>Compile all signatures of known malwares in a regular expression
(<strong>classification</strong>)</li>
<li>and scan the binary of M1 to see if any part matches
(<strong>detection</strong>)</li>
</ul>
</li>
<li>This is a <strong>Pattern matching</strong> approach (remember your translator
class!)</li>
<li>It is mostly performed via <strong>automata</strong>:<ul>
<li>Turn regular expression into automaton</li>
<li>Walk M1 file in the automaton and check if you reach an accepting
state</li>
</ul>
</li>
<li>A well known tool: <code class="docutils literal"><span class="pre">YARA</span></code></li>
</ul>
</div>
<div class="section" id="malware-detection-static-via-yara">
<h3>Malware detection static via <code class="docutils literal"><span class="pre">YARA</span></code><a class="headerlink" href="#malware-detection-static-via-yara" title="Permalink to this headline">¶</a></h3>
<p>Yara IS:</p>
<ul class="simple">
<li><strong>Elegant way to specify any type of regular expression</strong></li>
<li>Fast and efficient at detection</li>
<li>Look for syntactic properties of file</li>
<li>Does not execute the sample during analysis (i.e. static)</li>
<li>Plugins to python and other languages</li>
<li>Protections against <strong>REGEX attacks</strong><ul>
<li>Remember : Regular expression are turned into automaton</li>
<li>If automaton is deterministic then one path</li>
<li>If automaton is non deterministic which arises for complex regular
expressions), then exponential number of paths</li>
<li>Example:<ul>
<li>regular expression: <code class="docutils literal"><span class="pre">[a-z]+&#64;[a-z]+([a-z</span> <span class="pre">\.]+.]+\.)+[a-z]+</span></code>
for mail</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Yara IS NOT:</p>
<ul class="simple">
<li>a virus scanner (but act very similar to existing anti virus)</li>
<li>a correlation engine</li>
<li>a bayesian classifier</li>
<li>Or more generally: an artificial intelligence</li>
</ul>
<p>Rules can be very complex, but can be written in a very effective manner <a class="footnote-reference" href="#id8" id="id6">[3]</a></p>
<div class="highlight-c"><div class="highlight"><pre><span></span>rule 2018ISOLLATutorialYaraSimpler {
    meta:
        description = &quot;Simpler Yara rule for ISOLA 2018&quot;
    strings:
        $evil_string = &quot;i am evil&quot; wide ascii
    condition:
        $evil_string
}
</pre></div>
</div>
<p><strong>Main difficulty</strong>: how to write good (effective) YARA rules? I.e. How
to identify and extract malicious knowledge from a known database?</p>
<ul>
<li><p class="first"><strong>Things to avoid:</strong></p>
<ol class="arabic simple">
<li>Rules that generate many false positives and</li>
<li>Rules that match only the specific sample and are not much better
than a hashvalue.</li>
</ol>
</li>
<li><p class="first"><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p class="first">Comparison with cleanware database (<strong>reduce false positive</strong>
<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> Happens when the rule claims it is a malware, but it is
not)</p>
<ol class="arabic simple">
<li>Take a huge database of cleanware</li>
<li>Take a malware</li>
<li>Create a rule with strings that are specific to malware, and
not present (or almost not present) in the cleanware</li>
</ol>
<p>May generate plenty of strings</p>
<ol class="arabic simple">
<li>Take the x best ones</li>
<li>Best has to be defined.</li>
</ol>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">yarGen</span></code>: Keep strings that are likely to not be in goodware.</div>
<div class="line">Avoid false positive: Do not claim it is a malware if it not</div>
<div class="line"><strong>Danger</strong>:</div>
</div>
<ul class="simple">
<li>Rules may become too specific</li>
<li>Strings that were present in the sample used as malware may not
be part of the malware</li>
<li>And hence not present in another iteration of the same malware</li>
<li>Consequence: no detection!</li>
</ul>
<p>Example
<a class="reference external" href="https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/">https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/</a>
(<strong>ToREAD</strong>)</p>
</li>
<li><div class="first line-block">
<div class="line">Good practice (<strong>avoid false negative</strong>, less specific)</div>
<div class="line">Best practice by Florian Roth:</div>
</div>
<ol class="arabic">
<li><div class="first line-block">
<div class="line"><strong>Very specific strings</strong> ($s) s)<img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> hard indicators
for a malicious sample</div>
<div class="line">Ex: typos: „ Micorsoft Corportation “ instead of „Microsoft
Corporation“ and Monnitor “ instead of „</div>
</div>
</li>
<li><p class="first"><strong>Rare strings</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> likely that they do not appear in
goodware samples, but possible</p>
</li>
<li><p class="first"><strong>Strings that look common</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> (Optional) e.g. yarGen
output strings that do not seem to be specific but didn’t
appear in the goodware string database</p>
</li>
<li><p class="first"><strong>Question?</strong> How to rank the importance of the strings in the
rules?</p>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<div class="section" id="automatized-in-a-tool-yargen">
<h4>Automatized in a tool: yarGen<a class="headerlink" href="#automatized-in-a-tool-yargen" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Author: Florian Roth</p>
</li>
<li><p class="first">Repository: <a class="reference external" href="https://github.com/Neo23x0/yarGen">https://github.com/Neo23x0/yarGen</a></p>
</li>
<li><p class="first">Purpose: automatic creation of YARA rules</p>
<p>« The main principle is the creation of YARA rules from strings found
in malware files while removing all strings that also appear in
goodware files. »</p>
</li>
</ul>
</div>
<div class="section" id="process">
<h4>Process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/37.PNG" class="align-center" src="../_images/37.PNG" style="width: 580.0px; height: 291.0px;" />
</div>
</div>
<div class="section" id="static-analysis-syntactic-pattern-matching-obfuscation">
<h3>Static Analysis: Syntactic Pattern Matching: Obfuscation<a class="headerlink" href="#static-analysis-syntactic-pattern-matching-obfuscation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://hal.inria.fr/hal-01964222/file/main.pdf">https://hal.inria.fr/hal-01964222/file/main.pdf</a> (<strong>ToRead</strong>)</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">malicious_behavior</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I am&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; evil!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">malicious_behavior</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>Observation</strong>: Signature “I am evil!!!” is not detected anymore!</div>
<div class="line">Can obfuscate with:</div>
</div>
<ul class="simple">
<li>Easy to obfuscate, just split the strings in the code… with
<code class="docutils literal"><span class="pre">strncat</span></code> and <code class="docutils literal"><span class="pre">strcpy</span></code></li>
<li>More advanced technique: encoding (byte code, xor + key)</li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span>char * keystream = &quot;ISOLA - TUTORIAL -2018 &quot;;
char * obf = &quot;\x00\x73\x2e\x21\x61\x48\x22\x3c\x38\x6e \x73\x68\x4b&quot;;

char * xor(char * str) {
    int i;
    char *cipherstr;
    int len = strlen(keystream);
    cipherstr = malloc(len * sizeof(char));
    for (i = 0; i &lt; len ; i ++) {
        cipherstr[i] = str [i] ^ keystream[i];
        if(cipherstr[i] == ’\n’) {
            cipherstr[i + 1] = ’\0’;
            break;
        }
    }
    return cipherstr;
}
</pre></div>
</div>
</div>
<div class="section" id="problem-packing-detection">
<h3>Problem: Packing Detection<a class="headerlink" href="#problem-packing-detection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Code gets compressed/encrypted and only decrypted at runtime
(possibly one piece at the time)</li>
</ul>
<img alt="../_images/38.PNG" class="align-center" src="../_images/38.PNG" style="width: 378.0px; height: 166.5px;" />
<ul class="simple">
<li>Very effective against any static technique: as hard as breaking
encryption</li>
<li>Difficulties:<ol class="arabic">
<li>Hard to know if the program is packed</li>
<li>And by who necessary to unpack</li>
</ol>
</li>
<li>Solution: To unpack we need to know which technique was used.</li>
</ul>
<ol class="arabic simple">
<li><strong>YARA</strong></li>
</ol>
<div class="highlight-c"><div class="highlight"><pre><span></span>Import r2;
rule UPX {
    strings: $upx = &quot;UPX&quot;
    condition:
        r2.section(&quot;UPX0&quot;,&quot;&quot;) and r2.section(&quot;UPX1&quot;,&quot;&quot;) and $upx
}
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p class="first"><strong>Machine learning</strong>: we use <strong>signature based Machine Learning
classification</strong></p>
<ol class="arabic">
<li><p class="first"><strong>training</strong>:</p>
<ul class="simple">
<li>Extract relevant features from binaries</li>
<li>Link features to pack/unpack informations + name of packer (if
possible, Based on your knowledge)</li>
<li>Create a ground truth for training ML classifiers (test several
algorithms, Generalization step.)</li>
</ul>
</li>
<li><p class="first"><strong>testing</strong>:</p>
<ul>
<li><p class="first">Use the result to decide if a file is packed</p>
</li>
<li><div class="first line-block">
<div class="line">Efficiency is very important, two questions: Packed or
unpacked? Packed by who?</div>
</div>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>What is a feature ?</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Static features:</th>
<th class="head">Dynamic features:</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Number of non standard sections</li>
<li>Import table size</li>
<li>File header entropy</li>
<li>…</li>
<li>Extraction time:  10 ms/file</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Repeated instruction execution</li>
<li>Execution of data section</li>
<li>Execution of previously written memory</li>
<li>…</li>
<li>Extraction time:  1 s/file</li>
<li>In practice: Dynamic features are too expensive to extract</li>
</ul>
</td>
</tr>
</tbody>
</table>
<img alt="../_images/39.PNG" class="align-center" src="../_images/39.PNG" style="width: 376.25px; height: 200.89999999999998px;" />
</div>
<div class="section" id="packing-detection-ground-truth">
<h3>Packing Detection: Ground Truth<a class="headerlink" href="#packing-detection-ground-truth" title="Permalink to this headline">¶</a></h3>
<p>ML techniques are as good as the data used to train them. Binaries are
chosen for ground truth by combining:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="37%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Hash based</strong>
Proprietary analyzer</th>
<th class="head"><strong>Static signatures</strong></th>
<th class="head"><strong>Proprietary tools</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>No access to tool source</li>
<li>High quality detection</li>
<li>Only on known binaries</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Multiple sources: YARA, PeID…</li>
<li>Detects byte patterns of packers in
binaries</li>
<li>Detects packing on unknown binaries</li>
</ul>
</td>
<td>Often done with manual experience and
hash based</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Build ground truth based on <strong>consensus</strong> of these techniques.</div>
<div class="line">ML techniques are as good as the data used to train them</div>
</div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="c1">//Experimental file packed by us:</span>
<span class="c1">//Not known to the proprietary tool</span>
<span class="s">&quot;./tests/binary1&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">Unpacked</span> <span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">TheMida</span> <span class="n">v1</span><span class="mf">.802</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">TheMida</span> <span class="n">v1</span><span class="mf">.8</span>
<span class="p">}</span>
<span class="c1">//Packed with modified NSIS:</span>
<span class="c1">//Not know to static signatures</span>
<span class="s">&quot;./tests/binary2&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">NSIS</span><span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">Unpacked</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">Unpacked</span>
<span class="p">}</span>
<span class="c1">//Consensus on UPX:</span>
<span class="c1">//Added to the ground truth</span>
<span class="s">&quot;./tests/binary3&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;PROPRIETARY_TOOL&quot;</span><span class="o">:</span> <span class="n">UPX</span><span class="p">,</span>
    <span class="s">&quot;YARA_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">UPX</span>
    <span class="s">&quot;PEID_SIGNATURE&quot;</span><span class="o">:</span> <span class="n">UPX</span>
<span class="p">}</span>
</pre></div>
</div>
<img alt="../_images/40.PNG" class="align-center" src="../_images/40.PNG" style="width: 528.0px; height: 351.5px;" />
</div>
<div class="section" id="packing-detection-ml-classifiers">
<h3>Packing Detection: ML Classifiers<a class="headerlink" href="#packing-detection-ml-classifiers" title="Permalink to this headline">¶</a></h3>
<p>We test ML classifiers of various complexity:</p>
<ol class="arabic simple">
<li><strong>Naive Bayesian Classifier</strong> : performs Bayesian hypothesis testing
assuming independence of features</li>
<li><strong>Decision Tree</strong> : determines order of feature testing based on
greedy entropy minimization</li>
<li><strong>Random Forest</strong> : uses majority voting on multiple Decision Trees
to avoid local maxima</li>
<li><strong>Nearest Neighbors</strong> : clusters similar elements according to a
distance metric</li>
<li>…</li>
</ol>
<p>Algorithms are evaluated on:</p>
<ol class="arabic simple">
<li>Effectiveness (by F-score)</li>
<li>Training time</li>
<li>Classification time</li>
</ol>
</div>
<div class="section" id="packing-detection-preliminary-results">
<h3>Packing Detection: Preliminary Results<a class="headerlink" href="#packing-detection-preliminary-results" title="Permalink to this headline">¶</a></h3>
<p>Preliminary results on ML classifiers tested:</p>
<img alt="../_images/41.PNG" class="align-center" src="../_images/41.PNG" style="width: 526.5px; height: 153.5px;" />
<ul class="simple">
<li>Database of 160k unpacked and 40k packed PE files</li>
<li>Used 80% of database for training, 20% for testing</li>
<li>All classifiers are very effective (even simple ones)</li>
<li>Decision tree is very cost effective</li>
<li>Decide classifier to use according to available time</li>
</ul>
<p>Preliminary results on most relevant features: <a class="footnote-reference" href="#id9" id="id7">[4]</a></p>
<img alt="../_images/42.PNG" class="align-center" src="../_images/42.PNG" style="width: 449.0px; height: 102.0px;" />
<div class="line-block">
<div class="line">As expected, entropy is important to detect packing.</div>
<div class="line">Packing classification relies on finer features, like:</div>
</div>
<ul class="simple">
<li>Specific bytes after entry point</li>
<li>Presence of non standard sections</li>
<li>Use of rarely used system calls</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <strong>Situation</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/></th>
<th class="head"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <strong>Next</strong> <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Static analysis is a fast and efficient way to detect known malwares</li>
<li>With known signatures</li>
<li>The approach is not robust to obfuscation</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Let us try to detect signatures <em>at execution time</em></li>
<li>This is the <strong>dynamic analysis</strong> approach.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[3]</a></td><td><a class="reference external" href="https://yara.readthedocs.io/en/stable/">https://yara.readthedocs.io/en/stable/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[4]</a></td><td>* computed as mean decrease impurity on tree based algorithms</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dynamic-analysis">
<h2>Dynamic Analysis<a class="headerlink" href="#dynamic-analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>Principle</strong>: execute the binary, analyze the memory looking for
malicious behavior (in our case, “I am evil!”)</p>
<ul class="simple">
<li>Works for <code class="docutils literal"><span class="pre">strcpy(&quot;i</span> <span class="pre">am</span> <span class="pre">&quot;);strncat(a,</span> <span class="pre">&quot;</span> <span class="pre">evil</span> <span class="pre">&quot;);printf(a)</span></code></li>
<li>Does not work for <code class="docutils literal"><span class="pre">printf(&quot;i</span> <span class="pre">am</span> <span class="pre">&quot;);</span> <span class="pre">printf(&quot;</span> <span class="pre">evil</span> <span class="pre">&quot;)</span></code></li>
</ul>
<img alt="../_images/43.PNG" class="align-center" src="../_images/43.PNG" style="width: 500.5px; height: 225.0px;" />
<p>How do we look for the signature in a binary?</p>
<ul class="simple">
<li>The binary is executed in a virtualized environment.</li>
<li>The memory <strong>is dumped</strong> at various times during execution, and</li>
<li>Search for the <strong>signature</strong> in the dump.</li>
</ul>
<div class="line-block">
<div class="line">In static analysis, signatures are defined as (sets of) string(s)
<img class="math" src="../_images/math/eaa2ad04009ecd6e5e171f5bc829e5e423f59118.png" alt="+"/> special flags. Observing malwares at runtime allows for new
perspectives.</div>
<div class="line">A signature can be:</div>
</div>
<ul class="simple">
<li>Any type of observable behavior</li>
<li>Example: A sequence of logs (hock the logs)</li>
<li>Very important, e.g., in case of packing strings are obfuscated</li>
</ul>
<p><strong>Main difficulty</strong>: make sure that the malware does not know it is
observed!</p>
<div class="section" id="dynamic-analysis-virtualized-environment">
<h3>Dynamic Analysis: virtualized environment<a class="headerlink" href="#dynamic-analysis-virtualized-environment" title="Permalink to this headline">¶</a></h3>
<p>Complexity: <strong>high</strong></p>
<ul class="simple">
<li>Requires setting up and maintaining the emulation of a realistic
environment</li>
<li>Each file analysis requires time to execute the sample plus time to
reflash and restart virtualized environment</li>
</ul>
<div class="section" id="tools-software">
<h4>Tools/software<a class="headerlink" href="#tools-software" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">There are various virtualized environment:</div>
</div>
<ul class="simple">
<li>Sandboxes: Cuckoo, VirusTotal , sandboxie</li>
<li>Virtual machines: VirtualBox, …</li>
<li>Native hypervisors</li>
</ul>
<div class="line-block">
<div class="line">There are various tools to dump memory: <code class="docutils literal"><span class="pre">LiMe</span></code>, <code class="docutils literal"><span class="pre">fmem</span></code>,
<code class="docutils literal"><span class="pre">HBGary</span></code>, …</div>
<div class="line">There are many tools to examine a dump: <code class="docutils literal"><span class="pre">Volatility</span></code> (works with
python, embeds dynamic version of YARA)</div>
</div>
</div>
</div>
<div class="section" id="computer-system-abstract-architecture">
<h3>Computer system : abstract architecture<a class="headerlink" href="#computer-system-abstract-architecture" title="Permalink to this headline">¶</a></h3>
<div class="section" id="sandbox">
<h4>Sandbox<a class="headerlink" href="#sandbox" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Everything installed stays inside</li>
<li>Cannot be viewed from external world</li>
<li>Not saved when application exits</li>
<li>Hock calls, observe, …</li>
<li>Time out after some time</li>
</ul>
<img alt="../_images/44.PNG" class="align-center" src="../_images/44.PNG" style="width: 690.5px; height: 358.5px;" />
<p><strong>Limits</strong></p>
<ul class="simple">
<li>Does not analyze malware if it requires command line arguments or
packets from C&amp;C server</li>
<li>Sleep and similar operations can timeout analysis</li>
<li>Multi file malware (e.g. with DLLs) not analyzed</li>
<li>May have incorrect environment e.g. OS type</li>
<li>Analysis result may be hard to understand</li>
</ul>
</div>
<div class="section" id="virtual-machines">
<h4>Virtual machines<a class="headerlink" href="#virtual-machines" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/45.PNG" class="align-center" src="../_images/45.PNG" style="width: 729.5px; height: 384.5px;" />
<p><strong>Limits</strong></p>
<ul>
<li><p class="first">Not lightweight</p>
</li>
<li><p class="first">Reconstitute a computer within a computer</p>
</li>
<li><p class="first">Can still be detected</p>
</li>
<li><div class="first line-block">
<div class="line"><strong>Other solutions</strong>: hypervisor (beyond this introduction)</div>
</div>
</li>
</ul>
<p>Am I in a VM ?</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">hv_bit</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">cpu_feats</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">__asm__</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot; cpuid &quot;</span>
            <span class="o">:</span> <span class="s">&quot;=c&quot;</span> <span class="p">(</span> <span class="n">cpu_feats</span> <span class="p">)</span> <span class="c1">// output : ecx or rcx -&gt; cpu_feat</span>
            <span class="o">:</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// input : 1 -&gt; eax or rax</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">cpu_feats</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Dynamic analysis forces to execute the malware, this goes beyond
static analysis</li>
<li>But may requires more sophisticated deployments</li>
<li>Unfortunately: all virtual environments can be detected and evaded</li>
<li>When a malware is executed, one can get information with memory dump</li>
</ol>
</div>
</div>
<div class="section" id="what-is-memory-forensics">
<h3>What is memory forensics ?<a class="headerlink" href="#what-is-memory-forensics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Data are stored in either main memory unit or auxiliary memory unit</li>
<li>RAM (Random Access Memory) is the main memory unit</li>
<li>It retrieves the programs or data from the auxiliary memory unit</li>
<li>It temporarily stores the information until the power is turned off.</li>
</ul>
<p>“Memory forensics is forensic analysis of a computer’s memory dump. Its
primary application is investigation of advanced computer attacks which
are stealthy enough to avoid leaving data on the computer’s hard drive.
Consequently, the memory (RAM) must be analyzed for forensic
information. [From Wikipedia]”</p>
<p>There are at least two main reasons to observe the physical memory:</p>
<ol class="arabic simple">
<li>Contains data related to the real time execution of the system<ul>
<li>Currently mounter file system</li>
<li>List of active processes, connections, …</li>
</ul>
</li>
<li>Encrypted data are generally decrypted before being used<ul>
<li>Password is now visible, …</li>
<li>Code is unpacked before being executed</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="memory-dump-and-memory-profil">
<h3>Memory dump and memory profil<a class="headerlink" href="#memory-dump-and-memory-profil" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Main difficulty</strong>: organisation of memory depends of architecture
and kernel symbols</li>
<li>This information is called the <strong>memory profil</strong> (can be created from
distribution)</li>
<li>When dumping memory it is of interest to specify the memory profil</li>
<li>If it is unknown , we obtain a “<strong>raw</strong>” <strong>memory dump</strong></li>
<li>In this case, tools exists to identify the dump (but they are not
perfect)”</li>
<li>Dumping memory is not hard</li>
<li>Retrieving informations from dump requires to know the profil</li>
<li>Identifying profil is thus crucial</li>
<li>This class does not aim to investiguate the shape of memory</li>
<li>However, students need to understand that there is no tool able to
handle all memory shape and all architecture</li>
</ul>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-linux">
<h3>Sample of tools to dump memory (Linux)<a class="headerlink" href="#sample-of-tools-to-dump-memory-linux" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><code class="docutils literal"><span class="pre">LiME</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">dd</span></code> command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>Loadable kernel module</li>
<li>first tool that can perform entire memory dumps from Linux devices
and from Android.</li>
<li>Perform memory dumps by loading modules immediately after compiling
without any other operations, such as a change in kernel settings</li>
<li>Work with both 32 and 64 bits</li>
<li>Can generate its own memory format for compatibility with analysis
tools</li>
</ul>
</td>
<td><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">dd</span></code> can copy files of various sizes (<code class="docutils literal"><span class="pre">dd</span></code> if = origine of =
destination)</li>
<li>In Linux, all the devices are managed through files</li>
<li>physical memory data are in <code class="docutils literal"><span class="pre">/dev/mem</span></code> file</li>
<li>However, recent versions restrict access to memory stored in
<code class="docutils literal"><span class="pre">/dev/mem</span></code></li>
<li>Work with both 32 and 64 bits</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="section" id="lime-illustration">
<h4>Lime: Illustration<a class="headerlink" href="#lime-illustration" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="first line-block">
<div class="line">The following command:</div>
<div class="line"><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">insmod</span> <span class="pre">lime</span> <span class="pre">4.18.0</span> <span class="pre">17</span> <span class="pre">generic.ko</span> <span class="pre">&quot;path=/home/axel/memory.mem</span> <span class="pre">format=lime&quot;</span></code></div>
<div class="line">Creates a lime format copy of the RAM and write it into
<code class="docutils literal"><span class="pre">/home/</span> <span class="pre">memory.mem</span></code></div>
</div>
</li>
<li><p class="first">Observe that lime <code class="docutils literal"><span class="pre">4.18.0-17-generic.ko</span></code> is the lime module
directly identified by Lime during installation on your distribution!
(LiMe version directly link to you kernel distribution version
because it need to keep the structure of you memory!)</p>
</li>
<li><p class="first">It actually depends on the memory <code class="docutils literal"><span class="pre">System.map</span></code> in <code class="docutils literal"><span class="pre">/boot</span></code>
directory!</p>
</li>
<li><p class="first">To clean up: <code class="docutils literal"><span class="pre">rrmod</span> <span class="pre">lime</span></code></p>
</li>
</ul>
</div>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-windows">
<h3>Sample of tools to dump memory (Windows)<a class="headerlink" href="#sample-of-tools-to-dump-memory-windows" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><code class="docutils literal"><span class="pre">Dumpit</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">OllyDBG</span></code> and <code class="docutils literal"><span class="pre">LordPE</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ul class="first last simple">
<li>generate a physical memory dump of Windows
machines.</li>
<li>The raw memory dump is generated in the current
directory</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Free</li>
<li>Only works properly on 32 bit architecture</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sample-of-tools-to-dump-memory-disassembler">
<h3>Sample of tools to dump memory (disassembler)<a class="headerlink" href="#sample-of-tools-to-dump-memory-disassembler" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Most of disassembler have their own memory dump</div>
<div class="line"><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">GDB</span></code></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">dump</span> <span class="pre">binary</span> <span class="pre">memory</span> <span class="pre">result.bin</span> <span class="pre">0x200000000</span> <span class="pre">0x20000c350</span></code></li>
</ul>
<p><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">x64dbg</span></code></p>
<ul class="simple">
<li>Scylla Plugin</li>
</ul>
<p><img class="math" src="../_images/math/97e58c1e7a742a4105ca9408b7e8a9bf45658360.png" alt="\Rightarrow"/> <code class="docutils literal"><span class="pre">IDA,</span> <span class="pre">RADARE</span></code>,…</p>
</div>
<div class="section" id="the-volatility-framework">
<h3>The <code class="docutils literal"><span class="pre">volatility</span></code> framework<a class="headerlink" href="#the-volatility-framework" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id10">
<h4>Introduction<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Volatility is an open source memory forensics framework for incident
response and malware analysis. Volatility is written in <code class="docutils literal"><span class="pre">python</span></code>.</div>
<div class="line">Volatility can be used to retrieve information from memory dump:</div>
</div>
<ul class="simple">
<li>List of processes</li>
<li>connections</li>
<li>Dump process from memory for finer analysis</li>
<li>Process organization structure</li>
<li>Command link to process</li>
<li>Yara (pattern matching inside</li>
<li>Malfind (detect known)</li>
<li>…</li>
</ul>
</div>
<div class="section" id="supports">
<h4>Supports<a class="headerlink" href="#supports" title="Permalink to this headline">¶</a></h4>
<p>Volatility Framework support (taken from their website):</p>
<ul class="simple">
<li>memory dumps from all major 32 and 64 bit Windows</li>
<li>Linux memory dumps in raw or LiME format and include 35+ plugins for
analyzing 32 and 64 bit Linux kernels from 2.6.11 3.16 and
distributions such as Debian, Ubuntu, OpenSuSE , Fedora, CentOS, and
Mandrake</li>
<li>38 versions of Mac OSX memory dumps from 10.5 to 10.9.4 Mavericks,
both 32 and 64 bit. Android phones with ARM processors are also
supported</li>
</ul>
<p>But is is likely that you’ll have to create your own profile (especially
for Linux)</p>
</div>
<div class="section" id="profile-creation-linux">
<h4>Profile creation (linux)<a class="headerlink" href="#profile-creation-linux" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">A profil contains: kernel data structures (<code class="docutils literal"><span class="pre">.dwarf</span></code>) and debug
symbols (<code class="docutils literal"><span class="pre">.map</span></code>)</div>
<div class="line">Remember:</div>
</div>
<ul class="simple">
<li>it is used to locate critical information inside the memory dump</li>
<li>Hence to understand the structure of the memory.</li>
</ul>
<p>It’s imperative that the profile is created on the same machine to be
analyzed. Indeed, kernel data structure and debug symbols are specific
to distribution and kernel used.</p>
<ol class="arabic">
<li><p class="first">Create the kernel data structure</p>
<ul>
<li><p class="first">Use <code class="docutils literal"><span class="pre">dwarf</span></code> for debugging information</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">axel&#64;axel-VirtualBox:~/volatility/linux</span> <span class="pre">ls</span></code></p>
<p><code class="docutils literal"><span class="pre">info</span> <span class="pre">kcore</span> <span class="pre">Makefile</span> <span class="pre">Makefile.enterprise</span> <span class="pre">module.c</span> <span class="pre">module.dwarf</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Get the kernel symbols of the current kernel</p>
<ul>
<li><p class="first">tells Volatility how are memory analysis snapshot structured</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">axel&#64;axel</span> <span class="pre">VirtualBox</span> <span class="pre">:~</span> <span class="pre">ls</span> <span class="pre">/boot/System*</span></code></p>
<p><code class="docutils literal"><span class="pre">/boot/System.map-4.18.0-16-generic</span> <span class="pre">/boot/System.map-4.18.0-17-generic</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Archive the profile</p>
<ul class="simple">
<li>in <code class="docutils literal"><span class="pre">/volatility/volatility/plugins/linux</span></code></li>
<li><code class="docutils literal"><span class="pre">zip</span> <span class="pre">nomprofil.zip</span> <span class="pre">/boot/System.map-4.18.0-17-generic/volatility</span> <span class="pre">/linux.module.dwarf</span></code></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="quick-usage-illustration">
<h4>Quick usage illustration<a class="headerlink" href="#quick-usage-illustration" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="first line-block">
<div class="line">Command line:</div>
<div class="line"><code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">(--profil=profiltodefine)</span> <span class="pre">-f</span> <span class="pre">file</span> <span class="pre">(-p</span> <span class="pre">processnumber)</span>&#160; <span class="pre">command</span></code></div>
</div>
</li>
<li><p class="first">To know the list of available profiles: <code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">--info</span></code></p>
</li>
<li><div class="first line-block">
<div class="line">Example: how to list all process from dump <code class="docutils literal"><span class="pre">memory.mem</span></code> with
profil ubuntu</div>
<div class="line"><code class="docutils literal"><span class="pre">python</span> <span class="pre">vol.py</span> <span class="pre">--profil=ubuntu</span> <span class="pre">-f</span> <span class="pre">memory.mem</span> <span class="pre">linux_pslist</span></code></div>
</div>
</li>
<li><p class="first">Can be combined with Yara and other tools</p>
</li>
</ul>
</div>
<div class="section" id="a-note-on-installation">
<h4>A note on installation<a class="headerlink" href="#a-note-on-installation" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">get</span> <span class="pre">install</span> <span class="pre">volatility</span></code> works for linux but is not providing
a nice structure to add profiles (especially overlay directory). Better
to follow installation from original website:</p>
<p><a class="reference external" href="https://github.com/volatilityfoundation/volatility/wiki/Installation#getting-volatility">https://github.com/volatilityfoundation/volatility/wiki/Installation#getting-volatility</a></p>
<p>Fully integrated version for windows: <code class="docutils literal"><span class="pre">volatility_standalone</span></code></p>
</div>
</div>
<div class="section" id="relation-with-virtual-machine">
<h3>Relation with virtual machine<a class="headerlink" href="#relation-with-virtual-machine" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Tool such as Virtualbox allow us to perform memory dump of a virtual
machine.</div>
<div class="line">Example:
<code class="docutils literal"><span class="pre">vboxmanage</span> <span class="pre">debugvm</span> <span class="pre">&quot;windows10&quot;</span>&#160; <span class="pre">dumpvmcore</span> <span class="pre">--filename</span> <span class="pre">test.elf</span></code></div>
</div>
<ul class="simple">
<li>Extract dump of Ubuntu 2019 and place it into <code class="docutils literal"><span class="pre">test.elf</span></code>.</li>
<li>Vboximage are always ELF files (even if windows runs inside the
machine!)</li>
</ul>
<p><strong>Important</strong>: <code class="docutils literal"><span class="pre">test.elf</span></code> contains the entire virtualbox environment,
that is not only the RAM of the system running within windows10 , but
also the RAM for the entire machine. One must thus locate the RAM of the
system running within the machine, that is to identify the first LOAD
section , and take a subimage.</p>
<p><a class="reference external" href="https://www.andreafortuna.org/2017/06/23/how-to-extract-a-ram-dump-from-a-running-virtualbox-machine/">https://www.andreafortuna.org/2017/06/23/how-to-extract-a-ram-dump-from-a-running-virtualbox-machine/</a></p>
<div class="line-block">
<div class="line"><strong>Warning</strong>: the entire raw memory occupied by the machine will be
dumped. As an example, if 10GB of raw memory are allocated to the
machine, then they’ll be all dumped. Even if they are not entirely
used by the machine.</div>
<div class="line"><strong>Problem</strong>: tools may not be able to analyse such size (extract sub
image, save, etc</div>
</div>
<ul class="simple">
<li>Configure your machine properly when you perform an analysis</li>
</ul>
</div>
<div class="section" id="the-limit-of-static-yara-analysis">
<h3>The limit of static yara analysis<a class="headerlink" href="#the-limit-of-static-yara-analysis" title="Permalink to this headline">¶</a></h3>
<p>Consider that any program which prints “catanddog123” is a malware. The
following yara rule should be able to catch such malware:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>rule silent_banker : banker {
    meta:
        description = &quot;This is just an example&quot;
    strings:
        $a = &quot;catanddog123&quot;
    condition:
        $a
}
</pre></div>
</div>
<p>However , the following program (test.c) will not be detected</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">table1</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">table2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">table1</span><span class="p">,</span><span class="s">&quot;catanddog1&quot;</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span><span class="s">&quot;23&quot;</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">table1</span><span class="p">,</span><span class="n">table2</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">table1</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nothing happened ; Yara found nothing, this is because « catanddog123 »
is not in stored in the file. However , it appears in memory before it
is printed.</p>
<ul class="simple">
<li>Solution: dump the memory and apply yara on it</li>
<li>Remember : memory contains almost everything you need</li>
</ul>
</div>
<div class="section" id="dynamic-yara-analysis-in-action">
<h3>Dynamic Yara analysis in action<a class="headerlink" href="#dynamic-yara-analysis-in-action" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/46.PNG" class="align-center" src="../_images/46.PNG" style="width: 640.0px; height: 213.5px;" />
<img alt="../_images/47.PNG" class="align-center" src="../_images/47.PNG" style="width: 639.5px; height: 239.0px;" />
<p>There are several tutorial availables:</p>
<p><a class="reference external" href="https://eforensicsmag.com/finding-advanced-malware-using-volatility/">https://eforensicsmag.com/finding-advanced-malware-using-volatility/</a></p>
<p>It assumes that a dump of the problematic file has been created under
<code class="docutils literal"><span class="pre">vinfected.vmem</span></code>.</p>
</div>
</div>
<div class="section" id="more-on-packing">
<h2>More on packing<a class="headerlink" href="#more-on-packing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-packing">
<h3>Why packing?<a class="headerlink" href="#why-packing" title="Permalink to this headline">¶</a></h3>
<p>To compress a file and reduce its size but also to obfuscate a file.</p>
<ul class="simple">
<li>Well known packers: <code class="docutils literal"><span class="pre">UPX,</span> <span class="pre">THEMIDA</span></code> , … (can be combined</li>
<li>Warning: Algorithms may vary with architecture (32 or 64 bits)</li>
</ul>
</div>
<div class="section" id="how-to-know-if-my-file-is-packed">
<h3>How to know if my file is packed<a class="headerlink" href="#how-to-know-if-my-file-is-packed" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">PE</span></code> or <code class="docutils literal"><span class="pre">ELF</span></code> file with unclassic sections</li>
<li>Few dynamic links</li>
</ul>
<div class="line-block">
<div class="line"><em>Unpacked</em></div>
</div>
<img alt="../_images/48.PNG" class="align-center" src="../_images/48.PNG" style="width: 407.20000000000005px; height: 338.40000000000003px;" />
<div class="line-block">
<div class="line"><em>Packed</em></div>
</div>
<img alt="../_images/49.PNG" class="align-center" src="../_images/49.PNG" style="width: 295.2px; height: 36.0px;" />
</div>
<div class="section" id="packing-challenges">
<h3>Packing: challenges<a class="headerlink" href="#packing-challenges" title="Permalink to this headline">¶</a></h3>
<p>Difficulties with packing:</p>
<ol class="arabic simple">
<li>To identify which packer has been used</li>
<li>To unpack the file</li>
</ol>
<p>Solutions:</p>
<ul class="simple">
<li>PIED, OLLYDBG, YARA rules , detect it easy (DIE), machine learning</li>
<li>Call the packer itself , or disassemble if the functionality does not
exists</li>
</ul>
</div>
<div class="section" id="detect-it-easy-die">
<h3>Detect it easy (DIE)<a class="headerlink" href="#detect-it-easy-die" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/50.PNG" class="align-center" src="../_images/50.PNG" style="width: 317.4px; height: 189.29999999999998px;" />
<p>DIE is based on Yara!</p>
</div>
<div class="section" id="unpacking-get-back-original-binary">
<h3>Unpacking: get back original binary<a class="headerlink" href="#unpacking-get-back-original-binary" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When you execute the packed file, you’ll reveal the true behavior of
your file at dynamic level but this does not mean that you’ll get back
the original code, i.e., you cannot do any type of static analysis.</div>
<div class="line">To get back the original binary code you need to unpack the file and
dump the memory at the right moment.</div>
</div>
<ul class="simple">
<li>Right moment <img class="math" src="../_images/math/f83e0c11055f53d8b8d4d5968e1adb756869862c.png" alt="="/> when the cypher process has been reversed .</li>
</ul>
</div>
<div class="section" id="upx-what-is-it">
<h3><code class="docutils literal"><span class="pre">UPX</span></code>: what is it ?<a class="headerlink" href="#upx-what-is-it" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">UPX</span></code> uses a data compression algorithm called <code class="docutils literal"><span class="pre">UCL</span></code></li>
<li><code class="docutils literal"><span class="pre">UPX</span></code> (since 2.90 beta) can use <code class="docutils literal"><span class="pre">LZMA</span></code> (data compression based on
Markov Chains) on most platforms; however, this is disabled by
default for 16 bit due to slow decompression speed on older computers
(use lzma to force it on)</li>
<li>Starting with version 3.91, <code class="docutils literal"><span class="pre">UPX</span></code> also supports 64 Bit (x64)
executable files on the Windows platform. This feature is currently
declared as experimental</li>
</ul>
<div class="section" id="execution-of-upx-packed-file">
<h4>Execution of UPX packed file<a class="headerlink" href="#execution-of-upx-packed-file" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Assume a 32 bits architecture</div>
<div class="line">There is a clear pattern to the unpacker code section:</div>
</div>
<ol class="arabic simple">
<li>Push all the registers with <code class="docutils literal"><span class="pre">pushad</span></code></li>
<li>Unpacks the code in physical memory (Lots of rewritting of sections)</li>
<li>Pop back all registers using <code class="docutils literal"><span class="pre">popad</span></code></li>
<li>Jump to unpacked code</li>
<li>Run it!</li>
</ol>
<img alt="../_images/51.PNG" class="align-center" src="../_images/51.PNG" style="width: 132.0px; height: 164.0px;" />
<p>Unpacking UPX is relatively easy</p>
<ol class="arabic simple">
<li>Put a break point after <code class="docutils literal"><span class="pre">popad</span></code></li>
<li>Follow the next jump</li>
<li><strong>Dump</strong> starting from jump destination (it become new entry point
address)</li>
<li>Restore import table with respect to new entry point address</li>
</ol>
<p>Important observation:</p>
<ul class="simple">
<li>this requires to disassemble the file!</li>
</ul>
</div>
<div class="section" id="illustration">
<h4>Illustration<a class="headerlink" href="#illustration" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/52.PNG" class="align-center" src="../_images/52.PNG" style="width: 638.0px; height: 352.5px;" />
<img alt="../_images/53.PNG" class="align-center" src="../_images/53.PNG" style="width: 714.0px; height: 347.5px;" />
<img alt="../_images/55.png" class="align-center" src="../_images/55.png" style="width: 651.0px; height: 394.5px;" />
<img alt="../_images/56.PNG" class="align-center" src="../_images/56.PNG" style="width: 628.5px; height: 337.0px;" />
<p>Important observation:</p>
<ul class="simple">
<li>this requires to disassemble the file!</li>
<li><code class="docutils literal"><span class="pre">pushad</span></code> and <code class="docutils literal"><span class="pre">popad</span></code> do not exist on 64bit architectures. But one
can still check for double 0 repetitions</li>
</ul>
<img alt="../_images/57.PNG" class="align-center" src="../_images/57.PNG" style="width: 350.0px; height: 179.5px;" />
</div>
</div>
<div class="section" id="unpacking-tricks">
<h3>Unpacking tricks<a class="headerlink" href="#unpacking-tricks" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Put breakpoints at the end of loops: At this point try to re analyze
the binary for new assembly routines</li>
<li>Look for calls that don’t return or jumps with no code after them</li>
<li>Look for long jumps that jump into a different section: These can
indicate a jump from the unpacking stub and the binary itself</li>
<li>Look for <code class="docutils literal"><span class="pre">pushad</span></code> . Sent a memory breakpoint on these stack
addresses, which should break on the corresponding <code class="docutils literal"><span class="pre">popad</span></code> . These
are often used to save the context for main.</li>
<li>Add breakpoints on <code class="docutils literal"><span class="pre">GetVersion</span></code> or <code class="docutils literal"><span class="pre">GetCommandLineA</span></code> : These are
often called from the normal main wrapper that windows compilers add
<code class="docutils literal"><span class="pre">GetModuleHandle</span></code> for GUI apps</li>
<li>Some more advanced unpacker only unpack ‘on demand’, meaning that the
whole binary is never fully unpacked unless you touch all
functionality. This can usually be avoided by scripting your debugger
to call the appropriate unpacking routines</li>
</ul>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Memory dump and memory forensics can be used in many situations</li>
<li>Dynamic analysis sometimes ) can go further than static analysis</li>
<li>But dynamic analysis can also easily be bypassed</li>
<li>Indeed, malware can detect if they’re in a virtualized environment</li>
<li>Solution: let us do some research and take the best of boths</li>
</ol>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a id="up" href="#">
        <span class="fa fa-chevron-up"></span>
      </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/malware_analysis/introduction.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2020, Legay Axel, Dûchene Fabien, Crochet Christophe, Schmitz Donatien.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>